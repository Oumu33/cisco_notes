# Cisco 网络完全学习指南

> 从零基础到网络工程师的完整学习路径

---

## 🎥 推荐学习资源

**⚠️ 重要提示**：网络技术基础知识（OSI 模型、TCP/IP、路由交换原理等）多年来变化不大，**2018-2020年的教程仍然有效**。核心概念和协议原理是稳定的，考试大纲变化也不大。

### 📚 推荐学习方式

#### 1. **Cisco 官方资源（推荐）**
- **Cisco Networking Academy（NetAcad）**
  - 链接：https://www.netacad.com/
  - 官方免费课程，内容权威
  - 包含互动实验和练习
  - 有中文版本

- **Cisco 官方文档**
  - 链接：https://www.cisco.com/c/en/us/support/index.html
  - 最权威的技术资料
  - 配置指南和命令参考

#### 2. **Packet Tracer 实践（强烈推荐）**
- **下载地址**：https://www.netacad.com/courses/packet-tracer
- **特点**：
  - Cisco 官方免费网络模拟器
  - 可视化操作，拖拽式搭建网络
  - 包含大量实验练习
  - 适合零基础学习

#### 3. **视频学习资源**
**注意**：以下资源发布时间较早，但核心知识仍然有效：

- **YouTube 搜索关键词**：
  - "CCNA 200-301 free course"
  - "Cisco Packet Tracer tutorial"
  - "Networking basics for beginners"

- **推荐频道**（需自行搜索验证）：
  - 搜索 "CCNA tutorial" 找到最新视频
  - 搜索 "Packet Tracer labs" 学习实验
  - 搜索 "OSI model explained" 理解基础概念

#### 4. **互动学习平台**
- **GNS3**：https://www.gns3.com/
  - 更真实的网络仿真
  - 可以运行真实的 Cisco IOS

- **EVE-NG**：https://www.eve-ng.net/
  - 专业级网络仿真平台
  - 适合进阶学习

### 📚 学习建议

1. **从本书开始** - 按章节顺序学习理论
2. **配合 Packet Tracer** - 每学完一章就做实验
3. **观看演示视频** - 遇到难点时搜索相关视频
4. **多做练习** - 使用 Packet Tracer 反复练习配置
5. **查阅官方文档** - 遇到不确定的命令时查官方资料

### 💡 学习重点

**对于零基础，重点掌握：**
- OSI 模型和 TCP/IP 协议栈
- IP 地址和子网划分
- 路由和交换基础
- 基本网络设备配置
- 网络故障排除

**⚠️ 注意**：避免使用 2018 年之前的教程（CCNA 200-125 版本），尽量选择 2020 年后的 CCNA 200-301 相关内容。但核心网络基础知识多年来变化不大，2018-2020 年的教程仍然有参考价值。

---

## 前言

欢迎来到 Cisco 网络世界！本书专为零基础读者设计，通过循序渐进的方式，带你从网络入门者成长为合格的网络工程师。

### 本书的特色

- **零基础友好**：无需任何网络背景，从最基础的概念开始
- **理论+实践**：深入讲解原理，配合大量实验和配置
- **循序渐进**：每个知识点都建立在之前的基础上
- **真实可靠**：所有命令和配置都经过验证，确保可用
- **实战导向**：包含完整的企业网络项目案例

### 如何使用本书

1. **按顺序学习**：建议从第1章开始，按顺序阅读
2. **动手实践**：每章都有实验，务必亲自操作
3. **完成练习**：每章末尾有练习题，检验学习成果
4. **查阅附录**：遇到问题时，可以查阅命令速查和故障排除

### 学习准备

- 一台安装了 Packet Tracer 或 GNS3 的电脑
- 一台 Cisco 路由器或交换机（可选）
- 好奇心和学习热情！

---

## 目录

### 第一部分：网络基础篇
- [第1章：网络基础概念](#第1章网络基础概念)
- [第2章：OSI 模型与 TCP/IP 协议栈](#第2章osi-模型与-tcpip-协议栈)
- [第3章：网络设备与线缆](#第3章网络设备与线缆)

### 第二部分：路由技术篇
- [第4章：IP 地址与子网划分](#第4章ip-地址与子网划分)
- [第5章：静态路由与默认路由](#第5章静态路由与默认路由)
- [第6章：动态路由协议](#第6章动态路由协议)

### 第三部分：交换技术篇
- [第7章：交换机基础与 VLAN](#第7章交换机基础与-vlan)
- [第8章：生成树协议 (STP)](#第8章生成树协议-stp)
- [第9章：EtherChannel 与高级交换技术](#第9章etherchannel-与高级交换技术)

### 第四部分：安全与优化篇
- [第10章：访问控制列表 (ACL)](#第10章访问控制列表-acl)
- [第11章：NAT 与网络安全](#第11章nat-与网络安全)
- [第12章：DHCP、DNS 与网络服务](#第12章dhcpdns-与网络服务)

### 第五部分：高级主题篇
- [第13章：IPv6 基础](#第13章ipv6-基础)
- [第14章：无线网络](#第14章无线网络)
- [第15章：网络自动化与 SDN](#第15章网络自动化与-sdn)

### 第六部分：实战项目篇
- [第16章：企业网络设计案例](#第16章企业网络设计案例)
- [第17章：网络故障排除](#第17章网络故障排除)
- [第18章：综合实验项目](#第18章综合实验项目)

### 第七部分：CCIE 进阶篇
- [第19章：CCIE 路由与交换深入](#第19章ccie-路由与交换深入)
- [第20章：CCIE 服务提供商技术](#第20章ccie-服务提供商技术)
- [第21章：CCIE 数据中心技术](#第21章ccie-数据中心技术)

### 第八部分：前沿技术篇
- [第22章：网络自动化实践](#第22章网络自动化实践)
- [第23章：云网络集成](#第23章云网络集成)
- [第24章：容器网络](#第24章容器网络)
- [第25章：SD-WAN 深入](#第25章sd-wan-深入)
- [第26章：网络安全深度分析](#第26章网络安全深度分析)
- [第27章：网络监控与分析](#第27章网络监控与分析)

### 第九部分：认证考试篇
- [第28章：CCNA 考试指南](#第28章ccna-考试指南)
- [第29章：CCNP 考试指南](#第29章ccnp-考试指南)
- [第30章：CCIE 考试指南](#第30章ccie-考试指南)

### 附录
- [附录 A：常用命令速查表](#附录-a常用命令速查表)
- [附录 B：常见问题解答](#附录-b常见问题解答)
- [附录 C：实验环境搭建指南](#附录-c实验环境搭建指南)
- [附录 D：考试模拟题](#附录-d考试模拟题)

---

# 第一部分：网络基础篇

## 第1章：网络基础概念

### 1.1 什么是网络？

**网络**是指两台或多台计算机通过通信设备连接起来，实现资源共享和信息传递的系统。

想象一下：
- 你在家里用手机连接 Wi-Fi 看视频
- 在办公室通过局域网访问共享文件
- 通过互联网浏览网页、发送邮件

这些都是网络的例子！

### 1.2 网络的类型

#### 按地理范围分类

**1. 局域网 (LAN - Local Area Network)**
- 覆盖范围：通常在几公里内
- 应用场景：家庭、办公室、学校
- 特点：速度快、成本低、易于管理

**示例**：你家中的 Wi-Fi 网络，连接了手机、电脑、电视等设备。

**2. 城域网 (MAN - Metropolitan Area Network)**
- 覆盖范围：一个城市或大都市区域
- 应用场景：城市范围内的网络互联
- 特点：速度较快、覆盖面广

**示例**：有线电视网络、城市宽带网络。

**3. 广域网 (WAN - Wide Area Network)**
- 覆盖范围：跨越城市、国家甚至全球
- 应用场景：跨国公司、互联网
- 特点：覆盖广、速度相对较慢、成本高

**示例**：互联网就是最大的广域网。

#### 按拓扑结构分类

**1. 星型拓扑**
```
        中心设备
      /   |   \
    设备A 设备B 设备C
```
- 所有设备都连接到中心设备
- 优点：易于管理、故障隔离
- 缺点：中心设备故障会影响整个网络

**2. 总线型拓扑**
```
设备A --- 线缆 --- 设备B --- 线缆 --- 设备C
```
- 所有设备连接到同一条线缆
- 优点：成本低、布线简单
- 缺点：故障难定位、扩展性差

**3. 环型拓扑**
```
设备A
  |   \
设备B---设备C
```
- 设备首尾相连形成环
- 优点：数据传输有序
- 缺点：一个节点故障会影响整个网络

### 1.3 网络设备介绍

#### 路由器 (Router)

**作用**：连接不同的网络，选择最佳路径转发数据包

**比喻**：就像快递公司的分拣中心，根据收件地址选择最佳路线。

**功能**：
- 路由选择：决定数据包的传输路径
- 网络地址转换 (NAT)
- 数据包过滤和安全
- 连接不同类型的网络

**标识**：通常有多个以太网口和串口

#### 交换机 (Switch)

**作用**：连接局域网内的设备，根据 MAC 地址转发数据帧

**比喻**：就像办公室的电话交换机，将电话连接到正确的分机。

**功能**：
- MAC 地址学习：记录设备的 MAC 地址
- 数据帧转发：根据 MAC 地址转发数据
- VLAN 划分：逻辑划分网络
- 端口安全：控制设备接入

**标识**：有多个以太网口（通常 24 口或 48 口）

#### 集线器 (Hub)

**作用**：简单的物理层设备，将接收到的信号广播到所有端口

**比喻**：就像一个多孔插座，所有设备共享同一条线路。

**缺点**：
- 不智能：广播所有数据
- 安全性差：所有设备都能看到所有数据
- 效率低：容易产生冲突

**注意**：现代网络中已很少使用，被交换机取代。

#### 网桥 (Bridge)

**作用**：连接两个网络段，过滤和转发数据帧

**比喻**：就像连接两个房间的门，控制两个房间之间的通行。

**功能**：
- 分割碰撞域
- 学习 MAC 地址
- 过滤不必要的流量

**注意**：现代网络中，交换机已经取代了网桥的功能。

### 1.4 数据传输基础

#### 什么是数据？

在计算机网络中，数据是以**二进制**形式（0 和 1）传输的。

**示例**：
- 字符 'A' 在计算机中是 `01000001`
- 一张图片由数百万个 0 和 1 组成
- 一段视频由连续的数据流组成

#### 数据传输单位

| 单位 | 缩写 | 大小 | 说明 |
|------|------|------|------|
| 比特 | bit | 最小单位 | 一个 0 或 1 |
| 字节 | Byte | 8 bit | 一个字符 |
| 千字节 | KB | 1024 Byte | |
| 兆字节 | MB | 1024 KB | |
| 吉字节 | GB | 1024 MB | |
| 太字节 | TB | 1024 GB | |

**带宽单位**：
- bps (bits per second)：比特每秒
- Kbps：千比特每秒 (1000 bps)
- Mbps：兆比特每秒 (1000 Kbps)
- Gbps：吉比特每秒 (1000 Mbps)

**注意**：网络带宽通常用 bps（小写 b），文件大小用 Byte（大写 B）。

#### 数据传输方式

**1. 单工 (Simplex)**
- 数据只能单向传输
- 示例：广播电台、电视广播

**2. 半双工 (Half-Duplex)**
- 数据可以双向传输，但不能同时
- 示例：对讲机

**3. 全双工 (Full-Duplex)**
- 数据可以同时双向传输
- 示例：电话、现代网络

### 1.5 网络性能指标

#### 带宽 (Bandwidth)

**定义**：网络的数据传输能力

**单位**：bps、Kbps、Mbps、Gbps

**示例**：
- 家庭宽带：100 Mbps
- 企业网络：1 Gbps
- 数据中心：10 Gbps 或更高

#### 延迟 (Latency)

**定义**：数据从源到目的所需的时间

**单位**：毫秒 (ms)

**类型**：
- 传播延迟：信号在介质中传播的时间
- 传输延迟：发送数据所需的时间
- 处理延迟：设备处理数据的时间
- 排队延迟：数据在队列中等待的时间

**示例**：
- 局域网延迟：< 1 ms
- 国内网络延迟：10-50 ms
- 国际网络延迟：100-300 ms

#### 吞吐量 (Throughput)

**定义**：实际的数据传输速率

**注意**：吞吐量通常低于理论带宽，受多种因素影响。

#### 丢包率 (Packet Loss)

**定义**：丢失的数据包占总数据包的百分比

**影响**：丢包会导致网络性能下降，严重时无法通信。

**正常值**：< 1%

#### 抖动 (Jitter)

**定义**：延迟的变化程度

**影响**：对实时应用（如视频通话、在线游戏）影响较大。

### 1.6 网络通信模型

#### 客户端-服务器模型 (Client-Server)

**工作原理**：
- 客户端：请求服务的一方
- 服务器：提供服务的一方

**示例**：
- 你访问网站（客户端）→ 服务器返回网页（服务器）
- 你收发邮件（客户端）→ 邮件服务器处理（服务器）

**优点**：
- 集中管理
- 安全性高
- 资源共享

#### 对等网络模型 (Peer-to-Peer, P2P)

**工作原理**：
- 每个节点既是客户端又是服务器
- 节点之间直接通信

**示例**：
- BitTorrent 下载
- 区块链网络

**优点**：
- 去中心化
- 可扩展性强
- 成本低

### 1.7 本章实验

#### 实验 1-1：认识网络设备

**实验目的**：了解网络设备的外观和接口

**实验设备**：
- Cisco 路由器 1 台
- Cisco 交换机 1 台
- Console 线 1 根
- 网线若干

**实验步骤**：

1. **观察路由器**
   - 查看路由器的前面板和后面板
   - 识别各种接口：
     - Console 端口（蓝色，用于配置）
     - 以太网口（FastEthernet 或 GigabitEthernet）
     - 串口（Serial，用于 WAN 连接）
   - 查看指示灯：
     - SYS：系统状态
     - 接口指示灯：链路状态、活动状态

2. **观察交换机**
   - 查看交换机的前面板和后面板
   - 识别各种接口：
     - Console 端口
     - 以太网口（通常 24 或 48 个）
     - 上行端口（高带宽）
   - 查看指示灯：
     - Power：电源状态
     - 每个端口的指示灯

3. **连接 Console 线**
   - 将 Console 线的一端连接到路由器的 Console 端口
   - 将另一端（USB 或串口）连接到电脑
   - 打开终端软件（如 PuTTY、SecureCRT）
   - 配置串口参数：
     - 波特率：9600
     - 数据位：8
     - 停止位：1
     - 校验位：无
     - 流控：无

4. **查看设备信息**
   ```
   Router> enable
   Router# show version
   Router# show ip interface brief
   Router# show running-config
   ```

**实验验证**：
- 成功连接到设备
- 能够查看设备的基本信息
- 理解各个接口的作用

### 1.8 本章小结

本章介绍了网络的基础概念：

**核心知识点**：
- 网络的定义和类型（LAN、MAN、WAN）
- 网络设备（路由器、交换机、集线器、网桥）
- 数据传输基础（二进制、传输单位、传输方式）
- 网络性能指标（带宽、延迟、吞吐量、丢包率、抖动）
- 网络通信模型（客户端-服务器、P2P）

**重点记忆**：
- 路由器连接不同网络，交换机连接局域网设备
- 带宽单位是 bps（小写 b），文件单位是 Byte（大写 B）
- 全双工可以同时双向传输，半双工不能同时传输
- 客户端-服务器是集中式管理，P2P 是去中心化

### 1.9 练习题

#### 选择题

1. 以下哪个设备用于连接不同的网络？
   - A. 交换机
   - B. 路由器
   - C. 集线器
   - D. 网桥

2. 1 Mbps 等于多少 Kbps？
   - A. 100 Kbps
   - B. 512 Kbps
   - C. 1000 Kbps
   - D. 1024 Kbps

3. 以下哪个是广域网的缩写？
   - A. LAN
   - B. MAN
   - C. WAN
   - D. PAN

4. 数据可以同时双向传输的通信方式是？
   - A. 单工
   - B. 半双工
   - C. 全双工
   - D. 以上都不是

5. 路由器的主要功能是什么？
   - A. 连接局域网设备
   - B. 连接不同网络并选择路径
   - C. 放大信号
   - D. 转换数据格式

#### 填空题

1. 局域网的英文缩写是 ________。

2. 1 Byte 等于 ________ bit。

3. 路由器根据 ________ 地址选择路径，交换机根据 ________ 地址转发数据。

4. 数据传输的三种方式是 ________、________ 和 ________。

5. 带宽的单位是 ________，文件大小的单位是 ________。

#### 简答题

1. 简述路由器和交换机的区别。

2. 什么是带宽？什么是吞吐量？它们有什么区别？

3. 解释客户端-服务器模型和对等网络模型的区别。

4. 列举至少三个网络性能指标，并解释它们的含义。

#### 实验题

1. 使用 Packet Tracer 创建一个简单的网络拓扑：
   - 1 台路由器
   - 1 台交换机
   - 2 台 PC
   - 配置 IP 地址并测试连通性

### 1.10 参考答案

#### 选择题

1. B
2. C
3. C
4. C
5. B

#### 填空题

1. LAN
2. 8
3. IP，MAC
4. 单工，半双工，全双工
5. bps，Byte

#### 简答题

1. 路由器连接不同的网络，根据 IP 地址选择最佳路径转发数据包；交换机连接局域网内的设备，根据 MAC 地址转发数据帧。

2. 带宽是网络的理论传输能力，通常用 bps 表示；吞吐量是实际的数据传输速率。吞吐量通常低于理论带宽，受网络状况、设备性能等因素影响。

3. 客户端-服务器模型是集中式的，客户端请求服务，服务器提供服务；对等网络模型是去中心化的，每个节点既是客户端又是服务器，节点之间直接通信。

4. 带宽：网络的数据传输能力；延迟：数据从源到目的所需的时间；吞吐量：实际的数据传输速率；丢包率：丢失的数据包占总数据包的百分比；抖动：延迟的变化程度。

---

## 第2章：OSI 模型与 TCP/IP 协议栈

### 2.1 为什么需要分层模型？

想象一下，如果你要建造一栋大楼，你会怎么做？

**没有分层**：
- 一个人负责所有事情：设计、施工、装修、水电...
- 效率低、易出错、难以维护

**有分层**：
- 建筑师负责设计
- 建筑工人负责施工
- 水电工负责水电
- 装修工负责装修
- 每层专注于自己的工作，互相配合

网络通信也是如此！**分层模型**让网络通信变得：
- **模块化**：每层独立工作
- **可维护**：修改一层不影响其他层
- **标准化**：不同厂商的设备可以互相通信
- **易于理解**：复杂问题分解为简单问题

### 2.2 OSI 七层模型

OSI（Open Systems Interconnection）模型是国际标准化组织（ISO）提出的网络通信参考模型，将网络通信分为 7 层。

#### 七层结构

```
应用层 (Application Layer)    - 第7层
表示层 (Presentation Layer)   - 第6层
会话层 (Session Layer)        - 第5层
传输层 (Transport Layer)      - 第4层
网络层 (Network Layer)        - 第3层
数据链路层 (Data Link Layer)  - 第2层
物理层 (Physical Layer)       - 第1层
```

#### 各层详解

**第7层：应用层 (Application Layer)**

**作用**：为应用程序提供网络服务接口

**功能**：
- 用户接口
- 文件传输
- 电子邮件
- 网页浏览

**协议**：
- HTTP/HTTPS：网页浏览
- FTP：文件传输
- SMTP/POP3/IMAP：电子邮件
- DNS：域名解析
- Telnet/SSH：远程登录

**比喻**：餐厅的服务员，直接与顾客（用户）打交道。

**第6层：表示层 (Presentation Layer)**

**作用**：数据的格式化、加密和解密

**功能**：
- 数据格式转换
- 数据加密和解密
- 数据压缩和解压缩

**协议**：
- SSL/TLS：安全传输
- JPEG/GIF：图像格式
- MPEG：视频格式

**比喻**：餐厅的翻译官，将菜单翻译成顾客能理解的语言。

**第5层：会话层 (Session Layer)**

**作用**：建立、管理和终止会话

**功能**：
- 会话建立
- 会话维持
- 会话终止
- 同步和恢复

**协议**：
- RPC：远程过程调用
- NetBIOS：网络基本输入/输出系统

**比喻**：餐厅的领班，负责安排座位和管理服务流程。

**第4层：传输层 (Transport Layer)**

**作用**：提供端到端的可靠或不可靠传输

**功能**：
- 分段和重组
- 端口寻址
- 流量控制
- 拥塞控制
- 差错控制

**协议**：
- TCP：可靠的、面向连接的传输
- UDP：不可靠的、无连接的传输

**比喻**：餐厅的送餐员，确保菜品送到正确的餐桌。

**第3层：网络层 (Network Layer)**

**作用**：路径选择和逻辑寻址

**功能**：
- 路由选择
- IP 地址分配
- 数据包转发
- 路径优化

**协议**：
- IP：网际协议
- ICMP：互联网控制消息协议
- ARP：地址解析协议
- OSPF、RIP、EIGRP、BGP：路由协议

**比喻**：餐厅的外卖配送员，根据地址选择最佳路线。

**第2层：数据链路层 (Data Link Layer)**

**作用**：物理寻址和可靠传输

**功能**：
- MAC 地址寻址
- 帧的封装和解封装
- 错误检测
- 流量控制

**协议**：
- Ethernet：以太网
- PPP：点对点协议
- HDLC：高级数据链路控制

**设备**：
- 交换机
- 网桥
- 网卡

**比喻**：餐厅的传菜员，在厨房内部传递菜品。

**第1层：物理层 (Physical Layer)**

**作用**：比特流的传输

**功能**：
- 定义电气特性
- 定义机械特性
- 定义功能特性
- 定义规程特性

**标准**：
- RJ-45：网线接口
- 光纤：光传输
- 无线电波：无线传输

**设备**：
- 集线器
- 中继器
- 网线、光纤

**比喻**：餐厅的厨房，负责实际的烹饪工作。

#### 数据在各层的封装

当数据从应用层发送到物理层时，每层都会添加自己的头部（和尾部）：

```
应用层：数据
表示层：表示层头部 + 数据
会话层：会话层头部 + 表示层头部 + 数据
传输层：传输层头部 + 会话层头部 + 表示层头部 + 数据
网络层：网络层头部 + 传输层头部 + 会话层头部 + 表示层头部 + 数据
数据链路层：数据链路层头部 + 网络层头部 + 传输层头部 + 会话层头部 + 表示层头部 + 数据 + 数据链路层尾部
物理层：将数据链路层帧转换为比特流
```

**封装过程**：
- 数据 → 段 (Segment) → 数据包 (Packet) → 帧 (Frame) → 比特 (Bits)

**解封装过程**（接收端）：
- 比特 → 帧 → 数据包 → 段 → 数据

### 2.3 TCP/IP 协议栈

TCP/IP 协议栈是实际使用的网络协议模型，与 OSI 模型相比更加简洁实用。

#### 四层结构

```
应用层 (Application Layer)    - 对应 OSI 第5-7层
传输层 (Transport Layer)      - 对应 OSI 第4层
互联网层 (Internet Layer)     - 对应 OSI 第3层
网络接口层 (Network Interface Layer) - 对应 OSI 第1-2层
```

#### 各层详解

**应用层**

**作用**：为应用程序提供网络服务

**协议**：
- HTTP/HTTPS：网页浏览
- FTP：文件传输
- SMTP/POP3/IMAP：电子邮件
- DNS：域名解析
- Telnet/SSH：远程登录
- SNMP：网络管理

**传输层**

**作用**：提供端到端的传输服务

**协议**：
- TCP (Transmission Control Protocol)：可靠的、面向连接的传输
- UDP (User Datagram Protocol)：不可靠的、无连接的传输

**互联网层**

**作用**：负责数据包的路由和转发

**协议**：
- IP (Internet Protocol)：网际协议
- ICMP (Internet Control Message Protocol)：互联网控制消息协议
- ARP (Address Resolution Protocol)：地址解析协议
- RARP (Reverse Address Resolution Protocol)：反向地址解析协议

**网络接口层**

**作用**：负责数据帧的传输

**协议**：
- Ethernet：以太网
- PPP：点对点协议
- SLIP：串行线路网际协议

#### OSI 与 TCP/IP 的对应关系

| OSI 模型 | TCP/IP 模型 | 数据单元 |
|----------|-------------|----------|
| 应用层 | 应用层 | 数据 |
| 表示层 | 应用层 | 数据 |
| 会话层 | 应用层 | 数据 |
| 传输层 | 传输层 | 段 (Segment) |
| 网络层 | 互联网层 | 数据包 (Packet) |
| 数据链路层 | 网络接口层 | 帧 (Frame) |
| 物理层 | 网络接口层 | 比特 (Bits) |

### 2.4 重要协议详解

#### TCP (Transmission Control Protocol)

**特性**：
- 面向连接：建立连接后才能传输数据
- 可靠传输：确认机制、重传机制
- 流量控制：滑动窗口机制
- 拥塞控制：慢启动、拥塞避免
- 有序传输：数据按顺序到达

**三次握手建立连接**：

```
客户端                              服务器
  |                                   |
  |--- SYN, seq=x ------------------->|  (1)
  |                                   |
  |<--- SYN, ACK, seq=y, ack=x+1 -----|  (2)
  |                                   |
  |--- ACK, seq=x+1, ack=y+1 -------->|  (3)
  |                                   |
  |        连接建立完成                |
```

**步骤说明**：
1. 客户端发送 SYN 包（seq=x），请求建立连接
2. 服务器回复 SYN+ACK 包（seq=y, ack=x+1），确认收到并请求建立连接
3. 客户端回复 ACK 包（seq=x+1, ack=y+1），确认收到
4. 连接建立完成

**四次挥手断开连接**：

```
客户端                              服务器
  |                                   |
  |--- FIN, seq=u -------------------->|  (1)
  |                                   |
  |<--- ACK, seq=v, ack=u+1 -----------|  (2)
  |                                   |
  |<--- FIN, seq=w --------------------|  (3)
  |                                   |
  |--- ACK, seq=u+1, ack=w+1 -------->|  (4)
  |                                   |
  |        连接断开完成                |
```

**TCP 头部格式**：

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |       Destination Port        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Acknowledgment Number                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Data |           |U|A|P|R|S|F|                               |
| Offset| Reserved  |R|C|S|S|Y|I|            Window             |
|       |           |G|K|H|T|N|N|                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Checksum            |         Urgent Pointer        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             data                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**关键字段**：
- Source Port：源端口号（16 位）
- Destination Port：目的端口号（16 位）
- Sequence Number：序列号（32 位）
- Acknowledgment Number：确认号（32 位）
- Flags：标志位（SYN、ACK、FIN、RST 等）
- Window：窗口大小（16 位）

**常用端口号**：
- HTTP：80
- HTTPS：443
- FTP：20（数据）、21（控制）
- SSH：22
- Telnet：23
- SMTP：25
- DNS：53
- POP3：110
- IMAP：143

#### UDP (User Datagram Protocol)

**特性**：
- 无连接：不需要建立连接
- 不可靠：不保证数据到达
- 低开销：头部简单（8 字节）
- 适用于实时应用

**UDP 头部格式**：

```
 0      7 8     15 16    23 24    31
+--------+--------+--------+--------+
|     Source      |   Destination   |
|      Port       |      Port       |
+--------+--------+--------+--------+
|                 |                 |
|     Length      |    Checksum     |
+--------+--------+--------+--------+
|                                   |
|              Data ...             |
|                                   |
+-----------------------------------+
```

**关键字段**：
- Source Port：源端口号（16 位）
- Destination Port：目的端口号（16 位）
- Length：UDP 数据长度（16 位）
- Checksum：校验和（16 位）

**应用场景**：
- DNS 查询
- 视频流
- 在线游戏
- VoIP

#### IP (Internet Protocol)

**作用**：负责数据包的路由和转发

**IP 地址格式**：
- IPv4：32 位，点分十进制（如 192.168.1.1）
- IPv6：128 位，冒号分隔十六进制（如 2001:db8::1）

**IP 头部格式**：

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |         Header Checksum       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**关键字段**：
- Version：IP 版本（IPv4 为 4）
- IHL：头部长度（以 4 字节为单位）
- Type of Service：服务类型
- Total Length：总长度（包括头部和数据）
- Identification：标识符
- Flags：标志位（DF、MF）
- Fragment Offset：分片偏移
- Time to Live (TTL)：生存时间
- Protocol：上层协议（TCP=6, UDP=17, ICMP=1）
- Header Checksum：头部校验和
- Source Address：源 IP 地址
- Destination Address：目的 IP 地址

#### ICMP (Internet Control Message Protocol)

**作用**：用于传递错误信息和控制消息

**常见 ICMP 消息类型**：
- Echo Request (Type 8)：回显请求（ping）
- Echo Reply (Type 0)：回显回复（pong）
- Destination Unreachable (Type 3)：目的不可达
- Time Exceeded (Type 11)：超时
- Redirect (Type 5)：重定向

**Ping 命令**：
```bash
# 发送 ICMP Echo Request
ping 192.168.1.1

# 指定发送次数
ping -c 4 192.168.1.1

# 指定数据包大小
ping -s 1000 192.168.1.1
```

#### ARP (Address Resolution Protocol)

**作用**：将 IP 地址解析为 MAC 地址

**工作原理**：

```
主机 A (IP: 192.168.1.2) 想要发送数据给主机 B (IP: 192.168.1.3)

1. 主机 A 检查自己的 ARP 缓存表，是否有主机 B 的 MAC 地址
2. 如果没有，主机 A 发送 ARP 请求广播：
   "谁是 192.168.1.3？请告诉我你的 MAC 地址"
3. 主机 B 收到 ARP 请求，回复 ARP 单播：
   "我是 192.168.1.3，我的 MAC 地址是 00:11:22:33:44:55"
4. 主机 A 收到 ARP 回复，将主机 B 的 IP 和 MAC 地址存入 ARP 缓存
5. 主机 A 可以使用 MAC 地址发送数据帧
```

**ARP 命令**：
```bash
# 查看 ARP 缓存表
show ip arp

# 清除 ARP 缓存
clear ip arp

# 手动添加 ARP 条目
arp -s 192.168.1.3 00:11:22:33:44:55
```

**ARP 缓存表**：
```
Protocol  Address          Age (min)  Hardware Addr   Type   Interface
Internet  192.168.1.1      0         00:11:22:33:44:55  ARPA   GigabitEthernet0/0
Internet  192.168.1.2      10        00:aa:bb:cc:dd:ee  ARPA   GigabitEthernet0/0
```

### 2.5 数据传输过程

#### 完整的数据传输流程

假设主机 A (192.168.1.2) 要发送数据给主机 B (192.168.1.3)：

**1. 应用层**
- 应用程序生成数据（如 HTTP 请求）

**2. 传输层**
- TCP 添加头部（源端口、目的端口、序列号等）
- 数据变成 TCP 段

**3. 网络层**
- IP 添加头部（源 IP、目的 IP、TTL 等）
- 数据变成 IP 数据包

**4. 数据链路层**
- 查找 ARP 缓存，获取目的 MAC 地址
- 添加帧头（源 MAC、目的 MAC、类型）和帧尾（FCS）
- 数据变成以太网帧

**5. 物理层**
- 将帧转换为比特流
- 通过网线发送

**6. 接收端（主机 B）**
- 物理层接收比特流，转换为帧
- 数据链路层检查帧，移除帧头帧尾，提取数据包
- 网络层检查 IP 头部，移除 IP 头部，提取段
- 传输层检查 TCP 头部，移除 TCP 头部，提取数据
- 应用层接收数据

#### 跨网段传输

如果主机 A 和主机 B 在不同的网段，需要通过路由器：

```
主机 A (192.168.1.2) → 路由器 (192.168.1.1, 192.168.2.1) → 主机 B (192.168.2.2)

1. 主机 A 发送数据给路由器（目的 MAC 是路由器的 MAC）
2. 路由器接收数据，检查 IP 头部
3. 路由器查找路由表，确定下一跳
4. 路由器重新封装数据帧（目的 MAC 是下一跳的 MAC）
5. 数据继续传输，直到到达主机 B
```

### 2.6 本章实验

#### 实验 2-1：使用 Wireshark 抓包分析协议

**实验目的**：观察和分析网络协议的实际数据包

**实验设备**：
- 安装了 Wireshark 的电脑
- 网络连接

**实验步骤**：

1. **安装 Wireshark**
   - 下载 Wireshark：https://www.wireshark.org/
   - 安装并启动 Wireshark

2. **选择网络接口**
   - 在 Wireshark 主界面，选择要抓包的网络接口
   - 点击"开始抓包"

3. **生成网络流量**
   - 打开浏览器，访问一个网站（如 www.baidu.com）
   - 打开命令行，执行 ping 命令：
   ```bash
   ping www.baidu.com
   ```

4. **分析抓到的数据包**

   **分析 ICMP 数据包**：
   - 在过滤器中输入：`icmp`
   - 查看 ICMP Echo Request 和 Echo Reply
   - 观察 ICMP 头部字段

   **分析 TCP 数据包**：
   - 在过滤器中输入：`tcp.port == 80`
   - 查看 TCP 三次握手过程
   - 观察 TCP 头部字段（序列号、确认号、标志位等）

   **分析 HTTP 数据包**：
   - 在过滤器中输入：`http`
   - 查看 HTTP 请求和响应
   - 观察 HTTP 头部和内容

5. **保存抓包结果**
   - 文件 → 保存
   - 选择保存格式（如 pcapng）

**实验验证**：
- 成功抓到 ICMP、TCP、HTTP 数据包
- 能够识别各层协议的头部字段
- 理解数据封装和解封装过程

#### 实验 2-2：查看 ARP 缓存表

**实验目的**：观察 ARP 协议的工作过程

**实验设备**：
- Cisco 路由器或交换机
- PC 终端

**实验步骤**：

1. **查看 ARP 缓存表**
   ```bash
   Router# show ip arp
   Protocol  Address          Age (min)  Hardware Addr   Type   Interface
   Internet  192.168.1.1      0         00:11:22:33:44:55  ARPA   GigabitEthernet0/0
   Internet  192.168.1.2      10        00:aa:bb:cc:dd:ee  ARPA   GigabitEthernet0/0
   ```

2. **清除 ARP 缓存**
   ```bash
   Router# clear ip arp
   ```

3. **触发 ARP 请求**
   ```bash
   Router# ping 192.168.1.2
   ```

4. **再次查看 ARP 缓存**
   ```bash
   Router# show ip arp
   ```

5. **使用 debug 观察 ARP 过程**
   ```bash
   Router# debug arp
   Router# ping 192.168.1.2
   ```

**实验验证**：
- 能够查看 ARP 缓存表
- 理解 ARP 请求和回复过程
- 观察 ARP 缓存的老化和更新

#### 实验 2-3：测试 TCP 连接

**实验目的**：观察 TCP 三次握手和四次挥手

**实验设备**：
- 安装了 Wireshark 的电脑
- 网络连接

**实验步骤**：

1. **启动 Wireshark 抓包**
   - 选择网络接口
   - 开始抓包

2. **建立 TCP 连接**
   - 打开命令行，执行：
   ```bash
   telnet www.baidu.com 80
   ```

3. **分析三次握手**
   - 在 Wireshark 过滤器中输入：`tcp.flags.syn == 1`
   - 观察 SYN、SYN-ACK、ACK 三个数据包
   - 查看序列号和确认号的变化

4. **断开 TCP 连接**
   - 在 telnet 会话中输入：`quit`

5. **分析四次挥手**
   - 在 Wireshark 过滤器中输入：`tcp.flags.fin == 1`
   - 观察 FIN、ACK、FIN、ACK 四个数据包

**实验验证**：
- 成功观察到 TCP 三次握手
- 成功观察到 TCP 四次挥手
- 理解序列号和确认号的作用

### 2.7 本章小结

本章介绍了 OSI 模型和 TCP/IP 协议栈：

**核心知识点**：
- OSI 七层模型及其功能
- TCP/IP 四层模型及其与 OSI 的对应关系
- TCP 和 UDP 的区别和应用场景
- IP 地址和 IP 协议
- ICMP 和 ARP 协议
- 数据封装和解封装过程
- 完整的数据传输流程

**重点记忆**：
- OSI 七层：应用、表示、会话、传输、网络、数据链路、物理
- TCP 是可靠的、面向连接的；UDP 是不可靠的、无连接的
- TCP 三次握手建立连接，四次挥手断开连接
- ARP 将 IP 地址解析为 MAC 地址
- ICMP 用于错误报告和诊断（如 ping）
- 数据从应用层到物理层是封装，从物理层到应用层是解封装

### 2.8 练习题

#### 选择题

1. OSI 模型的第几层负责端到端的可靠传输？
   - A. 网络层
   - B. 传输层
   - C. 会话层
   - D. 应用层

2. 以下哪个协议是可靠的、面向连接的？
   - A. UDP
   - B. TCP
   - C. IP
   - D. ICMP

3. ARP 协议的作用是什么？
   - A. 将 IP 地址解析为 MAC 地址
   - B. 将 MAC 地址解析为 IP 地址
   - C. 路由选择
   - D. 错误报告

4. TCP 三次握手过程中，第二次握手发送的数据包包含哪些标志位？
   - A. SYN
   - B. SYN, ACK
   - C. ACK
   - D. FIN, ACK

5. ICMP 协议的 Echo Request 消息类型号是？
   - A. 0
   - B. 3
   - C. 8
   - D. 11

#### 填空题

1. OSI 模型共有 ________ 层，TCP/IP 模型共有 ________ 层。

2. TCP 是 ________ 传输协议，UDP 是 ________ 传输协议。

3. ARP 协议将 ________ 地址解析为 ________ 地址。

4. TCP 建立连接需要 ________ 次握手，断开连接需要 ________ 次挥手。

5. IP 地址的长度是 ________ 位，IPv6 地址的长度是 ________ 位。

#### 简答题

1. 简述 OSI 七层模型各层的主要功能。

2. 比较 TCP 和 UDP 的区别，并说明它们的应用场景。

3. 解释 ARP 协议的工作原理。

4. 描述数据从应用层到物理层的封装过程。

5. 什么是 TCP 三次握手？为什么需要三次握手？

#### 实验题

1. 使用 Wireshark 抓包，分析一次完整的 HTTP 请求过程，包括 TCP 三次握手、HTTP 请求和响应、TCP 四次挥手。

2. 在 Cisco 路由器上配置 IP 地址，使用 ping 命令测试连通性，并观察 ARP 缓存表的变化。

### 2.9 参考答案

#### 选择题

1. B
2. B
3. A
4. B
5. C

#### 填空题

1. 7，4
2. 可靠的、面向连接的，不可靠的、无连接的
3. IP，MAC
4. 3，4
5. 32，128

#### 简答题

1. 应用层：为应用程序提供网络服务；表示层：数据格式化、加密；会话层：会话管理；传输层：端到端传输；网络层：路由选择；数据链路层：帧传输；物理层：比特流传输。

2. TCP 是可靠的、面向连接的，适用于需要可靠传输的应用（如网页浏览、文件传输）；UDP 是不可靠的、无连接的，适用于实时应用（如视频流、在线游戏）。

3. 主机发送 ARP 请求广播，询问某个 IP 地址对应的 MAC 地址；目标主机回复 ARP 单播，提供自己的 MAC 地址；发送主机将 IP 和 MAC 地址存入 ARP 缓存。

4. 应用层数据 → 传输层添加头部（段）→ 网络层添加头部（数据包）→ 数据链路层添加头部和尾部（帧）→ 物理层转换为比特流。

5. TCP 三次握手是建立 TCP 连接的过程：客户端发送 SYN，服务器回复 SYN+ACK，客户端回复 ACK。需要三次握手是为了确保双方都能接收和发送数据，防止已失效的连接请求报文段突然又传送到服务端。

---

## 第3章：网络设备与线缆

### 3.1 Cisco 设备概述

Cisco 是全球领先的网络设备制造商，其产品广泛应用于企业网络、数据中心、服务提供商网络等。

#### Cisco 设备类型

**1. 路由器 (Router)**
- ISR (Integrated Services Router)：集成服务路由器
  - 800/1900/2900/3900/4000 系列
  - 适用于中小企业和分支机构
- ASR (Aggregation Services Router)：汇聚服务路由器
  - 1000/9000 系列
  - 适用于大型企业和运营商
- CSR (Cloud Services Router)：云服务路由器
  - 1000V 系列
  - 虚拟化路由器

**2. 交换机 (Switch)**
- Catalyst 交换机
  - 2960/3560/3850/9300/9400 系列
  - 适用于园区网络
- Nexus 交换机
  - 3000/5000/7000/9000 系列
  - 适用于数据中心

**3. 无线设备**
- Aironet 接入点
- Wireless LAN Controller (WLC)

**4. 安全设备**
- ASA (Adaptive Security Appliance)：防火墙
- FirePOWER：下一代防火墙

#### Cisco 设备命名规则

以 Catalyst 交换机为例：

```
Catalyst 2960-X-48TS-L
  |      |    | | | |
  |      |    | | | +-- 特性代码（L=轻量级）
  |      |    | | +---- 电源类型（S=交流）
  |      |    | +------ 上行链路（T=双千兆）
  |      |    +-------- 端口数量（48）
  |      +-------------- 系列（X=增强版）
  +--------------------- 产品线（Catalyst）
```

### 3.2 路由器硬件组成

#### 路由器的主要组件

**1. CPU (Central Processing Unit)**
- 中央处理器，执行路由器的所有操作
- 负责路由计算、协议处理、数据转发等

**2. 内存**
- **ROM (Read-Only Memory)**：只读存储器
  - 存储引导程序（Bootstrap）
  - 存储微型 IOS（用于恢复）
  - 断电不丢失
- **Flash Memory**：闪存
  - 存储 IOS 镜像文件
  - 存储配置文件
  - 断电不丢失
- **NVRAM (Non-Volatile Random Access Memory)**：非易失性随机存取存储器
  - 存储启动配置（startup-config）
  - 断电不丢失
- **RAM (Random Access Memory)**：随机存取存储器
  - 存储运行配置（running-config）
  - 存储路由表、ARP 表等
  - 运行 IOS
  - 断电丢失

**3. 接口**
- **管理接口**：
  - Console：用于初始配置
  - AUX：用于远程管理（通过调制解调器）
- **网络接口**：
  - 以太网接口：FastEthernet、GigabitEthernet、TenGigabitEthernet
  - 串口：Serial，用于 WAN 连接
  - 子接口：逻辑接口，用于 VLAN 路由等

**4. 线路卡**
- 模块化路由器可插入不同的线路卡
- 提供各种接口类型和数量

#### 路由器启动过程

```
1. POST (Power-On Self Test)
   - 路由器开机，执行硬件自检
   - 检查 CPU、内存、接口等

2. 加载 Bootstrap
   - Bootstrap 程序从 ROM 加载
   - Bootstrap 负责加载 IOS

3. 查找 IOS
   - 按顺序查找 IOS：
     a. Flash
     b. TFTP 服务器
     c. ROM（微型 IOS）

4. 加载 IOS
   - IOS 加载到 RAM
   - IOS 开始运行

5. 查找配置文件
   - 查找 startup-config：
     a. NVRAM
     b. TFTP 服务器
     c. 进入设置模式

6. 加载配置
   - 如果找到 startup-config，加载到 RAM 成为 running-config
   - 如果没有找到，进入设置模式或使用默认配置

7. 路由器准备就绪
   - 显示提示符：Router>
```

### 3.3 交换机硬件组成

#### 交换机的主要组件

**1. CPU**
- 中央处理器，执行交换机的控制平面功能
- 负责协议处理、管理功能等

**2. 内存**
- **Flash**：存储 IOS 镜像和配置文件
- **RAM**：存储运行配置、MAC 地址表、VLAN 数据库等
- **NVRAM**：存储启动配置

**3. 接口**
- **管理接口**：
  - Console：用于初始配置
  - 管理以太网口：用于远程管理
- **网络接口**：
  - 以太网口：FastEthernet、GigabitEthernet
  - 上行端口：高带宽端口
  - 堆叠端口：用于交换机堆叠

**4. 交换矩阵 (Switching Fabric)**
- 负责数据平面的高速转发
- 可以是总线、交叉矩阵或共享内存

**5. 电源**
- 内置电源或外接电源
- 可冗余配置

#### 交换机转发方式

**1. 存储转发 (Store-and-Forward)**
- 接收完整帧，检查 FCS，然后转发
- 优点：错误检测
- 缺点：延迟较高

**2. 直通转发 (Cut-Through)**
- 接收到帧头后立即转发
- 优点：延迟低
- 缺点：不检查错误

**3. 无分片转发 (Fragment-Free)**
- 接收到前 64 字节后转发（避免碰撞帧）
- 优点：平衡延迟和错误检测

### 3.4 网络线缆

#### 铜缆

**1. 双绞线 (Twisted Pair)**
- **UTP (Unshielded Twisted Pair)**：非屏蔽双绞线
  - Cat5：100 Mbps
  - Cat5e：1 Gbps
  - Cat6：10 Gbps（短距离）
  - Cat6a：10 Gbps（100 米）
  - Cat7：10 Gbps（屏蔽）
- **STP (Shielded Twisted Pair)**：屏蔽双绞线
  - 抗干扰能力强
  - 成本较高

**双绞线类型**：
- **直通线 (Straight-Through)**：
  - 两端线序相同
  - 用途：不同类型设备连接（PC-交换机、路由器-交换机）
  - 线序：T568A 或 T568B

- **交叉线 (Crossover)**：
  - 两端线序交叉
  - 用途：相同类型设备连接（PC-PC、交换机-交换机、路由器-路由器）
  - 线序：一端 T568A，另一端 T568B

- **翻转线 (Rollover)**：
  - 一端线序完全反转
  - 用途：Console 线，连接 PC 和设备 Console 口

**T568B 线序**（常用）：
```
1  白绿
2  绿
3  白橙
4  蓝
5  白蓝
6  橙
7  白棕
8  棕
```

**T568A 线序**：
```
1  白绿
2  绿
3  白橙
4  蓝
5  白蓝
6  橙
7  白棕
8  棕
```

**注意**：现代设备支持 MDI/MDIX 自动识别，可以自动适应直通线和交叉线。

**2. 同轴电缆 (Coaxial Cable)**
- 用于早期的以太网（10BASE2、10BASE5）
- 现在主要用于有线电视

**3. 串口线缆**
- **V.35**：用于路由器串口连接
- **DB-60**：Cisco 专用串口接口
- **Smart Serial**：新型串口接口

#### 光纤

**1. 光纤类型**
- **单模光纤 (Single-Mode Fiber, SMF)**：
  - 传输距离长（可达 100 公里）
  - 使用激光光源
  - 成本高
  - 用于长距离传输

- **多模光纤 (Multi-Mode Fiber, MMF)**：
  - 传输距离短（通常 2 公里以内）
  - 使用 LED 光源
  - 成本低
  - 用于短距离传输

**2. 光纤接口**
- **SC (Subscriber Connector)**：方形接口
- **LC (Lucent Connector)**：小型方形接口
- **ST (Straight Tip)**：圆形接口
- **MPO/MTP**：多光纤接口

**3. 光纤跳线**
- **单模跳线**：黄色
- **多模跳线**：橙色或蓝色

**4. 光纤收发器 (SFP)**
- **SFP (Small Form-factor Pluggable)**：千兆光模块
- **SFP+**：万兆光模块
- **QSFP**：40G 光模块
- **QSFP28**：100G 光模块

#### 无线

**1. 无线频段**
- **2.4 GHz**：
  - 覆盖范围广
  - 速度较慢
  - 干扰较多
- **5 GHz**：
  - 覆盖范围小
  - 速度快
  - 干扰较少
- **6 GHz**：
  - 最新频段
  - 速度最快
  - 干扰最少

**2. 无线标准**
- **802.11b/g/n/ac/ax**

### 3.5 设备连接方式

#### 常见连接拓扑

**1. 星型拓扑**
```
        交换机
      /   |   \
    PC1  PC2  PC3
```
- 所有设备连接到中心交换机
- 最常用的拓扑

**2. 树型拓扑**
```
        核心交换机
           |
        汇聚交换机
       /   |   \
    交换机1 交换机2 交换机3
    / | \   / | \   / | \
  PC PC PC PC PC PC PC PC PC
```
- 分层结构
- 适用于大型网络

**3. 网状拓扑**
```
    路由器1
   /   |   \
路由器2 路由器3 路由器4
   \   |   /
    路由器5
```
- 高冗余性
- 适用于关键网络

#### 设备连接规则

**1. 路由器连接**
- 路由器-路由器：串口或以太网口
- 路由器-交换机：以太网口
- 路由器-PC：以太网口

**2. 交换机连接**
- 交换机-交换机：以太网口（级联或堆叠）
- 交换机-PC：以太网口
- 交换机-路由器：以太网口

**3. 线缆选择**
- 不同类型设备：直通线（或自动识别）
- 相同类型设备：交叉线（或自动识别）
- Console 连接：翻转线

### 3.6 本章实验

#### 实验 3-1：路由器硬件识别

**实验目的**：了解路由器的硬件组成和启动过程

**实验设备**：
- Cisco 路由器 1 台
- Console 线 1 根
- PC 1 台

**实验步骤**：

1. **连接 Console 线**
   - 将 Console 线的一端连接到路由器的 Console 端口
   - 将另一端（USB 或串口）连接到 PC
   - 打开终端软件（如 PuTTY）
   - 配置串口参数：
     - 波特率：9600
     - 数据位：8
     - 停止位：1
     - 校验位：无
     - 流控：无

2. **观察路由器启动过程**
   - 打开路由器电源
   - 观察启动信息：
   ```
   System Bootstrap, Version 12.4(13r)T, RELEASE SOFTWARE (fc1)
   Technical Support: http://www.cisco.com/techsupport
   Copyright (c) 2006 by cisco Systems, Inc.

   ROM: System Bootstrap, Version 12.4(13r)T, RELEASE SOFTWARE (fc1)

   Router uptime is 0 minutes
   System returned to ROM by power-on
   System image file is "flash:c1841-advsecurityk9-mz.124-15.T1.bin"

   Cisco 1841 (revision 6.0) with 114688K/16384K bytes of memory.
   Processor board ID FHK1109F18E
   2 FastEthernet interfaces
   2 Serial interfaces
   DRAM configuration is 64 bits wide with parity disabled.
   191K bytes of NVRAM.
   62720K bytes of ATA System CompactFlash (Read/Write)
   ```

3. **查看硬件信息**
   ```
   Router> enable
   Router# show version
   Router# show flash:
   Router# show memory statistics
   Router# show processes cpu
   ```

4. **查看接口信息**
   ```
   Router# show ip interface brief
   Router# show running-config
   ```

**实验验证**：
- 成功连接到路由器
- 观察到路由器启动过程
- 能够查看硬件信息

#### 实验 3-2：制作网线

**实验目的**：学习制作直通线和交叉线

**实验设备**：
- 网线（Cat5e 或 Cat6）
- RJ-45 水晶头
- 网线钳
- 网线测试仪

**实验步骤**：

1. **制作直通线（T568B）**
   - 剥去网线外皮（约 2 厘米）
   - 按照T568B 线序排列线芯：
     ```
     1  白绿
     2  绿
     3  白橙
     4  蓝
     5  白蓝
     6  橙
     7  白棕
     8  棕
     ```
   - 将线芯剪齐（约 1.5 厘米）
   - 插入水晶头，确保线芯到达顶端
   - 使用网线钳压接
   - 在另一端重复相同步骤

2. **制作交叉线**
   - 一端使用 T568B 线序
   - 另一端使用 T568A 线序：
     ```
     1  白绿
     2  绿
     3  白橙
     4  蓝
     5  白蓝
     6  橙
     7  白棕
     8  棕
     ```
   - 其他步骤与直通线相同

3. **测试网线**
   - 使用网线测试仪测试
   - 确保所有线芯都正常导通

**实验验证**：
- 成功制作直通线
- 成功制作交叉线
- 网线测试通过

#### 实验 3-3：设备连接测试

**实验目的**：测试不同设备间的连接

**实验设备**：
- Cisco 路由器 1 台
- Cisco 交换机 1 台
- PC 2 台
- 网线若干

**实验步骤**：

1. **连接设备**
   - PC1 连接到交换机端口 1
   - PC2 连接到交换机端口 2
   - 路由器连接到交换机端口 24

2. **配置 IP 地址**

   **PC1**：
   ```
   IP 地址：192.168.1.10
   子网掩码：255.255.255.0
   默认网关：192.168.1.1
   ```

   **PC2**：
   ```
   IP 地址：192.168.1.20
   子网掩码：255.255.255.0
   默认网关：192.168.1.1
   ```

   **路由器**：
   ```
   Router> enable
   Router# configure terminal
   Router(config)# interface gigabitethernet0/0
   Router(config-if)# ip address 192.168.1.1 255.255.255.0
   Router(config-if)# no shutdown
   Router(config-if)# end
   Router# show ip interface brief
   ```

3. **测试连通性**

   **PC1 ping PC2**：
   ```bash
   ping 192.168.1.20
   ```

   **PC1 ping 路由器**：
   ```bash
   ping 192.168.1.1
   ```

4. **查看交换机 MAC 地址表**
   ```
   Switch> enable
   Switch# show mac address-table
   ```

**实验验证**：
- PC1 能 ping 通 PC2
- PC1 能 ping 通路由器
- 能够查看 MAC 地址表

### 3.7 本章小结

本章介绍了网络设备和线缆：

**核心知识点**：
- Cisco 设备类型（路由器、交换机、无线设备、安全设备）
- 路由器硬件组成（CPU、内存、接口）
- 路由器启动过程
- 交换机硬件组成和转发方式
- 网络线缆类型（双绞线、光纤、无线）
- 网线类型（直通线、交叉线、翻转线）
- 设备连接方式和拓扑

**重点记忆**：
- 路由器内存：ROM（引导程序）、Flash（IOS）、NVRAM（启动配置）、RAM（运行配置）
- 路由器启动：POST → Bootstrap → IOS → 配置
- 双绞线类型：直通线（不同设备）、交叉线（相同设备）、翻转线（Console）
- 光纤类型：单模（长距离）、多模（短距离）
- 交换机转发：存储转发、直通转发、无分片转发

### 3.8 练习题

#### 选择题

1. 路由器的启动配置存储在哪里？
   - A. RAM
   - B. Flash
   - C. NVRAM
   - D. ROM

2. 以下哪种线缆用于连接 PC 和交换机？
   - A. 交叉线
   - B. 直通线
   - C. 翻转线
   - D. 串口线

3. 单模光纤的特点是什么？
   - A. 传输距离短
   - B. 使用 LED 光源
   - C. 传输距离长
   - D. 成本低

4. T568B 线序中，第 1 根线是什么颜色？
   - A. 白绿
   - B. 绿
   - C. 白橙
   - D. 蓝

5. 交换机的 MAC 地址表存储在哪里？
   - A. Flash
   - B. NVRAM
   - C. RAM
   - D. ROM

#### 填空题

1. 路由器的四种内存类型是 ________、________、________、________。

2. Console 线使用的是 ________ 线序。

3. 单模光纤使用 ________ 光源，多模光纤使用 ________ 光源。

4. 交换机的三种转发方式是 ________、________、________。

5. 路由器启动过程的顺序是 ________、________、________、________。

#### 简答题

1. 简述路由器的启动过程。

2. 比较 UTP 和 STP 双绞线的区别。

3. 解释直通线、交叉线和翻转线的用途。

4. 描述单模光纤和多模光纤的区别。

5. 交换机的存储转发和直通转发有什么区别？

#### 实验题

1. 制作一根直通线，并使用测试仪验证。

2. 连接路由器和交换机，配置 IP 地址并测试连通性。

3. 观察路由器的启动过程，并记录关键信息。

### 3.9 参考答案

#### 选择题

1. C
2. B
3. C
4. A
5. C

#### 填空题

1. ROM，Flash，NVRAM，RAM
2. 翻转
3. 激光，LED
4. 存储转发，直通转发，无分片转发
5. POST，Bootstrap，IOS，配置

#### 简答题

1. POST（硬件自检）→ 加载 Bootstrap → 查找并加载 IOS → 查找并加载配置文件 → 路由器准备就绪。

2. UTP 是非屏蔽双绞线，成本低，抗干扰能力弱；STP 是屏蔽双绞线，成本高，抗干扰能力强。

3. 直通线用于连接不同类型设备（PC-交换机、路由器-交换机）；交叉线用于连接相同类型设备（PC-PC、交换机-交换机）；翻转线用于 Console 连接。

4. 单模光纤传输距离长（可达 100 公里），使用激光光源，成本高；多模光纤传输距离短（通常 2 公里以内），使用 LED 光源，成本低。

5. 存储转发接收完整帧并检查 FCS，延迟较高但能检测错误；直通转发接收帧头后立即转发，延迟低但不检查错误。

---

# 第二部分：路由技术篇

## 第4章：IP 地址与子网划分

### 4.1 IP 地址基础

#### 什么是 IP 地址？

**IP 地址**（Internet Protocol Address）是互联网协议地址，用于在网络中唯一标识一台设备。

**比喻**：IP 地址就像家庭地址，用于唯一标识一个家庭的位置。

#### IP 地址的格式

**IPv4 地址**：
- 32 位二进制数
- 通常用点分十进制表示
- 例如：192.168.1.1

**二进制表示**：
```
192.168.1.1
  ↓
11000000.10101000.00000001.00000001
```

**IPv6 地址**：
- 128 位十六进制数
- 用冒号分隔
- 例如：2001:0db8:85a3:0000:0000:8a2e:0370:7334

**IPv6 简化**：
```
2001:0db8:85a3:0000:0000:8a2e:0370:7334
  ↓ 简化为
2001:db8:85a3::8a2e:370:7334
```

**简化规则**：
- 每组前导零可以省略
- 连续的全零组可以用 :: 表示（只能使用一次）

### 4.2 IPv4 地址分类

#### IP 地址的分类

根据 IP 地址的第一段（第一个八位组）的值，IPv4 地址分为 5 类：

| 类别 | 第一段范围 | 默认子网掩码 | 网络位 | 主机位 | 用途 |
|------|------------|--------------|--------|--------|------|
| A 类 | 1-126 | 255.0.0.0 | 8 | 24 | 大型网络 |
| B 类 | 128-191 | 255.255.0.0 | 16 | 16 | 中型网络 |
| C 类 | 192-223 | 255.255.255.0 | 24 | 8 | 小型网络 |
| D 类 | 224-239 | - | - | - | 组播 |
| E 类 | 240-255 | - | - | - | 保留 |

#### 特殊 IP 地址

**1. 私有地址**
- A 类：10.0.0.0 - 10.255.255.255
- B 类：172.16.0.0 - 172.31.255.255
- C 类：192.168.0.0 - 192.168.255.255
- 用途：内部网络，不在互联网上路由

**2. 环回地址**
- 127.0.0.0/8
- 通常使用 127.0.0.1
- 用途：本地测试

**3. 链路本地地址**
- 169.254.0.0/16
- 用途：DHCP 失败时的自动配置

**4. 网络地址**
- 主机位全为 0
- 例如：192.168.1.0
- 用途：标识网络本身

**5. 广播地址**
- 主机位全为 1
- 例如：192.168.1.255
- 用途：向网络中所有主机发送数据

**6. 保留地址**
- 0.0.0.0/8：当前网络
- 192.0.2.0/24：TEST-NET-1（文档和示例）
- 198.51.100.0/24：TEST-NET-2
- 203.0.113.0/24：TEST-NET-3

### 4.3 子网掩码

#### 什么是子网掩码？

**子网掩码**（Subnet Mask）用于区分 IP 地址中的网络部分和主机部分。

**工作原理**：
- 子网掩码中 1 表示网络位
- 子网掩码中 0 表示主机位
- IP 地址与子网掩码进行 AND 运算得到网络地址

#### 子网掩码的表示方法

**1. 点分十进制**
- 例如：255.255.255.0
- 对应二进制：11111111.11111111.11111111.00000000

**2. CIDR 表示法（无类别域间路由）**
- 例如：/24
- 表示前 24 位是网络位

**对应关系**：
```
255.0.0.0      → /8
255.255.0.0    → /16
255.255.255.0  → /24
255.255.255.128 → /25
255.255.255.192 → /26
255.255.255.224 → /27
255.255.255.240 → /28
255.255.255.248 → /29
255.255.255.252 → /30
```

#### 计算网络地址

**示例**：
- IP 地址：192.168.1.100
- 子网掩码：255.255.255.0 (/24)

**步骤**：
```
IP 地址：   11000000.10101000.00000001.01100100
子网掩码：  11111111.11111111.11111111.00000000
AND 运算：  11000000.10101000.00000001.00000000

网络地址：192.168.1.0
```

### 4.4 子网划分

#### 为什么需要子网划分？

**优点**：
- 节省 IP 地址
- 提高网络性能
- 增强网络安全性
- 简化网络管理

#### 子网划分步骤

**步骤 1：确定需要的子网数**
- 根据网络需求确定子网数量
- 公式：子网数 = 2^n（n 为借用的主机位数）

**步骤 2：确定每个子网的主机数**
- 根据每个子网的设备数量确定主机数
- 公式：主机数 = 2^m - 2（m 为剩余的主机位数）
- 减 2 是因为网络地址和广播地址不能分配给主机

**步骤 3：计算新的子网掩码**
- 新的子网掩码 = 默认子网掩码 + 借用的主机位

**步骤 4：计算每个子网的网络地址、广播地址和可用主机范围**

#### 子网划分示例

**示例 1：C 类网络子网划分**

**需求**：
- 网络：192.168.1.0/24
- 需要划分 4 个子网
- 每个子网至少 50 台主机

**步骤 1：确定借用的主机位**
- 需要 4 个子网
- 2^n ≥ 4 → n = 2
- 借用 2 位主机位

**步骤 2：确定剩余的主机位**
- 原有主机位：8
- 借用：2
- 剩余：8 - 2 = 6
- 每个子网的主机数：2^6 - 2 = 62（满足需求）

**步骤 3：计算新的子网掩码**
- 原子网掩码：/24
- 借用：2
- 新子网掩码：/26
- 点分十进制：255.255.255.192

**步骤 4：计算子网信息**

| 子网 | 网络地址 | 子网掩码 | 广播地址 | 可用主机范围 | 主机数 |
|------|----------|----------|----------|--------------|--------|
| 子网 1 | 192.168.1.0 | 255.255.255.192 | 192.168.1.63 | 192.168.1.1 - 192.168.1.62 | 62 |
| 子网 2 | 192.168.1.64 | 255.255.255.192 | 192.168.1.127 | 192.168.1.65 - 192.168.1.126 | 62 |
| 子网 3 | 192.168.1.128 | 255.255.255.192 | 192.168.1.191 | 192.168.1.129 - 192.168.1.190 | 62 |
| 子网 4 | 192.168.1.192 | 255.255.255.192 | 192.168.1.255 | 192.168.1.193 - 192.168.1.254 | 62 |

**示例 2：B 类网络子网划分**

**需求**：
- 网络：172.16.0.0/16
- 需要划分 10 个子网
- 每个子网至少 1000 台主机

**步骤 1：确定借用的主机位**
- 需要 10 个子网
- 2^n ≥ 10 → n = 4
- 借用 4 位主机位

**步骤 2：确定剩余的主机位**
- 原有主机位：16
- 借用：4
- 剩余：16 - 4 = 12
- 每个子网的主机数：2^12 - 2 = 4094（满足需求）

**步骤 3：计算新的子网掩码**
- 原子网掩码：/16
- 借用：4
- 新子网掩码：/20
- 点分十进制：255.255.240.0

**步骤 4：计算子网信息**

| 子网 | 网络地址 | 子网掩码 | 广播地址 | 可用主机范围 | 主机数 |
|------|----------|----------|----------|--------------|--------|
| 子网 1 | 172.16.0.0 | 255.255.240.0 | 172.16.15.255 | 172.16.0.1 - 172.16.15.254 | 4094 |
| 子网 2 | 172.16.16.0 | 255.255.240.0 | 172.16.31.255 | 172.16.16.1 - 172.16.31.254 | 4094 |
| 子网 3 | 172.16.32.0 | 255.255.240.0 | 172.16.47.255 | 172.16.32.1 - 172.16.47.254 | 4094 |
| ... | ... | ... | ... | ... | ... |
| 子网 10 | 172.16.144.0 | 255.255.240.0 | 172.16.159.255 | 172.16.144.1 - 172.16.159.254 | 4094 |

### 4.5 VLSM（可变长度子网掩码）

#### 什么是 VLSM？

**VLSM**（Variable Length Subnet Mask，可变长度子网掩码）允许在一个网络中使用不同长度的子网掩码，实现更灵活的 IP 地址分配。

**优点**：
- 更有效地利用 IP 地址
- 减少地址浪费
- 适应不同规模的子网需求

#### VLSM 示例

**需求**：
- 网络：192.168.10.0/24
- 需要划分以下子网：
  - 子网 A：50 台主机
  - 子网 B：20 台主机
  - 子网 C：10 台主机
  - 子网 D：2 台主机

**步骤 1：从大到小分配子网**

**子网 A（50 台主机）**
- 需要 50 台主机
- 2^m - 2 ≥ 50 → m = 6
- 需要 6 位主机位
- 子网掩码：/26
- 分配：192.168.10.0/26
- 可用范围：192.168.10.1 - 192.168.10.62

**子网 B（20 台主机）**
- 需要 20 台主机
- 2^m - 2 ≥ 20 → m = 5
- 需要 5 位主机位
- 子网掩码：/27
- 分配：192.168.10.64/27
- 可用范围：192.168.10.65 - 192.168.10.94

**子网 C（10 台主机）**
- 需要 10 台主机
- 2^m - 2 ≥ 10 → m = 4
- 需要 4 位主机位
- 子网掩码：/28
- 分配：192.168.10.96/28
- 可用范围：192.168.10.97 - 192.168.10.110

**子网 D（2 台主机）**
- 需要 2 台主机
- 2^m - 2 ≥ 2 → m = 2
- 需要 2 位主机位
- 子网掩码：/30
- 分配：192.168.10.112/30
- 可用范围：192.168.10.113 - 192.168.10.114

**剩余地址**：
- 192.168.10.116 - 192.168.10.255（可用于未来扩展）

#### VLSM 分配总结

| 子网 | 需求 | 分配地址 | 子网掩码 | 可用范围 | 浪费 |
|------|------|----------|----------|----------|------|
| A | 50 | 192.168.10.0/26 | 255.255.255.192 | 192.168.10.1-62 | 12 |
| B | 20 | 192.168.10.64/27 | 255.255.255.224 | 192.168.10.65-94 | 10 |
| C | 10 | 192.168.10.96/28 | 255.255.255.240 | 192.168.10.97-110 | 4 |
| D | 2 | 192.168.10.112/30 | 255.255.255.252 | 192.168.10.113-114 | 0 |

### 4.6 路由汇总

#### 什么是路由汇总？

**路由汇总**（Route Summarization）将多个连续的子网合并为一个更大的网络，减少路由表中的路由条目。

**优点**：
- 减少路由表大小
- 提高路由器性能
- 简化网络管理
- 提高网络稳定性

#### 路由汇总示例

**示例 1：连续子网汇总**

**原始路由**：
```
192.168.0.0/24
192.168.1.0/24
192.168.2.0/24
192.168.3.0/24
```

**汇总步骤**：
1. 将所有网络地址转换为二进制
2. 找出共同的位
3. 确定汇总掩码

```
192.168.0.0:  11000000.10101000.00000000.00000000
192.168.1.0:  11000000.10101000.00000001.00000000
192.168.2.0:  11000000.10101000.00000010.00000000
192.168.3.0:  11000000.10101000.00000011.00000000
              11111111.11111111.11111100.00000000

共同位：22 位
汇总路由：192.168.0.0/22
```

**示例 2：不连续子网**

**原始路由**：
```
10.1.0.0/16
10.2.0.0/16
10.3.0.0/16
10.4.0.0/16
10.5.0.0/16
```

**汇总**：
```
10.1.0.0:  00001010.00000001.00000000.00000000
10.2.0.0:  00001010.00000010.00000000.00000000
10.3.0.0:  00001010.00000011.00000000.00000000
10.4.0.0:  00001010.00000100.00000000.00000000
10.5.0.0:  00001010.00000101.00000000.00000000
            11111111.11111100.00000000.00000000

共同位：14 位
汇总路由：10.0.0.0/14
```

**注意**：汇总路由可能包含不属于原始网络的地址，需要确保不会造成路由错误。

### 4.7 本章实验

#### 实验 4-1：IP 地址配置和子网计算

**实验目的**：掌握 IP 地址配置和子网划分

**实验设备**：
- Cisco 路由器 2 台
- PC 2 台
- 交换机 1 台

**实验步骤**：

1. **网络设计**
   - 网络拓扑：
   ```
   PC1 --- Switch --- Router1 --- Router2 --- PC2
   ```

   - IP 地址规划：
     - PC1：192.168.1.10/24
     - Router1 G0/0：192.168.1.1/24
     - Router1 G0/1：10.0.0.1/30
     - Router2 G0/0：10.0.0.2/30
     - Router2 G0/1：192.168.2.1/24
     - PC2：192.168.2.10/24

2. **配置 Router1**
   ```
   Router> enable
   Router# configure terminal
   Router(config)# hostname Router1
   Router1(config)# interface gigabitethernet0/0
   Router1(config-if)# ip address 192.168.1.1 255.255.255.0
   Router1(config-if)# no shutdown
   Router1(config-if)# exit
   Router1(config)# interface gigabitethernet0/1
   Router1(config-if)# ip address 10.0.0.1 255.255.255.252
   Router1(config-if)# no shutdown
   Router1(config-if)# end
   Router1# show ip interface brief
   ```

3. **配置 Router2**
   ```
   Router> enable
   Router# configure terminal
   Router(config)# hostname Router2
   Router2(config)# interface gigabitethernet0/0
   Router2(config-if)# ip address 10.0.0.2 255.255.255.252
   Router2(config-if)# no shutdown
   Router2(config-if)# exit
   Router2(config)# interface gigabitethernet0/1
   Router2(config-if)# ip address 192.168.2.1 255.255.255.0
   Router2(config-if)# no shutdown
   Router2(config-if)# end
   Router2# show ip interface brief
   ```

4. **配置 PC1 和 PC2**
   - PC1：IP 192.168.1.10，子网掩码 255.255.255.0，网关 192.168.1.1
   - PC2：IP 192.168.2.10，子网掩码 255.255.255.0，网关 192.168.2.1

5. **测试连通性**
   ```bash
   # 在 Router1 上测试
   Router1# ping 10.0.0.2
   Router1# ping 192.168.2.1

   # 在 PC1 上测试
   ping 192.168.1.1
   ping 192.168.2.10
   ```

**实验验证**：
- Router1 能 ping 通 Router2
- PC1 能 ping 通网关
- PC2 能 ping 通网关

#### 实验 4-2：VLSM 子网划分

**实验目的**：掌握 VLSM 子网划分和配置

**实验设备**：
- Cisco 路由器 1 台
- 交换机 1 台
- PC 4 台

**实验步骤**：

1. **网络需求**
   - 网络：172.16.0.0/24
   - 需求：
     - 子网 A：50 台主机
     - 子网 B：20 台主机
     - 子网 C：10 台主机
     - 子网 D：2 台主机

2. **子网划分**
   - 子网 A：172.16.0.0/26（172.16.0.1 - 172.16.0.62）
   - 子网 B：172.16.0.64/27（172.16.0.65 - 172.16.0.94）
   - 子网 C：172.16.0.96/28（172.16.0.97 - 172.16.0.110）
   - 子网 D：172.16.0.112/30（172.16.0.113 - 172.16.0.114）

3. **配置路由器子接口**
   ```
   Router> enable
   Router# configure terminal
   Router(config)# interface gigabitethernet0/0
   Router(config-if)# no shutdown
   Router(config-if)# exit

   Router(config)# interface gigabitethernet0/0.10
   Router(config-subif)# encapsulation dot1q 10
   Router(config-subif)# ip address 172.16.0.1 255.255.255.192
   Router(config-subif)# exit

   Router(config)# interface gigabitethernet0/0.20
   Router(config-subif)# encapsulation dot1q 20
   Router(config-subif)# ip address 172.16.0.65 255.255.255.224
   Router(config-subif)# exit

   Router(config)# interface gigabitethernet0/0.30
   Router(config-subif)# encapsulation dot1q 30
   Router(config-subif)# ip address 172.16.0.97 255.255.255.240
   Router(config-subif)# exit

   Router(config)# interface gigabitethernet0/0.40
   Router(config-subif)# encapsulation dot1q 40
   Router(config-subif)# ip address 172.16.0.113 255.255.255.252
   Router(config-subif)# end
   Router# show ip interface brief
   ```

4. **配置交换机 VLAN**
   ```
   Switch> enable
   Switch# configure terminal
   Switch(config)# vlan 10
   Switch(config-vlan)# name SUBNET_A
   Switch(config-vlan)# exit
   Switch(config)# vlan 20
   Switch(config-vlan)# name SUBNET_B
   Switch(config-vlan)# exit
   Switch(config)# vlan 30
   Switch(config-vlan)# name SUBNET_C
   Switch(config-vlan)# exit
   Switch(config)# vlan 40
   Switch(config-vlan)# name SUBNET_D
   Switch(config-vlan)# exit

   Switch(config)# interface range fastethernet0/1-12
   Switch(config-if-range)# switchport mode access
   Switch(config-if-range)# switchport access vlan 10
   Switch(config-if-range)# exit

   Switch(config)# interface fastethernet0/24
   Switch(config-if)# switchport mode trunk
   Switch(config-if)# end
   Switch# show vlan brief
   ```

**实验验证**：
- 所有子接口配置正确
- VLAN 创建成功
- 端口分配到正确的 VLAN

### 4.8 本章小结

本章介绍了 IP 地址和子网划分：

**核心知识点**：
- IP 地址的格式（IPv4 和 IPv6）
- IPv4 地址分类（A、B、C、D、E 类）
- 特殊 IP 地址（私有地址、环回地址、广播地址等）
- 子网掩码的作用和表示方法
- 子网划分的步骤和方法
- VLSM（可变长度子网掩码）
- 路由汇总

**重点记忆**：
- A 类：1-126，默认子网掩码 255.0.0.0
- B 类：128-191，默认子网掩码 255.255.0.0
- C 类：192-223，默认子网掩码 255.255.255.0
- 私有地址：10.0.0.0/8、172.16.0.0/12、192.168.0.0/16
- 子网数 = 2^n，主机数 = 2^m - 2
- VLSM 允许使用不同长度的子网掩码
- 路由汇总减少路由表大小

### 4.9 练习题

#### 选择题

1. 以下哪个是 C 类 IP 地址？
   - A. 10.0.0.1
   - B. 172.16.0.1
   - C. 192.168.1.1
   - D. 224.0.0.1

2. 子网掩码 255.255.255.192 对应的 CIDR 表示法是？
   - A. /24
   - B. /25
   - C. /26
   - D. /27

3. /24 网络中，最多可以有多少台主机？
   - A. 254
   - B. 256
   - C. 252
   - D. 255

4. 以下哪个是私有 IP 地址？
   - A. 8.8.8.8
   - B. 172.16.0.1
   - C. 192.0.2.1
   - D. 203.0.113.1

5. VLSM 的全称是？
   - A. Very Large Subnet Mask
   - B. Variable Length Subnet Mask
   - C. Virtual Local Subnet Mask
   - D. Virtual Link Subnet Mask

#### 填空题

1. IPv4 地址由 ________ 位二进制数组成。

2. A 类地址的默认子网掩码是 ________。

3. IP 地址 192.168.1.0/24 的广播地址是 ________。

4. /26 网络中，每个子网最多可以有 ________ 台主机。

5. 路由汇总的目的是 ________。

#### 简答题

1. 解释 IP 地址和子网掩码的作用。

2. 比较 FLSM 和 VLSM 的区别。

3. 如何计算子网的网络地址和广播地址？

4. 列举至少 3 个特殊的 IP 地址及其用途。

5. 什么是路由汇总？路由汇总有什么优点？

#### 计算题

1. 给定网络 192.168.10.0/24，需要划分 8 个子网，每个子网至少 20 台主机。请计算：
   - 新的子网掩码
   - 每个子网的网络地址、广播地址和可用主机范围

2. 给定网络 10.0.0.0/8，使用 VLSM 划分以下子网：
   - 子网 A：1000 台主机
   - 子网 B：500 台主机
   - 子网 C：100 台主机
   请给出每个子网的地址分配。

#### 实验题

1. 在 Packet Tracer 中创建一个网络拓扑，配置 IP 地址并测试连通性。

2. 使用 VLSM 划分一个 C 类网络，并在路由器上配置子接口。

### 4.10 参考答案

#### 选择题

1. C
2. C
3. A
4. B
5. B

#### 填空题

1. 32
2. 255.0.0.0
3. 192.168.1.255
4. 62
5. 减少路由表大小，提高路由器性能

#### 简答题

1. IP 地址用于在网络中唯一标识一台设备，子网掩码用于区分 IP 地址中的网络部分和主机部分。

2. FLSM 使用固定长度的子网掩码，所有子网大小相同；VLSM 使用可变长度的子网掩码，不同子网可以有不同的掩码长度，更灵活。

3. 网络地址是主机位全为 0 的地址，广播地址是主机位全为 1 的地址。通过 IP 地址与子网掩码进行 AND 运算得到网络地址。

4. 私有地址（10.0.0.0/8、172.16.0.0/12、192.168.0.0/16）：用于内部网络；环回地址（127.0.0.1）：用于本地测试；广播地址（主机位全为 1）：向网络中所有主机发送数据。

5. 路由汇总将多个连续的子网合并为一个更大的网络。优点：减少路由表大小、提高路由器性能、简化网络管理、提高网络稳定性。

#### 计算题

1. 新的子网掩码：/27 (255.255.255.224)
   - 子网 1：192.168.10.0/27，广播地址 192.168.10.31，可用范围 192.168.10.1-30
   - 子网 2：192.168.10.32/27，广播地址 192.168.10.63，可用范围 192.168.10.33-62
   - ...（共 8 个子网）

2. 子网 A：10.0.0.0/22（10.0.0.1 - 10.0.3.254，4094 台主机）
   子网 B：10.0.4.0/23（10.0.4.1 - 10.0.5.254，510 台主机）
   子网 C：10.0.6.0/24（10.0.6.1 - 10.0.6.254，254 台主机）

---

## 第5章：静态路由与默认路由

### 5.1 路由基础

#### 什么是路由？

**路由**（Routing）是指数据包从源到目的地的传输路径选择过程。

**路由器的作用**：
- 接收数据包
- 查看数据包的目的地址
- 查找路由表
- 选择最佳路径
- 转发数据包

#### 路由表

**路由表**（Routing Table）是路由器中存储路由信息的数据库，用于指导数据包的转发。

**路由表条目包含**：
- 目的网络地址
- 子网掩码
- 下一跳地址或出接口
- 管理距离
- 度量值

**查看路由表**：
```
Router# show ip route
Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP
       D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area
       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
       E1 - OSPF external type 1, E2 - OSPF external type 2
       i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
       ia - IS-IS inter area, * - candidate default, U - per-user static route
       o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP
       + - replicated route, % - next hop override

Gateway of last resort is not set

     10.0.0.0/30 is subnetted, 1 subnets
C       10.0.0.0 is directly connected, GigabitEthernet0/1
     192.168.1.0/24 is subnetted, 1 subnets
C       192.168.1.0 is directly connected, GigabitEthernet0/0
```

#### 路由类型

**1. 直连路由（Connected）**
- 路由器接口配置了 IP 地址并启用
- 自动添加到路由表
- 管理距离：0

**2. 静态路由（Static）**
- 手动配置
- 管理距离：1（普通静态路由）
- 管理距离：5（默认路由）

**3. 动态路由（Dynamic）**
- 由路由协议自动学习
- 管理距离：RIP(120)、EIGRP(90)、OSPF(110)、BGP(20)

### 5.2 静态路由

#### 什么是静态路由？

**静态路由**（Static Route）是由网络管理员手动配置的路由，不会自动更新。

**优点**：
- 配置简单
- 路由器资源消耗少
- 安全性高（不发送路由更新）
- 可预测性强

**缺点**：
- 需要手动维护
- 网络拓扑变化时需要手动更新
- 不适用于大型网络
- 容易出错

#### 静态路由配置

**语法**：
```
ip route [目标网络] [子网掩码] [下一跳地址或出接口]
```

**参数说明**：
- 目标网络：要到达的网络地址
- 子网掩码：目标网络的子网掩码
- 下一跳地址：下一个路由器的 IP 地址
- 出接口：数据包发出的接口

**示例 1：使用下一跳地址**
```
Router(config)# ip route 192.168.2.0 255.255.255.0 10.0.0.2
```

**示例 2：使用出接口**
```
Router(config)# ip route 192.168.2.0 255.255.255.0 gigabitethernet0/1
```

**注意**：点对点链路可以使用出接口，以太网网段建议使用下一跳地址。

#### 静态路由配置示例

**网络拓扑**：
```
PC1 (192.168.1.10) --- Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 192.168.2.1) --- PC2 (192.168.2.10)
```

**配置 Router1**：
```
Router> enable
Router# configure terminal
Router(config)# hostname Router1
Router1(config)# interface gigabitethernet0/0
Router1(config-if)# ip address 192.168.1.1 255.255.255.0
Router1(config-if)# no shutdown
Router1(config-if)# exit
Router1(config)# interface gigabitethernet0/1
Router1(config-if)# ip address 10.0.0.1 255.255.255.252
Router1(config-if)# no shutdown
Router1(config-if)# exit

# 配置到 192.168.2.0/24 的静态路由
Router1(config)# ip route 192.168.2.0 255.255.255.0 10.0.0.2

Router1(config)# end
Router1# show ip route
```

**配置 Router2**：
```
Router> enable
Router# configure terminal
Router(config)# hostname Router2
Router2(config)# interface gigabitethernet0/0
Router2(config-if)# ip address 10.0.0.2 255.255.255.252
Router2(config-if)# no shutdown
Router2(config-if)# exit
Router2(config)# interface gigabitethernet0/1
Router2(config-if)# ip address 192.168.2.1 255.255.255.0
Router2(config-if)# no shutdown
Router2(config-if)# exit

# 配置到 192.168.1.0/24 的静态路由
Router2(config)# ip route 192.168.1.0 255.255.255.0 10.0.0.1

Router2(config)# end
Router2# show ip route
```

**测试连通性**：
```bash
# 在 Router1 上测试
Router1# ping 192.168.2.1
Router1# ping 192.168.2.10

# 在 PC1 上测试
ping 192.168.2.10
```

### 5.3 默认路由

#### 什么是默认路由？

**默认路由**（Default Route）也称为最后求助网关（Gateway of Last Resort），是当路由表中没有匹配的路由时使用的路由。

**特点**：
- 目标网络：0.0.0.0/0
- 匹配所有未知网络
- 通常用于连接到互联网

**配置语法**：
```
ip route 0.0.0.0 0.0.0.0 [下一跳地址或出接口]
```

#### 默认路由配置示例

**网络拓扑**：
```
PC1 (192.168.1.10) --- Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 203.0.113.1) --- Internet
```

**配置 Router1**：
```
Router1(config)# ip route 0.0.0.0 0.0.0.0 10.0.0.2
Router1(config)# end
Router1# show ip route

Gateway of last resort is 10.0.0.2 to network 0.0.0.0

     10.0.0.0/30 is subnetted, 1 subnets
C       10.0.0.0 is directly connected, GigabitEthernet0/1
     192.168.1.0/24 is subnetted, 1 subnets
C       192.168.1.0 is directly connected, GigabitEthernet0/0
S*   0.0.0.0/0 [1/0] via 10.0.0.2
```

**配置 Router2**：
```
Router2(config)# ip route 192.168.1.0 255.255.255.0 10.0.0.1
Router2(config)# ip route 0.0.0.0 0.0.0.0 203.0.113.254
Router2(config)# end
Router2# show ip route
```

### 5.4 浮动静态路由

#### 什么是浮动静态路由？

**浮动静态路由**（Floating Static Route）是备用路由，当主路由不可用时自动启用。

**工作原理**：
- 配置多条到同一目的地的静态路由
- 设置不同的管理距离
- 管理距离低的为主路由
- 管理距离高的为备用路由

**配置语法**：
```
ip route [目标网络] [子网掩码] [下一跳地址] [管理距离]
```

**示例**：
```
# 主路由
Router(config)# ip route 192.168.2.0 255.255.255.0 10.0.0.2

# 备用路由（管理距离 10）
Router(config)# ip route 192.168.2.0 255.255.255.0 10.0.1.2 10
```

#### 浮动静态路由配置示例

**网络拓扑**：
```
PC1 (192.168.1.10) --- Router1 (192.168.1.1) --- Router2 (192.168.2.1) --- PC2 (192.168.2.10)
                                 |
                              Router3 (192.168.3.1) --- Router2 (192.168.3.2)
```

**配置 Router1**：
```
Router1(config)# interface gigabitethernet0/0
Router1(config-if)# ip address 192.168.1.1 255.255.255.0
Router1(config-if)# no shutdown
Router1(config-if)# exit
Router1(config)# interface gigabitethernet0/1
Router1(config-if)# ip address 10.0.0.1 255.255.255.252
Router1(config-if)# no shutdown
Router1(config-if)# exit
Router1(config)# interface gigabitethernet0/2
Router1(config-if)# ip address 10.0.1.1 255.255.255.252
Router1(config-if)# no shutdown
Router1(config-if)# exit

# 主路由
Router1(config)# ip route 192.168.2.0 255.255.255.0 10.0.0.2

# 备用路由（管理距离 10）
Router1(config)# ip route 192.168.2.0 255.255.255.0 10.0.1.2 10

Router1(config)# end
Router1# show ip route
```

### 5.5 静态路由的故障排除

#### 常见问题

**1. 路由未生效**
- 检查路由配置是否正确
- 检查下一跳地址是否可达
- 检查接口是否启用

**2. 无法到达目标网络**
- 检查路由表中是否有到目标网络的路由
- 检查下一跳路由器的路由表
- 检查所有路由器的路由配置

**3. 路由环路**
- 检查路由配置是否正确
- 使用 debug ip packet 查看数据包流向

#### 故障排除命令

**1. 查看路由表**
```
Router# show ip route
```

**2. 测试连通性**
```
Router# ping [目标地址]
Router# traceroute [目标地址]
```

**3. 查看接口状态**
```
Router# show ip interface brief
```

**4. 查看 ARP 表**
```
Router# show ip arp
```

**5. Debug 命令**
```
Router# debug ip routing
Router# debug ip packet
```

### 5.6 本章实验

#### 实验 5-1：静态路由配置

**实验目的**：掌握静态路由的配置

**实验设备**：
- Cisco 路由器 3 台
- PC 3 台
- 交换机 3 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 (192.168.1.10) --- Switch1 --- Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 10.0.1.1) --- Router3 (10.0.1.2, 192.168.3.1) --- Switch3 --- PC3 (192.168.3.10)
                                         |
                                      Switch2 --- PC2 (192.168.2.10)
   ```

2. **配置 Router1**
   ```
   Router> enable
   Router# configure terminal
   Router(config)# hostname Router1
   Router1(config)# interface gigabitethernet0/0
   Router1(config-if)# ip address 192.168.1.1 255.255.255.0
   Router1(config-if)# no shutdown
   Router1(config-if)# exit
   Router1(config)# interface gigabitethernet0/1
   Router1(config-if)# ip address 10.0.0.1 255.255.255.252
   Router1(config-if)# no shutdown
   Router1(config-if)# exit

   # 到 192.168.2.0/24 的路由
   Router1(config)# ip route 192.168.2.0 255.255.255.0 10.0.0.2

   # 到 192.168.3.0/24 的路由
   Router1(config)# ip route 192.168.3.0 255.255.255.0 10.0.0.2

   Router1(config)# end
   Router1# show ip route
   ```

3. **配置 Router2**
   ```
   Router> enable
   Router# configure terminal
   Router(config)# hostname Router2
   Router2(config)# interface gigabitethernet0/0
   Router2(config-if)# ip address 10.0.0.2 255.255.255.252
   Router2(config-if)# no shutdown
   Router2(config-if)# exit
   Router2(config)# interface gigabitethernet0/1
   Router2(config-if)# ip address 10.0.1.1 255.255.255.252
   Router2(config-if)# no shutdown
   Router2(config-if)# exit

   # 到 192.168.1.0/24 的路由
   Router2(config)# ip route 192.168.1.0 255.255.255.0 10.0.0.1

   # 到 192.168.3.0/24 的路由
   Router2(config)# ip route 192.168.3.0 255.255.255.0 10.0.1.2

   Router2(config)# end
   Router2# show ip route
   ```

4. **配置 Router3**
   ```
   Router> enable
   Router# configure terminal
   Router(config)# hostname Router3
   Router3(config)# interface gigabitethernet0/0
   Router3(config-if)# ip address 10.0.1.2 255.255.255.252
   Router3(config-if)# no shutdown
   Router3(config-if)# exit
   Router3(config)# interface gigabitethernet0/1
   Router3(config-if)# ip address 192.168.3.1 255.255.255.0
   Router3(config-if)# no shutdown
   Router3(config-if)# exit

   # 到 192.168.1.0/24 的路由
   Router3(config)# ip route 192.168.1.0 255.255.255.0 10.0.1.1

   # 到 192.168.2.0/24 的路由
   Router3(config)# ip route 192.168.2.0 255.255.255.0 10.0.1.1

   Router3(config)# end
   Router3# show ip route
   ```

5. **配置 PC**
   - PC1：192.168.1.10/24，网关 192.168.1.1
   - PC2：192.168.2.10/24，网关 192.168.2.1
   - PC3：192.168.3.10/24，网关 192.168.3.1

6. **测试连通性**
   ```bash
   # 在 PC1 上测试
   ping 192.168.2.10
   ping 192.168.3.10

   # 在 Router1 上测试
   Router1# ping 192.168.3.1
   Router1# traceroute 192.168.3.10
   ```

**实验验证**：
- 所有路由器能 ping 通相邻路由器
- PC1 能 ping 通 PC2 和 PC3
- traceroute 显示正确的路径

#### 实验 5-2：默认路由配置

**实验目的**：掌握默认路由的配置

**实验设备**：
- Cisco 路由器 2 台
- PC 2 台
- 交换机 2 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 (192.168.1.10) --- Switch1 --- Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 203.0.113.1) --- Internet
   ```

2. **配置 Router1**
   ```
   Router1(config)# interface gigabitethernet0/0
   Router1(config-if)# ip address 192.168.1.1 255.255.255.0
   Router1(config-if)# no shutdown
   Router1(config-if)# exit
   Router1(config)# interface gigabitethernet0/1
   Router1(config-if)# ip address 10.0.0.1 255.255.255.252
   Router1(config-if)# no shutdown
   Router1(config-if)# exit

   # 配置默认路由
   Router1(config)# ip route 0.0.0.0 0.0.0.0 10.0.0.2

   Router1(config)# end
   Router1# show ip route
   ```

3. **配置 Router2**
   ```
   Router2(config)# interface gigabitethernet0/0
   Router2(config-if)# ip address 10.0.0.2 255.255.255.252
   Router2(config-if)# no shutdown
   Router2(config-if)# exit
   Router2(config)# interface gigabitethernet0/1
   Router2(config-if)# ip address 203.0.113.1 255.255.255.0
   Router2(config-if)# no shutdown
   Router2(config-if)# exit

   # 配置到 192.168.1.0/24 的路由
   Router2(config)# ip route 192.168.1.0 255.255.255.0 10.0.0.1

   # 配置默认路由
   Router2(config)# ip route 0.0.0.0 0.0.0.0 203.0.113.254

   Router2(config)# end
   Router2# show ip route
   ```

**实验验证**：
- Router1 的路由表中有默认路由
- Router2 的路由表中有默认路由
- PC1 能访问互联网（模拟）

### 5.7 本章小结

本章介绍了静态路由和默认路由：

**核心知识点**：
- 路由表的作用和组成
- 路由类型（直连、静态、动态）
- 静态路由的配置
- 默认路由的配置
- 浮动静态路由
- 静态路由的故障排除

**重点记忆**：
- 静态路由配置：ip route [目标网络] [子网掩码] [下一跳地址或出接口]
- 默认路由配置：ip route 0.0.0.0 0.0.0.0 [下一跳地址或出接口]
- 浮动静态路由通过设置不同的管理距离实现
- 静态路由管理距离：1，默认路由管理距离：5
- 故障排除命令：show ip route、ping、traceroute

### 5.8 练习题

#### 选择题

1. 静态路由的管理距离是多少？
   - A. 0
   - B. 1
   - C. 5
   - D. 10

2. 默认路由的目标网络和子网掩码是？
   - A. 0.0.0.0 255.0.0.0
   - B. 0.0.0.0 0.0.0.0
   - C. 255.255.255.255 0.0.0.0
   - D. 255.255.255.255 255.255.255.255

3. 以下哪个命令用于查看路由表？
   - A. show ip interface brief
   - B. show ip route
   - C. show running-config
   - D. show version

4. 浮动静态路由通过什么实现？
   - A. 设置不同的度量值
   - B. 设置不同的管理距离
   - C. 设置不同的子网掩码
   - D. 设置不同的下一跳地址

5. 直连路由的管理距离是多少？
   - A. 0
   - B. 1
   - C. 5
   - D. 10

#### 填空题

1. 静态路由的配置命令是 ________。

2. 默认路由也称为 ________。

3. 静态路由的管理距离是 ________，默认路由的管理距离是 ________。

4. 浮动静态路由通过设置不同的 ________ 来实现。

5. 查看路由表的命令是 ________。

#### 简答题

1. 简述静态路由的优缺点。

2. 什么是默认路由？什么时候使用默认路由？

3. 什么是浮动静态路由？它的工作原理是什么？

4. 如何配置静态路由？请给出配置命令。

5. 静态路由故障排除的步骤是什么？

#### 实验题

1. 在 Packet Tracer 中创建一个包含 3 台路由器的网络拓扑，配置静态路由并测试连通性。

2. 配置默认路由，使网络能够访问互联网（模拟）。

### 5.9 参考答案

#### 选择题

1. B
2. B
3. B
4. B
5. A

#### 填空题

1. ip route [目标网络] [子网掩码] [下一跳地址或出接口]
2. 最后求助网关（Gateway of Last Resort）
3. 1，5
4. 管理距离
5. show ip route

#### 简答题

1. 优点：配置简单、资源消耗少、安全性高、可预测性强；缺点：需要手动维护、网络拓扑变化时需要手动更新、不适用于大型网络、容易出错。

2. 默认路由是当路由表中没有匹配的路由时使用的路由，目标网络为 0.0.0.0/0。通常用于连接到互联网或只有一个出口的网络。

3. 浮动静态路由是备用路由，当主路由不可用时自动启用。通过设置不同的管理距离实现，管理距离低的为主路由，管理距离高的为备用路由。

4. 配置命令：ip route [目标网络] [子网掩码] [下一跳地址或出接口]。例如：ip route 192.168.2.0 255.255.255.0 10.0.0.2。

5. 步骤：1) 查看路由表，确认路由配置；2) 测试连通性；3) 检查接口状态；4) 检查 ARP 表；5) 使用 debug 命令诊断。

---

## 第6章：动态路由协议

### 6.1 动态路由协议概述

#### 什么是动态路由协议？

**动态路由协议**（Dynamic Routing Protocol）是路由器之间自动交换路由信息的协议，能够自动学习和维护路由表。

**与静态路由的区别**：
- 静态路由：手动配置，不会自动更新
- 动态路由：自动学习，自动更新

#### 动态路由协议的优点

**1. 自动维护**
- 网络拓扑变化时自动更新路由表
- 减少人工干预

**2. 可扩展性**
- 适用于大型网络
- 能够处理复杂的网络拓扑

**3. 冗余性**
- 支持多条路径
- 自动选择最佳路径

**4. 故障恢复**
- 链路故障时自动重新计算路由
- 快速收敛

#### 动态路由协议的分类

**按工作范围分类**：

| 类型 | 说明 | 示例 |
|------|------|------|
| 内部网关协议 (IGP) | 自治系统内部使用 | RIP、EIGRP、OSPF、IS-IS |
| 外部网关协议 (EGP) | 自治系统之间使用 | BGP |

**按算法分类**：

| 类型 | 说明 | 示例 |
|------|------|------|
| 距离矢量 | 基于跳数或度量值 | RIP、EIGRP |
| 链路状态 | 基于网络拓扑 | OSPF、IS-IS |
| 路径矢量 | 基于路径属性 | BGP |

### 6.2 路由协议基础概念

#### 管理距离 (Administrative Distance)

**定义**：路由器用于评估路由来源可信度的值，范围 0-255。

**值越小，可信度越高**。

**常见管理距离**：

| 路由来源 | 管理距离 |
|----------|----------|
| 直连路由 | 0 |
| 静态路由 | 1 |
| EIGRP 汇总路由 | 5 |
| 外部 BGP | 20 |
| 内部 EIGRP | 90 |
| IGRP | 100 |
| OSPF | 110 |
| IS-IS | 115 |
- RIP | 120 |
| EIGRP 外部路由 | 170 |
| 内部 BGP | 200 |
| 未知 | 255 |

**示例**：
```
Gateway of last resort is not set

     10.0.0.0/30 is subnetted, 1 subnets
C       10.0.0.0 is directly connected, GigabitEthernet0/1
     192.168.1.0/24 is subnetted, 1 subnets
C       192.168.1.0 is directly connected, GigabitEthernet0/0
S    192.168.2.0/24 [1/0] via 10.0.0.2
O    192.168.3.0/24 [110/2] via 10.0.0.2, 00:00:23, GigabitEthernet0/1
```

**说明**：
- C：直连路由，管理距离 0
- S：静态路由，管理距离 1
- O：OSPF 路由，管理距离 110

#### 度量值 (Metric)

**定义**：路由协议用于评估路径优劣的值。

**不同协议的度量值**：

| 协议 | 度量值 | 说明 |
|------|--------|------|
| RIP | 跳数 | 经过路由器的数量 |
| EIGRP | 复合度量 | 带宽、延迟、可靠性、负载、MTU |
| OSPF | 成本 | 带宽的倒数 |
| BGP | 属性 | AS_Path、Local_Pref、MED 等 |

#### 收敛 (Convergence)

**定义**：网络拓扑变化后，所有路由器更新路由表并达成一致的过程。

**收敛时间**：
- RIP：几分钟
- OSPF：几秒到几十秒
- EIGRP：几秒
- BGP：几分钟到几小时

**快速收敛的重要性**：
- 减少网络中断时间
- 提高网络可靠性
- 避免路由环路

### 6.3 RIP (Routing Information Protocol)

#### RIP 概述

**RIP**（Routing Information Protocol）是最早的路由协议之一，属于距离矢量协议。

**特点**：
- 基于跳数作为度量值
- 最大跳数限制为 15
- 每 30 秒发送一次路由更新
- 管理距离：120
- 使用 UDP 520 端口

**版本**：
- RIPv1：有类路由，不支持 VLSM
- RIPv2：无类路由，支持 VLSM，支持认证
- RIPng：用于 IPv6

#### RIP 工作原理

**1. 路由表初始化**
- 路由器启动时，直连网络加入路由表
- 度量值为 0

**2. 路由更新**
- 每 30 秒向所有邻居发送完整的路由表
- 接收到的路由跳数加 1

**3. 路由选择**
- 比较同一目的地的多条路由
- 选择跳数最少的路由
- 跳数相同则负载均衡

**4. 计时器**
- 更新计时器：30 秒
- 无效计时器：180 秒
- 保持计时器：180 秒
- 刷新计时器：240 秒

#### RIP 配置

**基本配置**：
```
Router(config)# router rip
Router(config-router)# version 2
Router(config-router)# network [网络地址]
Router(config-router)# no auto-summary
```

**示例**：
```
Router(config)# router rip
Router(config-router)# version 2
Router(config-router)# network 192.168.1.0
Router(config-router)# network 10.0.0.0
Router(config-router)# no auto-summary
```

#### RIP 配置示例

**网络拓扑**：
```
Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 192.168.2.1) --- Router3 (192.168.2.2, 192.168.3.1)
```

**配置 Router1**：
```
Router1(config)# interface gigabitethernet0/0
Router1(config-if)# ip address 192.168.1.1 255.255.255.0
Router1(config-if)# no shutdown
Router1(config-if)# exit
Router1(config)# interface gigabitethernet0/1
Router1(config-if)# ip address 10.0.0.1 255.255.255.252
Router1(config-if)# no shutdown
Router1(config-if)# exit

Router1(config)# router rip
Router1(config-router)# version 2
Router1(config-router)# network 192.168.1.0
Router1(config-router)# network 10.0.0.0
Router1(config-router)# no auto-summary

Router1(config-router)# end
Router1# show ip route rip
Router1# show ip protocols
```

**配置 Router2**：
```
Router2(config)# interface gigabitethernet0/0
Router2(config-if)# ip address 10.0.0.2 255.255.255.252
Router2(config-if)# no shutdown
Router2(config-if)# exit
Router2(config)# interface gigabitethernet0/1
Router2(config-if)# ip address 192.168.2.1 255.255.255.0
Router2(config-if)# no shutdown
Router2(config-if)# exit

Router2(config)# router rip
Router2(config-router)# version 2
Router2(config-router)# network 10.0.0.0
Router2(config-router)# network 192.168.2.0
Router2(config-router)# no auto-summary

Router2(config-router)# end
Router2# show ip route rip
```

**配置 Router3**：
```
Router3(config)# interface gigabitethernet0/0
Router3(config-if)# ip address 192.168.2.2 255.255.255.0
Router3(config-if)# no shutdown
Router3(config-if)# exit
Router3(config)# interface gigabitethernet0/1
Router3(config-if)# ip address 192.168.3.1 255.255.255.0
Router3(config-if)# no shutdown
Router3(config-if)# exit

Router3(config)# router rip
Router3(config-router)# version 2
Router3(config-router)# network 192.168.2.0
Router3(config-router)# network 192.168.3.0
Router3(config-router)# no auto-summary

Router3(config-router)# end
Router3# show ip route rip
```

#### RIP 验证和调试

**查看 RIP 路由**：
```
Router# show ip route rip
```

**查看 RIP 协议信息**：
```
Router# show ip protocols
```

**Debug RIP**：
```
Router# debug ip rip
```

**清除 RIP 路由**：
```
Router# clear ip route *
```

### 6.4 EIGRP (Enhanced Interior Gateway Routing Protocol)

#### EIGRP 概述

**EIGRP**（Enhanced Interior Gateway Routing Protocol）是 Cisco 开发的增强型内部网关路由协议，属于高级距离矢量协议。

**特点**：
- 快速收敛（使用 DUAL 算法）
- 支持多种网络层协议（IP、IPX、AppleTalk）
- 复合度量值（带宽、延迟、可靠性、负载、MTU）
- 支持 VLSM 和 CIDR
- 支持等价和非等价负载均衡
- 管理距离：90（内部）、170（外部）

#### EIGRP 工作原理

**1. 邻居发现**
- 使用 Hello 包发现邻居
- Hello 间隔：5 秒（以太网）、60 秒（WAN）
- 保持时间：Hello 间隔的 3 倍

**2. 可行距离 (FD) 和报告距离 (RD)**
- **报告距离 (RD)**：邻居到目的地的度量值
- **可行距离 (FD)**：路由器到目的地的总度量值

**3. 后继站和可行后继站**
- **后继站 (Successor)**：最佳路径的下一跳路由器
- **可行后继站 (Feasible Successor)**：备用路径的下一跳路由器

**4. DUAL 算法**
- 扩散更新算法
- 确保无环路
- 快速收敛

**5. 度量值计算**
```
度量值 = [K1 × 带宽 + (K2 × 带宽) / (256 - 负载) + K3 × 延迟] × [K5 / (可靠性 + K4)]

默认值：K1=1, K2=0, K3=1, K4=0, K5=0

简化公式：度量值 = 带宽 + 延迟
```

#### EIGRP 配置

**基本配置**：
```
Router(config)# router eigrp [自治系统号]
Router(config-router)# network [网络地址]
Router(config-router)# no auto-summary
```

**示例**：
```
Router(config)# router eigrp 100
Router(config-router)# network 192.168.1.0
Router(config-router)# network 10.0.0.0
Router(config-router)# no auto-summary
```

#### EIGRP 配置示例

**网络拓扑**：
```
Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 192.168.2.1) --- Router3 (192.168.2.2, 192.168.3.1)
```

**配置 Router1**：
```
Router1(config)# interface gigabitethernet0/0
Router1(config-if)# ip address 192.168.1.1 255.255.255.0
Router1(config-if)# no shutdown
Router1(config-if)# exit
Router1(config)# interface gigabitethernet0/1
Router1(config-if)# ip address 10.0.0.1 255.255.255.252
Router1(config-if)# no shutdown
Router1(config-if)# exit

Router1(config)# router eigrp 100
Router1(config-router)# network 192.168.1.0
Router1(config-router)# network 10.0.0.0
Router1(config-router)# no auto-summary

Router1(config-router)# end
Router1# show ip route eigrp
Router1# show ip eigrp neighbors
Router1# show ip eigrp topology
```

**配置 Router2**：
```
Router2(config)# interface gigabitethernet0/0
Router2(config-if)# ip address 10.0.0.2 255.255.255.252
Router2(config-if)# no shutdown
Router2(config-if)# exit
Router2(config)# interface gigabitethernet0/1
Router2(config-if)# ip address 192.168.2.1 255.255.255.0
Router2(config-if)# no shutdown
Router2(config-if)# exit

Router2(config)# router eigrp 100
Router2(config-router)# network 10.0.0.0
Router2(config-router)# network 192.168.2.0
Router2(config-router)# no auto-summary

Router2(config-router)# end
Router2# show ip route eigrp
```

**配置 Router3**：
```
Router3(config)# interface gigabitethernet0/0
Router3(config-if)# ip address 192.168.2.2 255.255.255.0
Router3(config-if)# no shutdown
Router3(config-if)# exit
Router3(config)# interface gigabitethernet0/1
Router3(config-if)# ip address 192.168.3.1 255.255.255.0
Router3(config-if)# no shutdown
Router3(config-if)# exit

Router3(config)# router eigrp 100
Router3(config-router)# network 192.168.2.0
Router3(config-router)# network 192.168.3.0
Router3(config-router)# no auto-summary

Router3(config-router)# end
Router3# show ip route eigrp
```

#### EIGRP 验证和调试

**查看 EIGRP 路由**：
```
Router# show ip route eigrp
```

**查看 EIGRP 邻居**：
```
Router# show ip eigrp neighbors
```

**查看 EIGRP 拓扑表**：
```
Router# show ip eigrp topology
```

**Debug EIGRP**：
```
Router# debug eigrp packets
Router# debug eigrp neighbors
```

### 6.5 OSPF (Open Shortest Path First)

#### OSPF 概述

**OSPF**（Open Shortest Path First）是基于链路状态的路由协议，使用 Dijkstra 算法计算最短路径。

**特点**：
- 开放标准协议
- 链路状态协议
- 支持大型网络
- 区域化设计
- 快速收敛
- 支持 VLSM 和 CIDR
- 管理距离：110

#### OSPF 工作原理

**1. 邻居发现**
- 使用 Hello 包发现邻居
- Hello 间隔：10 秒（广播网络）、30 秒（非广播网络）
- 死亡时间：Hello 间隔的 4 倍

**2. 建立邻接关系**
- 选举 DR（指定路由器）和 BDR（备份指定路由器）
- 交换链路状态信息

**3. 链路状态通告 (LSA)**
- Type 1：路由器 LSA
- Type 2：网络 LSA
- Type 3：网络汇总 LSA
- Type 4：ASBR 汇总 LSA
- Type 5：外部 LSA
- Type 7：NSSA 外部 LSA

**4. 链路状态数据库 (LSDB)**
- 存储所有 LSA
- 所有路由器的 LSDB 相同

**5. SPF 计算**
- 使用 Dijkstra 算法
- 计算最短路径树
- 生成路由表

**6. 度量值**
- 成本 (Cost) = 100 / 带宽 (Mbps)
- 默认参考带宽：100 Mbps

#### OSPF 区域

**区域类型**：

| 区域类型 | 说明 |
|----------|------|
| 骨干区域 (Area 0) | 必须存在的中心区域 |
| 标准区域 | 普通区域，接收所有 LSA |
| 末梢区域 (Stub Area) | 不接收外部 LSA |
| 完全末梢区域 (Totally Stub) | 不接收外部和区域间 LSA |
| NSSA (Not-So-Stubby Area) | 可以引入外部路由 |

#### OSPF 配置

**基本配置**：
```
Router(config)# router ospf [进程ID]
Router(config-router)# router-id [路由器ID]
Router(config-router)# network [网络地址] [通配符掩码] area [区域号]
```

**示例**：
```
Router(config)# router ospf 1
Router(config-router)# router-id 1.1.1.1
Router(config-router)# network 192.168.1.0 0.0.0.255 area 0
Router(config-router)# network 10.0.0.0 0.0.0.3 area 0
```

#### OSPF 配置示例

**网络拓扑**：
```
Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 192.168.2.1) --- Router3 (192.168.2.2, 192.168.3.1)
```

**配置 Router1**：
```
Router1(config)# interface gigabitethernet0/0
Router1(config-if)# ip address 192.168.1.1 255.255.255.0
Router1(config-if)# no shutdown
Router1(config-if)# exit
Router1(config)# interface gigabitethernet0/1
Router1(config-if)# ip address 10.0.0.1 255.255.255.252
Router1(config-if)# no shutdown
Router1(config-if)# exit

Router1(config)# router ospf 1
Router1(config-router)# router-id 1.1.1.1
Router1(config-router)# network 192.168.1.0 0.0.0.255 area 0
Router1(config-router)# network 10.0.0.0 0.0.0.3 area 0

Router1(config-router)# end
Router1# show ip route ospf
Router1# show ip ospf neighbor
Router1# show ip ospf database
```

**配置 Router2**：
```
Router2(config)# interface gigabitethernet0/0
Router2(config-if)# ip address 10.0.0.2 255.255.255.252
Router2(config-if)# no shutdown
Router2(config-if)# exit
Router2(config)# interface gigabitethernet0/1
Router2(config-if)# ip address 192.168.2.1 255.255.255.0
Router2(config-if)# no shutdown
Router2(config-if)# exit

Router2(config)# router ospf 1
Router2(config-router)# router-id 2.2.2.2
Router2(config-router)# network 10.0.0.0 0.0.0.3 area 0
Router2(config-router)# network 192.168.2.0 0.0.0.255 area 0

Router2(config-router)# end
Router2# show ip route ospf
```

**配置 Router3**：
```
Router3(config)# interface gigabitethernet0/0
Router3(config-if)# ip address 192.168.2.2 255.255.255.0
Router3(config-if)# no shutdown
Router3(config-if)# exit
Router3(config)# interface gigabitethernet0/1
Router3(config-if)# ip address 192.168.3.1 255.255.255.0
Router3(config-if)# no shutdown
Router3(config-if)# exit

Router3(config)# router ospf 1
Router3(config-router)# router-id 3.3.3.3
Router3(config-router)# network 192.168.2.0 0.0.0.255 area 0
Router3(config-router)# network 192.168.3.0 0.0.0.255 area 0

Router3(config-router)# end
Router3# show ip route ospf
```

#### OSPF 验证和调试

**查看 OSPF 路由**：
```
Router# show ip route ospf
```

**查看 OSPF 邻居**：
```
Router# show ip ospf neighbor
```

**查看 OSPF 数据库**：
```
Router# show ip ospf database
```

**查看 OSPF 接口**：
```
Router# show ip ospf interface
```

**Debug OSPF**：
```
Router# debug ip ospf adj
Router# debug ip ospf events
```

### 6.6 BGP (Border Gateway Protocol)

#### BGP 概述

**BGP**（Border Gateway Protocol）是用于自治系统之间交换路由信息的外部网关协议。

**特点**：
- 路径矢量协议
- 使用 TCP（端口 179）
- 支持大规模网络
- 基于策略的路由
- 管理距离：20（外部）、200（内部）

**BGP 类型**：
- **eBGP**：外部 BGP，不同 AS 之间
- **iBGP**：内部 BGP，同一 AS 内部

#### BGP 工作原理

**1. 邻居建立**
- 使用 TCP 建立连接
- 手动配置邻居地址
- 发送 Open 消息

**2. 路由交换**
- 发送 Update 消息
- 交换路由信息
- 交换路径属性

**3. 最佳路径选择**
- 比较路径属性
- 选择最佳路径
- 添加到路由表

**4. 路径属性**
- **AS_Path**：经过的 AS 列表
- **Next_Hop**：下一跳地址
- **Local_Pref**：本地优先级
- **MED**：多出口鉴别器
- **Origin**：路由来源
- **Community**：团体属性

#### BGP 配置

**基本配置**：
```
Router(config)# router bgp [自治系统号]
Router(config-router)# neighbor [邻居地址] remote-as [邻居AS号]
Router(config-router)# network [网络地址] mask [子网掩码]
```

**示例**：
```
Router(config)# router bgp 65001
Router(config-router)# neighbor 10.0.0.2 remote-as 65002
Router(config-router)# network 192.168.1.0 mask 255.255.255.0
```

#### BGP 配置示例

**网络拓扑**：
```
AS 65001: Router1 (192.168.1.1, 10.0.0.1) --- AS 65002: Router2 (10.0.0.2, 192.168.2.1)
```

**配置 Router1 (AS 65001)**：
```
Router1(config)# interface gigabitethernet0/0
Router1(config-if)# ip address 192.168.1.1 255.255.255.0
Router1(config-if)# no shutdown
Router1(config-if)# exit
Router1(config)# interface gigabitethernet0/1
Router1(config-if)# ip address 10.0.0.1 255.255.255.252
Router1(config-if)# no shutdown
Router1(config-if)# exit

Router1(config)# router bgp 65001
Router1(config-router)# neighbor 10.0.0.2 remote-as 65002
Router1(config-router)# network 192.168.1.0 mask 255.255.255.0

Router1(config-router)# end
Router1# show ip bgp
Router1# show ip bgp summary
Router1# show ip bgp neighbors
```

**配置 Router2 (AS 65002)**：
```
Router2(config)# interface gigabitethernet0/0
Router2(config-if)# ip address 10.0.0.2 255.255.255.252
Router2(config-if)# no shutdown
Router2(config-if)# exit
Router2(config)# interface gigabitethernet0/1
Router2(config-if)# ip address 192.168.2.1 255.255.255.0
Router2(config-if)# no shutdown
Router2(config-if)# exit

Router2(config)# router bgp 65002
Router2(config-router)# neighbor 10.0.0.1 remote-as 65001
Router2(config-router)# network 192.168.2.0 mask 255.255.255.0

Router2(config-router)# end
Router2# show ip bgp
```

#### BGP 验证和调试

**查看 BGP 路由**：
```
Router# show ip bgp
```

**查看 BGP 邻居**：
```
Router# show ip bgp summary
```

**查看 BGP 邻居详细信息**：
```
Router# show ip bgp neighbors
```

**Debug BGP**：
```
Router# debug ip bgp
Router# debug ip bgp events
```

### 6.7 路由协议比较

| 特性 | RIP | EIGRP | OSPF | BGP |
|------|-----|-------|------|-----|
| 协议类型 | 距离矢量 | 高级距离矢量 | 链路状态 | 路径矢量 |
| 管理距离 | 120 | 90/170 | 110 | 20/200 |
| 度量值 | 跳数 | 复合度量 | 成本 | 路径属性 |
| 收敛速度 | 慢 | 快 | 快 | 慢 |
| 适用规模 | 小型 | 中大型 | 大型 | 超大型 |
| 配置复杂度 | 简单 | 中等 | 中等 | 复杂 |
| Cisco 专有 | 否 | 是 | 否 | 否 |
| 支持 VLSM | RIPv2 支持 | 支持 | 支持 | 支持 |

### 6.8 本章实验

#### 实验 6-1：OSPF 配置

**实验目的**：掌握 OSPF 的配置和验证

**实验设备**：
- Cisco 路由器 3 台
- PC 3 台
- 交换机 3 台

**实验步骤**：

1. **网络拓扑**
   ```
   Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 10.0.1.1) --- Router3 (10.0.1.2, 192.168.3.1)
   ```

2. **配置 Router1**
   ```
   Router1(config)# interface gigabitethernet0/0
   Router1(config-if)# ip address 192.168.1.1 255.255.255.0
   Router1(config-if)# no shutdown
   Router1(config-if)# exit
   Router1(config)# interface gigabitethernet0/1
   Router1(config-if)# ip address 10.0.0.1 255.255.255.252
   Router1(config-if)# no shutdown
   Router1(config-if)# exit

   Router1(config)# router ospf 1
   Router1(config-router)# router-id 1.1.1.1
   Router1(config-router)# network 192.168.1.0 0.0.0.255 area 0
   Router1(config-router)# network 10.0.0.0 0.0.0.3 area 0

   Router1(config-router)# end
   Router1# show ip route ospf
   Router1# show ip ospf neighbor
   ```

3. **配置 Router2**
   ```
   Router2(config)# interface gigabitethernet0/0
   Router2(config-if)# ip address 10.0.0.2 255.255.255.252
   Router2(config-if)# no shutdown
   Router2(config-if)# exit
   Router2(config)# interface gigabitethernet0/1
   Router2(config-if)# ip address 10.0.1.1 255.255.255.252
   Router2(config-if)# no shutdown
   Router2(config-if)# exit

   Router2(config)# router ospf 1
   Router2(config-router)# router-id 2.2.2.2
   Router2(config-router)# network 10.0.0.0 0.0.0.3 area 0
   Router2(config-router)# network 10.0.1.0 0.0.0.3 area 0

   Router2(config-router)# end
   Router2# show ip route ospf
   ```

4. **配置 Router3**
   ```
   Router3(config)# interface gigabitethernet0/0
   Router3(config-if)# ip address 10.0.1.2 255.255.255.252
   Router3(config-if)# no shutdown
   Router3(config-if)# exit
   Router3(config)# interface gigabitethernet0/1
   Router3(config-if)# ip address 192.168.3.1 255.255.255.0
   Router3(config-if)# no shutdown
   Router3(config-if)# exit

   Router3(config)# router ospf 1
   Router3(config-router)# router-id 3.3.3.3
   Router3(config-router)# network 10.0.1.0 0.0.0.3 area 0
   Router3(config-router)# network 192.168.3.0 0.0.0.255 area 0

   Router3(config-router)# end
   Router3# show ip route ospf
   ```

5. **测试连通性**
   ```bash
   Router1# ping 192.168.3.1
   Router1# traceroute 192.168.3.1
   ```

**实验验证**：
- 所有路由器建立 OSPF 邻居关系
- 路由表中有 OSPF 路由
- 网络连通性正常

### 6.9 本章小结

本章介绍了动态路由协议：

**核心知识点**：
- 动态路由协议的分类（IGP、EGP）
- 管理距离和度量值
- RIP 的配置和工作原理
- EIGRP 的配置和工作原理
- OSPF 的配置和工作原理
- BGP 的配置和工作原理
- 路由协议的比较

**重点记忆**：
- RIP：距离矢量，跳数度量，管理距离 120
- EIGRP：高级距离矢量，复合度量，管理距离 90/170
- OSPF：链路状态，成本度量，管理距离 110
- BGP：路径矢量，路径属性，管理距离 20/200
- OSPF 使用 Dijkstra 算法，EIGRP 使用 DUAL 算法

### 6.10 练习题

#### 选择题

1. RIP 的最大跳数限制是多少？
   - A. 15
   - B. 16
   - C. 30
   - D. 255

2. OSPF 的管理距离是多少？
   - A. 90
   - B. 110
   - C. 120
   - D. 20

3. EIGRP 使用的算法是？
   - A. Dijkstra
   - B. Bellman-Ford
   - C. DUAL
   - D. SPF

4. BGP 使用的传输层协议是？
   - A. UDP
   - B. TCP
   - C. ICMP
   - D. IP

5. OSPF 的默认参考带宽是多少？
   - A. 10 Mbps
   - B. 100 Mbps
   - C. 1 Gbps
   - D. 10 Gbps

#### 填空题

1. RIP 的管理距离是 ________。

2. OSPF 使用 ________ 算法计算最短路径。

3. EIGRP 的管理距离是 ________（内部）和 ________（外部）。

4. BGP 使用 TCP 端口 ________。

5. 动态路由协议分为 ________ 和 ________。

#### 简答题

1. 简述 RIP、EIGRP、OSPF、BGP 的特点。

2. 什么是管理距离？常见路由协议的管理距离是多少？

3. 解释 OSPF 的工作原理。

4. EIGRP 的 DUAL 算法有什么作用？

5. 比较距离矢量协议和链路状态协议的区别。

#### 实验题

1. 在 Packet Tracer 中配置 OSPF，实现 3 台路由器的互联。

2. 配置 EIGRP，并查看邻居关系和拓扑表。

### 6.11 参考答案

#### 选择题

1. A
2. B
3. C
4. B
5. B

#### 填空题

1. 120
2. Dijkstra
3. 90，170
4. 179
5. IGP，EGP

#### 简答题

1. RIP：距离矢量，跳数度量，简单但收敛慢；EIGRP：高级距离矢量，快速收敛，Cisco 专有；OSPF：链路状态，适用于大型网络；BGP：路径矢量，用于 AS 间路由。

2. 管理距离是路由器用于评估路由来源可信度的值。直连路由 0，静态路由 1，EIGRP 90，OSPF 110，RIP 120，eBGP 20。

3. OSPF 通过 Hello 包发现邻居，建立邻接关系，交换 LSA，构建 LSDB，使用 Dijkstra 算法计算最短路径。

4. DUAL 算法（扩散更新算法）确保无环路，快速收敛，维护后继站和可行后继站。

5. 距离矢量协议基于跳数或度量值，收敛慢；链路状态协议基于网络拓扑，收敛快，适用于大型网络。

---

*（第二部分：路由技术篇 完）*

# 第三部分：交换技术篇

## 第7章：交换机基础与 VLAN

### 7.1 交换机工作原理

#### 交换机的基本功能

**1. 学习 (Learning)**
- 交换机接收数据帧时，记录源 MAC 地址和入端口
- 将 MAC 地址和端口的对应关系存入 MAC 地址表

**2. 转发 (Forwarding)**
- 根据目的 MAC 地址查找 MAC 地址表
- 如果找到，从对应端口转发（单播）
- 如果未找到，广播到所有端口（泛洪）

**3. 过滤 (Filtering)**
- 如果目的端口和源端口相同，丢弃帧
- 避免不必要的转发

**4. 老化 (Aging)**
- MAC 地址表项有老化时间（默认 5 分钟）
- 超时后删除未使用的地址

#### MAC 地址表

**查看 MAC 地址表**：
```
Switch# show mac address-table
          Mac Address Table
-------------------------------------------

Vlan    Mac Address       Type        Ports
----    -----------       --------    -----
 1    0000.0c12.3456    DYNAMIC     Gi0/1
 1    0000.0c12.3457    DYNAMIC     Gi0/2
 1    0000.0c12.3458    DYNAMIC     Gi0/3
```

**MAC 地址表类型**：
- **DYNAMIC**：动态学习
- **STATIC**：静态配置
- **SECURE**：安全 MAC 地址

#### 交换机转发方式

**1. 存储转发 (Store-and-Forward)**
- 接收完整帧，检查 FCS，然后转发
- 优点：错误检测
- 缺点：延迟较高

**2. 直通转发 (Cut-Through)**
- 接收到帧头后立即转发
- 优点：延迟低
- 缺点：不检查错误

**3. 无分片转发 (Fragment-Free)**
- 接收到前 64 字节后转发
- 优点：平衡延迟和错误检测

### 7.2 VLAN (Virtual LAN)

#### 什么是 VLAN？

**VLAN**（Virtual Local Area Network，虚拟局域网）是在交换机上逻辑划分的广播域。

**优点**：
- 限制广播流量
- 提高网络安全性
- 简化网络管理
- 灵活的设备分组

#### VLAN 类型

**1. 数据 VLAN (Data VLAN)**
- 用于传输用户数据
- 默认 VLAN 1

**2. 管理 VLAN (Management VLAN)**
- 用于管理交换机
- 通常使用 VLAN 1

**3. 本征 VLAN (Native VLAN)**
- 用于 Trunk 链路
- 未标记的流量
- 默认 VLAN 1

**4. 语音 VLAN (Voice VLAN)**
- 用于 IP 电话
- 优先级高

#### VLAN 配置

**创建 VLAN**：
```
Switch(config)# vlan [VLAN ID]
Switch(config-vlan)# name [VLAN 名称]
```

**示例**：
```
Switch(config)# vlan 10
Switch(config-vlan)# name SALES
Switch(config-vlan)# exit
Switch(config)# vlan 20
Switch(config-vlan)# name ENGINEERING
Switch(config-vlan)# exit
```

**分配端口到 VLAN**：
```
Switch(config)# interface [接口]
Switch(config-if)# switchport mode access
Switch(config-if)# switchport access vlan [VLAN ID]
```

**示例**：
```
Switch(config)# interface range fastethernet0/1-10
Switch(config-if-range)# switchport mode access
Switch(config-if-range)# switchport access vlan 10
Switch(config-if-range)# exit

Switch(config)# interface range fastethernet0/11-20
Switch(config-if-range)# switchport mode access
Switch(config-if-range)# switchport access vlan 20
Switch(config-if-range)# end
```

**查看 VLAN**：
```
Switch# show vlan brief
VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/21, Fa0/22, Fa0/23, Fa0/24
10   SALES                            active    Fa0/1, Fa0/2, Fa0/3, Fa0/4, Fa0/5
20   ENGINEERING                      active    Fa0/11, Fa0/12, Fa0/13, Fa0/14
```

### 7.3 Trunk

#### 什么是 Trunk？

**Trunk** 是在单条链路上传输多个 VLAN 流量的链路。

**作用**：
- 连接交换机之间
- 连接交换机和路由器
- 传输多个 VLAN 的数据

#### Trunk 封装协议

**1. 802.1Q (dot1q)**
- IEEE 标准
- 在帧头插入 4 字节标签
- 支持 4096 个 VLAN

**2. ISL (Inter-Switch Link)**
- Cisco 私有协议
- 封装整个帧
- 支持 1024 个 VLAN

**注意**：现代交换机主要使用 802.1Q。

#### Trunk 配置

**配置 Trunk**：
```
Switch(config)# interface [接口]
Switch(config-if)# switchport trunk encapsulation dot1q
Switch(config-if)# switchport mode trunk
Switch(config-if)# switchport trunk allowed vlan [VLAN 列表]
```

**示例**：
```
Switch(config)# interface gigabitethernet0/1
Switch(config-if)# switchport trunk encapsulation dot1q
Switch(config-if)# switchport mode trunk
Switch(config-if)# switchport trunk allowed vlan 10,20,30
Switch(config-if)# end
```

**允许所有 VLAN**：
```
Switch(config-if)# switchport trunk allowed vlan all
```

**移除 VLAN**：
```
Switch(config-if)# switchport trunk allowed vlan remove [VLAN ID]
```

**配置本征 VLAN**：
```
Switch(config-if)# switchport trunk native vlan [VLAN ID]
```

**查看 Trunk**：
```
Switch# show interfaces trunk
Port        Mode         Encapsulation  Status        Native vlan
Gi0/1       on           802.1q         trunking      1

Port        Vlans allowed on trunk
Gi0/1       10,20,30

Port        Vlans allowed and active in management domain
Gi0/1       10,20,30

Port        Vlans in spanning tree forwarding state and not pruned
Gi0/1       10,20,30
```

### 7.4 VLAN 间路由

#### 什么是 VLAN 间路由？

**VLAN 间路由**（Inter-VLAN Routing）是实现不同 VLAN 之间通信的技术。

#### VLAN 间路由方法

**1. 路由器物理接口**
- 每个 VLAN 一个物理接口
- 成本高，扩展性差

**2. 路由器子接口**
- 单个物理接口，多个子接口
- 使用 802.1Q 封装
- 成本低，扩展性好

**3. 三层交换机**
- 交换机具备路由功能
- 性能高
- 适用于大型网络

#### 路由器子接口配置

**配置路由器子接口**：
```
Router(config)# interface [物理接口].[子接口号]
Router(config-subif)# encapsulation dot1q [VLAN ID]
Router(config-subif)# ip address [IP 地址] [子网掩码]
```

**示例**：
```
Router(config)# interface gigabitethernet0/0
Router(config-if)# no shutdown
Router(config-if)# exit

Router(config)# interface gigabitethernet0/0.10
Router(config-subif)# encapsulation dot1q 10
Router(config-subif)# ip address 192.168.10.1 255.255.255.0
Router(config-subif)# exit

Router(config)# interface gigabitethernet0/0.20
Router(config-subif)# encapsulation dot1q 20
Router(config-subif)# ip address 192.168.20.1 255.255.255.0
Router(config-subif)# end
```

#### 三层交换机配置

**启用路由功能**：
```
Switch(config)# ip routing
```

**配置 SVI (Switch Virtual Interface)**：
```
Switch(config)# interface vlan [VLAN ID]
Switch(config-if)# ip address [IP 地址] [子网掩码]
Switch(config-if)# no shutdown
```

**示例**：
```
Switch(config)# ip routing
Switch(config)# interface vlan 10
Switch(config-if)# ip address 192.168.10.1 255.255.255.0
Switch(config-if)# no shutdown
Switch(config-if)# exit
Switch(config)# interface vlan 20
Switch(config-if)# ip address 192.168.20.1 255.255.255.0
Switch(config-if)# no shutdown
Switch(config-if)# end
```

### 7.5 本章实验

#### 实验 7-1：VLAN 配置

**实验目的**：掌握 VLAN 的创建和端口分配

**实验设备**：
- Cisco 交换机 1 台
- PC 4 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 (VLAN 10) --- Switch --- PC2 (VLAN 10)
   PC3 (VLAN 20) --- Switch --- PC4 (VLAN 20)
   ```

2. **创建 VLAN**
   ```
   Switch> enable
   Switch# configure terminal
   Switch(config)# vlan 10
   Switch(config-vlan)# name SALES
   Switch(config-vlan)# exit
   Switch(config)# vlan 20
   Switch(config-vlan)# name ENGINEERING
   Switch(config-vlan)# exit
   ```

3. **分配端口到 VLAN**
   ```
   Switch(config)# interface range fastethernet0/1-2
   Switch(config-if-range)# switchport mode access
   Switch(config-if-range)# switchport access vlan 10
   Switch(config-if-range)# exit

   Switch(config)# interface range fastethernet0/3-4
   Switch(config-if-range)# switchport mode access
   Switch(config-if-range)# switchport access vlan 20
   Switch(config-if-range)# end
   ```

4. **配置 PC**
   - PC1：192.168.10.10/24
   - PC2：192.168.10.20/24
   - PC3：192.168.20.10/24
   - PC4：192.168.20.20/24

5. **测试连通性**
   ```bash
   # PC1 ping PC2（应该通）
   ping 192.168.10.20

   # PC1 ping PC3（应该不通）
   ping 192.168.20.10
   ```

**实验验证**：
- VLAN 创建成功
- 端口分配正确
- 同 VLAN 可以通信，不同 VLAN 不能通信

#### 实验 7-2：Trunk 配置

**实验目的**：掌握 Trunk 的配置

**实验设备**：
- Cisco 交换机 2 台
- PC 4 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 (VLAN 10) --- Switch1 --- Trunk --- Switch2 --- PC3 (VLAN 10)
   PC2 (VLAN 20) --- Switch1 --- Trunk --- Switch2 --- PC4 (VLAN 20)
   ```

2. **配置 Switch1**
   ```
   Switch1(config)# vlan 10
   Switch1(config-vlan)# name SALES
   Switch1(config-vlan)# exit
   Switch1(config)# vlan 20
   Switch1(config-vlan)# name ENGINEERING
   Switch1(config-vlan)# exit

   Switch1(config)# interface range fastethernet0/1-2
   Switch1(config-if-range)# switchport mode access
   Switch1(config-if-range)# switchport access vlan 10
   Switch1(config-if-range)# exit

   Switch1(config)# interface range fastethernet0/3-4
   Switch1(config-if-range)# switchport mode access
   Switch1(config-if-range)# switchport access vlan 20
   Switch1(config-if-range)# exit

   Switch1(config)# interface gigabitethernet0/1
   Switch1(config-if)# switchport trunk encapsulation dot1q
   Switch1(config-if)# switchport mode trunk
   Switch1(config-if)# switchport trunk allowed vlan 10,20
   Switch1(config-if)# end
   ```

3. **配置 Switch2**
   ```
   Switch2(config)# vlan 10
   Switch2(config-vlan)# name SALES
   Switch2(config-vlan)# exit
   Switch2(config)# vlan 20
   Switch2(config-vlan)# name ENGINEERING
   Switch2(config-vlan)# exit

   Switch2(config)# interface range fastethernet0/1-2
   Switch2(config-if-range)# switchport mode access
   Switch2(config-if-range)# switchport access vlan 10
   Switch2(config-if-range)# exit

   Switch2(config)# interface range fastethernet0/3-4
   Switch2(config-if-range)# switchport mode access
   Switch2(config-if-range)# switchport access vlan 20
   Switch2(config-if-range)# exit

   Switch2(config)# interface gigabitethernet0/1
   Switch2(config-if)# switchport trunk encapsulation dot1q
   Switch2(config-if)# switchport mode trunk
   Switch2(config-if)# switchport trunk allowed vlan 10,20
   Switch2(config-if)# end
   ```

4. **测试连通性**
   ```bash
   # PC1 ping PC3（应该通）
   ping 192.168.10.30

   # PC2 ping PC4（应该通）
   ping 192.168.20.30

   # PC1 ping PC4（应该不通）
   ping 192.168.20.30
   ```

**实验验证**：
- Trunk 配置成功
- 跨交换机的同 VLAN 可以通信
- 不同 VLAN 不能通信

#### 实验 7-3：VLAN 间路由

**实验目的**：掌握 VLAN 间路由的配置

**实验设备**：
- Cisco 路由器 1 台
- Cisco 交换机 1 台
- PC 4 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 (VLAN 10) --- Switch --- Router --- Switch --- PC3 (VLAN 20)
   PC2 (VLAN 10) --- Switch --- Router --- Switch --- PC4 (VLAN 20)
   ```

2. **配置交换机**
   ```
   Switch(config)# vlan 10
   Switch(config-vlan)# name SALES
   Switch(config-vlan)# exit
   Switch(config)# vlan 20
   Switch(config-vlan)# name ENGINEERING
   Switch(config-vlan)# exit

   Switch(config)# interface range fastethernet0/1-2
   Switch(config-if-range)# switchport mode access
   Switch(config-if-range)# switchport access vlan 10
   Switch(config-if-range)# exit

   Switch(config)# interface range fastethernet0/3-4
   Switch(config-if-range)# switchport mode access
   Switch(config-if-range)# switchport access vlan 20
   Switch(config-if-range)# exit

   Switch(config)# interface gigabitethernet0/1
   Switch(config-if)# switchport trunk encapsulation dot1q
   Switch(config-if)# switchport mode trunk
   Switch(config-if)# switchport trunk allowed vlan 10,20
   Switch(config-if)# end
   ```

3. **配置路由器**
   ```
   Router(config)# interface gigabitethernet0/0
   Router(config-if)# no shutdown
   Router(config-if)# exit

   Router(config)# interface gigabitethernet0/0.10
   Router(config-subif)# encapsulation dot1q 10
   Router(config-subif)# ip address 192.168.10.1 255.255.255.0
   Router(config-subif)# exit

   Router(config)# interface gigabitethernet0/0.20
   Router(config-subif)# encapsulation dot1q 20
   Router(config-subif)# ip address 192.168.20.1 255.255.255.0
   Router(config-subif)# end
   ```

4. **配置 PC**
   - PC1：192.168.10.10/24，网关 192.168.10.1
   - PC2：192.168.10.20/24，网关 192.168.10.1
   - PC3：192.168.20.10/24，网关 192.168.20.1
   - PC4：192.168.20.20/24，网关 192.168.20.1

5. **测试连通性**
   ```bash
   # PC1 ping PC3（应该通）
   ping 192.168.20.10

   # PC2 ping PC4（应该通）
   ping 192.168.20.20
   ```

**实验验证**：
- VLAN 间路由配置成功
- 不同 VLAN 可以互相通信

### 7.6 本章小结

本章介绍了交换机基础和 VLAN：

**核心知识点**：
- 交换机的工作原理（学习、转发、过滤、老化）
- MAC 地址表
- VLAN 的概念和类型
- VLAN 的配置
- Trunk 的概念和配置
- VLAN 间路由

**重点记忆**：
- 交换机根据 MAC 地址转发帧
- VLAN 逻辑划分广播域
- Trunk 使用 802.1Q 封装
- VLAN 间路由需要路由器或三层交换机
- 路由器子接口使用 dot1q 封装

### 7.7 练习题

#### 选择题

1. 交换机根据什么地址转发数据帧？
   - A. IP 地址
   - B. MAC 地址
   - C. 端口号
   - D. VLAN ID

2. 802.1Q 支持多少个 VLAN？
   - A. 1024
   - B. 2048
   - C. 4096
   - D. 8192

3. 默认的本征 VLAN 是？
   - A. VLAN 0
   - B. VLAN 1
   - C. VLAN 10
   - D. VLAN 99

4. Trunk 链路使用什么封装协议？
   - A. PPP
   - B. HDLC
   - C. 802.1Q
   - D. Frame Relay

5. VLAN 间路由需要什么设备？
   - A. 集线器
   - B. 交换机
   - C. 路由器或三层交换机
   - D. 网桥

#### 填空题

1. 交换机根据 ________ 地址转发数据帧。

2. VLAN 的作用是 ________。

3. Trunk 使用 ________ 协议封装。

4. 默认的管理 VLAN 是 ________。

5. VLAN 间路由可以通过 ________ 或 ________ 实现。

#### 简答题

1. 简述交换机的工作原理。

2. 什么是 VLAN？VLAN 有什么优点？

3. 什么是 Trunk？Trunk 有什么作用？

4. 如何实现 VLAN 间路由？

5. 比较 802.1Q 和 ISL 的区别。

#### 实验题

1. 在 Packet Tracer 中创建 VLAN，并分配端口。

2. 配置 Trunk 链路，实现跨交换机的 VLAN 通信。

3. 配置 VLAN 间路由，实现不同 VLAN 之间的通信。

### 7.8 参考答案

#### 选择题

1. B
2. C
3. B
4. C
5. C

#### 填空题

1. MAC
2. 逻辑划分广播域
3. 802.1Q
4. VLAN 1
5. 路由器，三层交换机

#### 简答题

1. 交换机通过学习源 MAC 地址和端口的对应关系，根据目的 MAC 地址查找 MAC 地址表，从对应端口转发数据帧。

2. VLAN 是在交换机上逻辑划分的广播域。优点：限制广播流量、提高网络安全性、简化网络管理、灵活的设备分组。

3. Trunk 是在单条链路上传输多个 VLAN 流量的链路。作用：连接交换机之间、连接交换机和路由器、传输多个 VLAN 的数据。

4. VLAN 间路由可以通过路由器子接口或三层交换机实现。路由器子接口使用 dot1q 封装，三层交换机使用 SVI。

5. 802.1Q 是 IEEE 标准，在帧头插入 4 字节标签，支持 4096 个 VLAN；ISL 是 Cisco 私有协议，封装整个帧，支持 1024 个 VLAN。

---

## 第8章：生成树协议 (STP)

### 8.1 STP 概述

#### 为什么需要 STP？

**问题**：交换网络中的环路会导致：
- 广播风暴
- MAC 地址表不稳定
- 重复帧

**解决方案**：STP（Spanning Tree Protocol，生成树协议）通过阻塞某些端口，消除环路。

#### STP 的工作原理

**1. 选举根桥 (Root Bridge)**
- 比较桥 ID（优先级 + MAC 地址）
- 优先级默认 32768
- 桥 ID 最小的成为根桥

**2. 选举根端口 (Root Port)**
- 每个非根桥选举一个根端口
- 到根桥路径成本最低的端口

**3. 选举指定端口 (Designated Port)**
- 每个网段选举一个指定端口
- 到根桥路径成本最低的端口

**4. 阻塞非指定端口**
- 既不是根端口也不是指定端口的端口
- 处于阻塞状态，不转发数据

### 8.2 STP 端口状态

**STP 端口状态**：

| 状态 | 说明 | 转发数据 | 学习 MAC |
|------|------|----------|----------|
| Blocking | 阻塞状态 | 否 | 否 |
| Listening | 监听状态 | 否 | 否 |
| Learning | 学习状态 | 否 | 是 |
| Forwarding | 转发状态 | 是 | 是 |
| Disabled | 禁用状态 | 否 | 否 |

**状态转换**：
```
Disabled → Blocking → Listening → Learning → Forwarding
```

**计时器**：
- Hello 时间：2 秒
- 转发延迟：15 秒
- 最大老化时间：20 秒

### 8.3 STP 类型

**1. STP (802.1D)**
- 原始生成树协议
- 收敛慢（30-50 秒）
- 每个生成树实例对应一个 VLAN

**2. RSTP (802.1w)**
- 快速生成树协议
- 收敛快（几秒）
- 提供快速转换

**3. MSTP (802.1s)**
- 多生成树协议
- 支持多个生成树实例
- 节省资源

**4. PVST+**
- Cisco 私有
- 每个 VLAN 一个生成树
- 负载均衡

### 8.4 STP 配置

**启用 STP**：
```
Switch(config)# spanning-tree mode [stp|rstp|mst|pvst]
```

**配置桥优先级**：
```
Switch(config)# spanning-tree vlan [VLAN ID] priority [优先级值]
```

**配置根桥**：
```
Switch(config)# spanning-tree vlan [VLAN ID] root primary
Switch(config)# spanning-tree vlan [VLAN ID] root secondary
```

**配置端口成本**：
```
Switch(config-if)# spanning-tree cost [成本值]
```

**配置端口优先级**：
```
Switch(config-if)# spanning-tree port-priority [优先级值]
```

#### STP 配置示例

**配置 Switch1 为根桥**：
```
Switch1(config)# spanning-tree mode pvst
Switch1(config)# spanning-tree vlan 1 root primary
Switch1(config)# spanning-tree vlan 10 root primary
Switch1(config)# spanning-tree vlan 20 root primary
```

**配置 Switch2 为备份根桥**：
```
Switch2(config)# spanning-tree mode pvst
Switch2(config)# spanning-tree vlan 1 root secondary
Switch2(config)# spanning-tree vlan 10 root secondary
Switch2(config)# spanning-tree vlan 20 root secondary
```

### 8.5 STP 验证和调试

**查看 STP 状态**：
```
Switch# show spanning-tree
```

**查看 STP 详细信息**：
```
Switch# show spanning-tree detail
```

**查看根桥信息**：
```
Switch# show spanning-tree root
```

**Debug STP**：
```
Switch# debug spanning-tree events
```

### 8.6 快速生成树协议 (RSTP)

#### RSTP 改进

**1. 快速转换**
- 端口状态减少到 3 个
- 省略 Listening 状态

**2. 新增端口角色**
- **备份端口 (Backup Port)**：指定端口的备份
- **替代端口 (Alternate Port)**：根端口的备份

**3. 握手机制**
- 使用 Proposal/Agreement 机制
- 快速建立转发状态

#### RSTP 配置

**启用 RSTP**：
```
Switch(config)# spanning-tree mode rapid-pvst
```

### 8.7 本章实验

#### 实验 8-1：STP 配置

**实验目的**：掌握 STP 的配置和验证

**实验设备**：
- Cisco 交换机 3 台
- PC 3 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 --- Switch1 --- Switch2 --- Switch3 --- PC2
          |           |
          +-----------+
   ```

2. **配置 Switch1 为根桥**
   ```
   Switch1(config)# spanning-tree mode pvst
   Switch1(config)# spanning-tree vlan 1 root primary
   Switch1(config)# end
   Switch1# show spanning-tree
   ```

3. **配置 Switch2 为备份根桥**
   ```
   Switch2(config)# spanning-tree mode pvst
   Switch2(config)# spanning-tree vlan 1 root secondary
   Switch2(config)# end
   Switch2# show spanning-tree
   ```

4. **查看 STP 状态**
   ```
   Switch3# show spanning-tree
   ```

5. **测试环路消除**
   ```bash
   # 查看 STP 阻塞的端口
   Switch3# show spanning-tree
   ```

**实验验证**：
- Switch1 成为根桥
- 某些端口处于阻塞状态
- 网络中无环路

### 8.8 本章小结

本章介绍了生成树协议：

**核心知识点**：
- STP 的作用和原理
- STP 端口状态
- STP 类型（STP、RSTP、MSTP、PVST+）
- STP 配置
- RSTP 改进

**重点记忆**：
- STP 消除环路，防止广播风暴
- 根桥是桥 ID 最小的交换机
- STP 端口状态：Blocking、Listening、Learning、Forwarding
- RSTP 收敛更快
- PVST+ 每个 VLAN 一个生成树

### 8.9 练习题

#### 选择题

1. STP 的主要作用是？
   - A. 提高带宽
   - B. 消除环路
   - C. 增加安全性
   - D. 简化管理

2. 默认的桥优先级是？
   - A. 0
   - B. 1
   - C. 32768
   - D. 65535

3. STP 的根端口选举依据是？
   - A. 端口优先级
   - B. 到根桥的路径成本
   - C. 端口号
   - D. MAC 地址

4. RSTP 的收敛时间大约是？
   - A. 30-50 秒
   - B. 10-20 秒
   - C. 几秒
   - D. 1 分钟

5. PVST+ 是哪家公司的私有协议？
   - A. Juniper
   - B. Huawei
   - C. Cisco
   - D. H3C

#### 填空题

1. STP 的作用是 ________。

2. 根桥是桥 ID ________ 的交换机。

3. STP 端口状态包括 ________、________、________、________。

4. RSTP 的全称是 ________。

5. 查看 STP 状态的命令是 ________。

#### 简答题

1. 为什么需要 STP？

2. 简述 STP 的工作原理。

3. STP 有哪些端口状态？每个状态的作用是什么？

4. 比较 STP 和 RSTP 的区别。

5. 如何配置根桥？

#### 实验题

1. 在 Packet Tracer 中配置 STP，观察端口状态变化。

2. 配置 RSTP，比较收敛速度。

### 8.10 参考答案

#### 选择题

1. B
2. C
3. B
4. C
5. C

#### 填空题

1. 消除环路
2. 最小
3. Blocking，Listening，Learning，Forwarding
4. Rapid Spanning Tree Protocol
5. show spanning-tree

#### 简答题

1. STP 消除交换网络中的环路，防止广播风暴、MAC 地址表不稳定和重复帧等问题。

2. STP 通过选举根桥、根端口、指定端口，阻塞非指定端口，构建无环路的生成树。

3. Blocking：阻塞状态，不转发数据；Listening：监听状态，不转发数据；Learning：学习状态，学习 MAC 地址；Forwarding：转发状态，转发数据。

4. STP 收敛慢（30-50 秒），RSTP 收敛快（几秒）；RSTP 省略 Listening 状态，使用握手机制快速转换。

5. 配置根桥：Switch(config)# spanning-tree vlan [VLAN ID] root primary

---

## 第9章：EtherChannel 与高级交换技术

### 9.1 EtherChannel 概述

#### 什么是 EtherChannel？

**EtherChannel**（也称为 Port Channel）是将多个物理链路捆绑成一个逻辑链路的技术。

**优点**：
- 增加带宽
- 提供冗余
- 负载均衡
- 简化管理

**应用场景**：
- 交换机之间互联
- 交换机和服务器之间
- 路由器和交换机之间

### 9.2 EtherChannel 协议

**1. LACP (Link Aggregation Control Protocol)**
- IEEE 802.3ad 标准
- 动态协商
- 支持多厂商设备

**2. PAgP (Port Aggregation Protocol)**
- Cisco 私有协议
- 动态协商
- 仅支持 Cisco 设备

**3. 静态**
- 手动配置
- 无协议协商
- 不检查配置一致性

### 9.3 EtherChannel 配置

**LACP 配置**：
```
Switch(config)# interface range [接口列表]
Switch(config-if-range)# channel-group [组号] mode [active|passive]
```

**PAgP 配置**：
```
Switch(config)# interface range [接口列表]
Switch(config-if-range)# channel-group [组号] mode [auto|desirable]
```

**静态配置**：
```
Switch(config)# interface range [接口列表]
Switch(config-if-range)# channel-group [组号] mode on
```

**LACP 模式**：
- **active**：主动发送 LACP 包
- **passive**：被动等待 LACP 包

**PAgP 模式**：
- **auto**：被动等待 PAgP 包
- **desirable**：主动发送 PAgP 包

#### EtherChannel 配置示例

**配置 Switch1**：
```
Switch1(config)# interface range gigabitethernet0/1-2
Switch1(config-if-range)# channel-group 1 mode active
Switch1(config-if-range)# exit
Switch1(config)# interface port-channel 1
Switch1(config-if)# switchport mode trunk
Switch1(config-if)# switchport trunk allowed vlan 10,20
Switch1(config-if)# end
Switch1# show etherchannel summary
```

**配置 Switch2**：
```
Switch2(config)# interface range gigabitethernet0/1-2
Switch2(config-if-range)# channel-group 1 mode active
Switch2(config-if-range)# exit
Switch2(config)# interface port-channel 1
Switch2(config-if)# switchport mode trunk
Switch2(config-if)# switchport trunk allowed vlan 10,20
Switch2(config-if)# end
Switch2# show etherchannel summary
```

### 9.4 EtherChannel 负载均衡

**负载均衡算法**：
- **src-ip**：源 IP 地址
- **dst-ip**：目的 IP 地址
- **src-dst-ip**：源和目的 IP 地址
- **src-mac**：源 MAC 地址
- **dst-mac**：目的 MAC 地址
- **src-dst-mac**：源和目的 MAC 地址

**配置负载均衡**：
```
Switch(config)# port-channel load-balance [算法]
```

**示例**：
```
Switch(config)# port-channel load-balance src-dst-ip
```

### 9.5 EtherChannel 验证和调试

**查看 EtherChannel 摘要**：
```
Switch# show etherchannel summary
```

**查看 EtherChannel 详细信息**：
```
Switch# show etherchannel [组号] detail
```

**查看端口通道信息**：
```
Switch# show interface port-channel [组号]
```

### 9.6 其他高级交换技术

#### 端口安全

**作用**：限制端口上允许的 MAC 地址数量，防止未授权设备接入。

**配置端口安全**：
```
Switch(config)# interface [接口]
Switch(config-if)# switchport mode access
Switch(config-if)# switchport port-security
Switch(config-if)# switchport port-security maximum [数量]
Switch(config-if)# switchport port-security violation [protect|restrict|shutdown]
```

**示例**：
```
Switch(config)# interface fastethernet0/1
Switch(config-if)# switchport mode access
Switch(config-if)# switchport port-security
Switch(config-if)# switchport port-security maximum 2
Switch(config-if)# switchport port-security violation shutdown
```

**查看端口安全**：
```
Switch# show port-security
```

#### DHCP Snooping

**作用**：防止虚假 DHCP 服务器攻击。

**配置 DHCP Snooping**：
```
Switch(config)# ip dhcp snooping
Switch(config)# ip dhcp snooping vlan [VLAN ID]
Switch(config-if)# ip dhcp snooping trust
```

**示例**：
```
Switch(config)# ip dhcp snooping
Switch(config)# ip dhcp snooping vlan 10,20
Switch(config)# interface gigabitethernet0/1
Switch(config-if)# ip dhcp snooping trust
```

**查看 DHCP Snooping**：
```
Switch# show ip dhcp snooping
```

#### 动态 ARP 检测 (DAI)

**作用**：防止 ARP 欺骗攻击。

**配置 DAI**：
```
Switch(config)# ip arp inspection vlan [VLAN ID]
Switch(config-if)# ip arp inspection trust
```

**示例**：
```
Switch(config)# ip arp inspection vlan 10,20
Switch(config)# interface gigabitethernet0/1
Switch(config-if)# ip arp inspection trust
```

**查看 DAI**：
```
Switch# show ip arp inspection
```

### 9.7 本章实验

#### 实验 9-1：EtherChannel 配置

**实验目的**：掌握 EtherChannel 的配置

**实验设备**：
- Cisco 交换机 2 台
- PC 2 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 --- Switch1 --- EtherChannel --- Switch2 --- PC2
   ```

2. **配置 Switch1**
   ```
   Switch1(config)# interface range gigabitethernet0/1-2
   Switch1(config-if-range)# channel-group 1 mode active
   Switch1(config-if-range)# exit
   Switch1(config)# interface port-channel 1
   Switch1(config-if)# switchport mode trunk
   Switch1(config-if)# switchport trunk allowed vlan 10
   Switch1(config-if)# end
   Switch1# show etherchannel summary
   ```

3. **配置 Switch2**
   ```
   Switch2(config)# interface range gigabitethernet0/1-2
   Switch2(config-if-range)# channel-group 1 mode active
   Switch2(config-if-range)# exit
   Switch2(config)# interface port-channel 1
   Switch2(config-if)# switchport mode trunk
   Switch2(config-if)# switchport trunk allowed vlan 10
   Switch2(config-if)# end
   Switch2# show etherchannel summary
   ```

4. **测试链路冗余**
   ```
   # 断开一条链路
   Switch1(config)# interface gigabitethernet0/1
   Switch1(config-if)# shutdown

   # 验证连通性
   Switch1# show etherchannel summary
   ```

**实验验证**：
- EtherChannel 创建成功
- 链路聚合正常工作
- 断开一条链路后，通信不受影响

### 9.8 本章小结

本章介绍了 EtherChannel 和高级交换技术：

**核心知识点**：
- EtherChannel 的作用和优点
- EtherChannel 协议（LACP、PAgP、静态）
- EtherChannel 配置
- EtherChannel 负载均衡
- 端口安全
- DHCP Snooping
- 动态 ARP 检测

**重点记忆**：
- EtherChannel 增加带宽和提供冗余
- LACP 是标准协议，PAgP 是 Cisco 私有
- 负载均衡算法有多种选择
- 端口安全限制 MAC 地址数量
- DHCP Snooping 防止虚假 DHCP 服务器
- DAI 防止 ARP 欺骗

### 9.9 练习题

#### 选择题

1. EtherChannel 的主要作用是？
   - A. 增加安全性
   - B. 增加带宽和提供冗余
   - C. 简化管理
   - D. 提高性能

2. LACP 是什么协议？
   - A. Cisco 私有协议
   - B. IEEE 标准协议
   - C. IETF 标准协议
   - D. ITU 标准协议

3. EtherChannel 的 LACP active 模式表示？
   - A. 主动发送 LACP 包
   - B. 被动等待 LACP 包
   - C. 不发送 LACP 包
   - D. 随机发送 LACP 包

4. 端口安全的主要作用是？
   - A. 防止环路
   - B. 限制 MAC 地址数量
   - C. 提高带宽
   - D. 简化管理

5. DHCP Snooping 的作用是？
   - A. 防止 ARP 欺骗
   - B. 防止虚假 DHCP 服务器
   - C. 防止 MAC 地址欺骗
   - D. 防止 IP 地址欺骗

#### 填空题

1. EtherChannel 也称为 ________。

2. LACP 是 ________ 协议，PAgP 是 ________ 协议。

3. EtherChannel 的负载均衡算法包括 ________、________、________ 等。

4. 端口安全可以限制端口上允许的 ________ 数量。

5. DHCP Snooping 的作用是 ________。

#### 简答题

1. 什么是 EtherChannel？EtherChannel 有什么优点？

2. 比较 LACP 和 PAgP 的区别。

3. 如何配置 EtherChannel？

4. 什么是端口安全？端口安全有什么作用？

5. 什么是 DHCP Snooping？DHCP Snooping 有什么作用？

#### 实验题

1. 在 Packet Tracer 中配置 EtherChannel，测试链路冗余。

2. 配置端口安全，限制端口上的 MAC 地址数量。

### 9.10 参考答案

#### 选择题

1. B
2. B
3. A
4. B
5. B

#### 填空题

1. Port Channel
2. IEEE 标准，Cisco 私有
3. src-ip，dst-ip，src-dst-ip
4. MAC 地址
5. 防止虚假 DHCP 服务器攻击

#### 简答题

1. EtherChannel 是将多个物理链路捆绑成一个逻辑链路的技术。优点：增加带宽、提供冗余、负载均衡、简化管理。

2. LACP 是 IEEE 标准协议，支持多厂商设备；PAgP 是 Cisco 私有协议，仅支持 Cisco 设备。

3. 配置 EtherChannel：Switch(config-if-range)# channel-group [组号] mode [active|passive|auto|desirable|on]

4. 端口安全是限制端口上允许的 MAC 地址数量的技术。作用：防止未授权设备接入，提高网络安全性。

5. DHCP Snooping 是防止虚假 DHCP 服务器攻击的技术。作用：建立 DHCP 绑定表，验证 DHCP 报文的合法性。

---

*（第三部分：交换技术篇 完）*

# 第四部分：安全与优化篇

## 第10章：访问控制列表 (ACL)

### 10.1 ACL 概述

#### 什么是 ACL？

**ACL**（Access Control List，访问控制列表）是用于控制网络流量的规则列表。

**作用**：
- 过滤网络流量
- 限制网络访问
- 提高网络安全性
- 控制路由更新

#### ACL 类型

**1. 标准 ACL**
- 基于 IP 地址
- 编号范围：1-99, 1300-1999
- 只能过滤源地址
- 放置位置：尽可能靠近目的地

**2. 扩展 ACL**
- 基于 IP 地址、端口号、协议
- 编号范围：100-199, 2000-2699
- 可以过滤源和目的地址
- 放置位置：尽可能靠近源

**3. 命名 ACL**
- 使用名称代替编号
- 可以删除单个规则
- 更易于管理

### 10.2 ACL 工作原理

**处理顺序**：
1. 从上到下依次匹配
2. 匹配到第一条规则后立即执行
3. 如果没有匹配，默认拒绝所有（隐式 deny）

**通配符掩码**：
- 0：必须匹配
- 1：可以不匹配

**示例**：
```
0.0.0.0    → 匹配所有位（host）
255.255.255.255 → 不匹配任何位（any）
```

### 10.3 标准 ACL 配置

**语法**：
```
access-list [编号] [permit|deny] [源地址] [通配符掩码]
```

**示例**：
```
# 允许 192.168.1.0/24 网络
access-list 10 permit 192.168.1.0 0.0.0.255

# 拒绝 192.168.2.0/24 网络
access-list 10 deny 192.168.2.0 0.0.0.255

# 允许所有其他网络
access-list 10 permit any
```

**应用 ACL**：
```
interface [接口]
ip access-group [ACL 编号] [in|out]
```

**示例**：
```
interface gigabitethernet0/0
ip access-group 10 in
```

### 10.4 扩展 ACL 配置

**语法**：
```
access-list [编号] [permit|deny] [协议] [源地址] [通配符掩码] [目的地址] [通配符掩码] [eq|gt|lt] [端口号]
```

**示例**：
```
# 允许 192.168.1.0/24 访问 192.168.2.10 的 Web 服务
access-list 100 permit tcp 192.168.1.0 0.0.0.255 host 192.168.2.10 eq 80

# 允许 192.168.1.0/24 访问 192.168.2.10 的 DNS 服务
access-list 100 permit udp 192.168.1.0 0.0.0.255 host 192.168.2.10 eq 53

# 拒绝 192.168.1.0/24 访问 192.168.2.0/24 的所有流量
access-list 100 deny ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255

# 允许所有其他流量
access-list 100 permit ip any any
```

### 10.5 命名 ACL 配置

**标准命名 ACL**：
```
ip access-list standard [名称]
 [permit|deny] [源地址] [通配符掩码]
```

**示例**：
```
ip access-list standard SALES_ACL
 permit 192.168.1.0 0.0.0.255
 deny 192.168.2.0 0.0.0.255
 permit any
```

**扩展命名 ACL**：
```
ip access-list extended [名称]
 [permit|deny] [协议] [源地址] [通配符掩码] [目的地址] [通配符掩码] [eq|gt|lt] [端口号]
```

**示例**：
```
ip access-list extended WEB_ACL
 permit tcp 192.168.1.0 0.0.0.255 host 192.168.2.10 eq 80
 permit tcp 192.168.1.0 0.0.0.255 host 192.168.2.10 eq 443
 deny ip 192.168.1.0 0.0.0.255 192.168.2.0 0.0.0.255
 permit ip any any
```

### 10.6 ACL 验证和调试

**查看 ACL**：
```
show access-lists
show access-lists [编号或名称]
```

**查看 ACL 应用情况**：
```
show ip interface [接口]
```

**Debug ACL**：
```
debug ip packet [ACL 编号]
```

### 10.7 本章实验

#### 实验 10-1：标准 ACL 配置

**实验目的**：掌握标准 ACL 的配置

**实验设备**：
- Cisco 路由器 2 台
- PC 3 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 (192.168.1.10) --- Router1 (192.168.1.1, 10.0.0.1) --- Router2 (10.0.0.2, 192.168.2.1) --- PC2 (192.168.2.10)
   PC3 (192.168.1.20) --- Router1
   ```

2. **配置路由器**
   ```
   Router1(config)# interface gigabitethernet0/0
   Router1(config-if)# ip address 192.168.1.1 255.255.255.0
   Router1(config-if)# no shutdown
   Router1(config-if)# exit
   Router1(config)# interface gigabitethernet0/1
   Router1(config-if)# ip address 10.0.0.1 255.255.255.252
   Router1(config-if)# no shutdown
   Router1(config-if)# exit
   Router1(config)# ip route 192.168.2.0 255.255.255.0 10.0.0.2

   Router2(config)# interface gigabitethernet0/0
   Router2(config-if)# ip address 10.0.0.2 255.255.255.252
   Router2(config-if)# no shutdown
   Router2(config-if)# exit
   Router2(config)# interface gigabitethernet0/1
   Router2(config-if)# ip address 192.168.2.1 255.255.255.0
   Router2(config-if)# no shutdown
   Router2(config-if)# exit
   Router2(config)# ip route 192.168.1.0 255.255.255.0 10.0.0.1
   ```

3. **配置标准 ACL**
   ```
   Router1(config)# access-list 10 permit host 192.168.1.10
   Router1(config)# access-list 10 deny 192.168.1.0 0.0.0.255
   Router1(config)# access-list 10 permit any
   Router1(config)# interface gigabitethernet0/1
   Router1(config-if)# ip access-group 10 out
   ```

4. **测试 ACL**
   ```bash
   # PC1 ping PC2（应该通）
   ping 192.168.2.10

   # PC3 ping PC2（应该不通）
   ping 192.168.2.10
   ```

**实验验证**：
- PC1 可以访问 PC2
- PC3 不能访问 PC2
- ACL 正确应用

### 10.8 本章小结

本章介绍了访问控制列表：

**核心知识点**：
- ACL 的类型（标准、扩展、命名）
- ACL 的工作原理
- 标准 ACL 配置
- 扩展 ACL 配置
- 命名 ACL 配置

**重点记忆**：
- 标准 ACL 只能过滤源地址，扩展 ACL 可以过滤源和目的地址
- ACL 从上到下匹配，匹配到第一条后立即执行
- 默认隐式拒绝所有
- 标准 ACL 放在靠近目的地，扩展 ACL 放在靠近源

### 10.9 练习题

#### 选择题

1. 标准 ACL 的编号范围是？
   - A. 1-99
   - B. 100-199
   - C. 200-299
   - D. 300-399

2. 扩展 ACL 可以过滤哪些信息？
   - A. 只能过滤源地址
   - B. 只能过滤目的地址
   - C. 可以过滤源和目的地址
   - D. 不能过滤地址

3. ACL 的默认动作是？
   - A. 允许所有
   - B. 拒绝所有
   - C. 转发所有
   - D. 丢弃所有

4. 通配符掩码 0.0.0.0 表示？
   - A. 匹配所有位
   - B. 不匹配任何位
   - C. 匹配前 8 位
   - D. 匹配前 16 位

5. 标准 ACL 应该放在？
   - A. 靠近源
   - B. 靠近目的地
   - C. 任意位置
   - D. 核心路由器

#### 填空题

1. ACL 的全称是 ________。

2. 标准 ACL 的编号范围是 ________ 和 ________。

3. 扩展 ACL 的编号范围是 ________ 和 ________。

4. ACL 的默认动作是 ________。

5. 通配符掩码 255.255.255.255 表示 ________。

#### 简答题

1. 什么是 ACL？ACL 有什么作用？

2. 比较标准 ACL 和扩展 ACL 的区别。

3. ACL 的工作原理是什么？

4. 如何配置标准 ACL？

5. 如何配置扩展 ACL？

#### 实验题

1. 配置标准 ACL，限制特定网络的访问。

2. 配置扩展 ACL，限制特定端口的访问。

### 10.10 参考答案

#### 选择题

1. A
2. C
3. B
4. A
5. B

#### 填空题

1. Access Control List
2. 1-99，1300-1999
3. 100-199，2000-2699
4. 拒绝所有
5. 不匹配任何位（any）

#### 简答题

1. ACL 是用于控制网络流量的规则列表。作用：过滤网络流量、限制网络访问、提高网络安全性、控制路由更新。

2. 标准 ACL 只能过滤源地址，扩展 ACL 可以过滤源和目的地址、端口号、协议。

3. ACL 从上到下依次匹配，匹配到第一条规则后立即执行，如果没有匹配，默认拒绝所有。

4. 配置标准 ACL：access-list [编号] [permit|deny] [源地址] [通配符掩码]

5. 配置扩展 ACL：access-list [编号] [permit|deny] [协议] [源地址] [通配符掩码] [目的地址] [通配符掩码] [eq|gt|lt] [端口号]

---

## 第11章：NAT 与网络安全

### 11.1 NAT 概述

#### 什么是 NAT？

**NAT**（Network Address Translation，网络地址转换）是将私有 IP 地址转换为公有 IP 地址的技术。

**作用**：
- 节省公有 IP 地址
- 提高网络安全性
- 简化网络管理
- 支持 IP 地址重叠

#### NAT 类型

**1. 静态 NAT**
- 一对一映射
- 私有地址 → 公有地址
- 适用于服务器

**2. 动态 NAT**
- 多对多映射
- 私有地址池 → 公有地址池
- 临时映射

**3. PAT (NAT Overload)**
- 多对一映射
- 多个私有地址 → 一个公有地址
- 使用端口号区分
- 最常用

### 11.2 静态 NAT 配置

**语法**：
```
ip nat inside source static [内部地址] [外部地址]
```

**示例**：
```
Router(config)# interface gigabitethernet0/0
Router(config-if)# ip address 192.168.1.1 255.255.255.0
Router(config-if)# ip nat inside
Router(config-if)# exit

Router(config)# interface gigabitethernet0/1
Router(config-if)# ip address 203.0.113.1 255.255.255.0
Router(config-if)# ip nat outside
Router(config-if)# exit

Router(config)# ip nat inside source static 192.168.1.10 203.0.113.10
```

### 11.3 动态 NAT 配置

**语法**：
```
ip nat pool [池名] [起始地址] [结束地址] netmask [子网掩码]
access-list [编号] permit [源地址] [通配符掩码]
ip nat inside source list [ACL编号] pool [池名]
```

**示例**：
```
Router(config)# ip nat pool PUBLIC 203.0.113.10 203.0.113.20 netmask 255.255.255.0
Router(config)# access-list 1 permit 192.168.1.0 0.0.0.255
Router(config)# ip nat inside source list 1 pool PUBLIC
```

### 11.4 PAT 配置

**语法**：
```
ip nat inside source list [ACL编号] interface [外部接口] overload
```

**示例**：
```
Router(config)# access-list 1 permit 192.168.1.0 0.0.0.255
Router(config)# ip nat inside source list 1 interface gigabitethernet0/1 overload
```

### 11.5 NAT 验证和调试

**查看 NAT 转换**：
```
show ip nat translations
```

**查看 NAT 统计**：
```
show ip nat statistics
```

**Debug NAT**：
```
debug ip nat
```

### 11.6 本章实验

#### 实验 11-1：PAT 配置

**实验目的**：掌握 PAT 的配置

**实验设备**：
- Cisco 路由器 1 台
- PC 2 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 (192.168.1.10) --- Router (192.168.1.1, 203.0.113.1) --- Internet
   PC2 (192.168.1.20) --- Router
   ```

2. **配置路由器**
   ```
   Router(config)# interface gigabitethernet0/0
   Router(config-if)# ip address 192.168.1.1 255.255.255.0
   Router(config-if)# ip nat inside
   Router(config-if)# no shutdown
   Router(config-if)# exit

   Router(config)# interface gigabitethernet0/1
   Router(config-if)# ip address 203.0.113.1 255.255.255.0
   Router(config-if)# ip nat outside
   Router(config-if)# no shutdown
   Router(config-if)# exit

   Router(config)# access-list 1 permit 192.168.1.0 0.0.0.255
   Router(config)# ip nat inside source list 1 interface gigabitethernet0/1 overload
   Router(config)# ip route 0.0.0.0 0.0.0.0 203.0.113.254
   ```

3. **配置 PC**
   - PC1：192.168.1.10/24，网关 192.168.1.1
   - PC2：192.168.1.20/24，网关 192.168.1.1

4. **测试 NAT**
   ```bash
   # 在 PC1 上访问互联网
   ping 8.8.8.8

   # 查看 NAT 转换
   Router# show ip nat translations
   ```

**实验验证**：
- PC 可以访问互联网
- NAT 转换正常工作
- 多个 PC 共享一个公有 IP 地址

### 11.7 本章小结

本章介绍了 NAT 和网络安全：

**核心知识点**：
- NAT 的类型（静态、动态、PAT）
- 静态 NAT 配置
- 动态 NAT 配置
- PAT 配置
- NAT 验证和调试

**重点记忆**：
- 静态 NAT 是一对一映射
- 动态 NAT 是多对多映射
- PAT 是多对一映射，最常用
- 需要标记 inside 和 outside 接口
- 使用 overload 关键字启用 PAT

### 11.8 练习题

#### 选择题

1. NAT 的主要作用是？
   - A. 提高带宽
   - B. 节省公有 IP 地址
   - C. 简化管理
   - D. 提高性能

2. PAT 的特点是？
   - A. 一对一映射
   - B. 多对多映射
   - C. 多对一映射
   - D. 一对多映射

3. 静态 NAT 适用于？
   - A. 内网用户
   - B. 服务器
   - C. 打印机
   - D. 路由器

4. 配置 PAT 需要使用哪个关键字？
   - A. static
   - B. pool
   - C. overload
   - D. dynamic

5. NAT 的 inside 接口是指？
   - A. 连接互联网的接口
   - B. 连接内网的接口
   - C. 连接 DMZ 的接口
   - D. 连接 VPN 的接口

#### 填空题

1. NAT 的全称是 ________。

2. PAT 也称为 ________。

3. 静态 NAT 是 ________ 映射。

4. 配置 NAT 需要标记 ________ 和 ________ 接口。

5. 查看 NAT 转换的命令是 ________。

#### 简答题

1. 什么是 NAT？NAT 有什么作用？

2. 比较 NAT 三种类型的区别。

3. 如何配置静态 NAT？

4. 如何配置 PAT？

5. NAT 的 inside 和 outside 接口有什么区别？

#### 实验题

1. 配置静态 NAT，使内网服务器可以被外网访问。

2. 配置 PAT，使内网用户可以访问互联网。

### 11.9 参考答案

#### 选择题

1. B
2. C
3. B
4. C
5. B

#### 填空题

1. Network Address Translation
2. NAT Overload
3. 一对一
4. inside，outside
5. show ip nat translations

#### 简答题

1. NAT 是将私有 IP 地址转换为公有 IP 地址的技术。作用：节省公有 IP 地址、提高网络安全性、简化网络管理。

2. 静态 NAT 是一对一映射，动态 NAT 是多对多映射，PAT 是多对一映射。

3. 配置静态 NAT：ip nat inside source static [内部地址] [外部地址]

4. 配置 PAT：ip nat inside source list [ACL编号] interface [外部接口] overload

5. inside 接口连接内网，outside 接口连接互联网。

---

## 第12章：DHCP、DNS 与网络服务

### 12.1 DHCP 概述

#### 什么是 DHCP？

**DHCP**（Dynamic Host Configuration Protocol，动态主机配置协议）是自动分配 IP 地址和其他网络配置的协议。

**优点**：
- 自动分配 IP 地址
- 减少配置错误
- 简化网络管理
- 提高效率

#### DHCP 工作过程

**1. DHCP Discover**
- 客户端广播 DHCP Discover
- 寻找 DHCP 服务器

**2. DHCP Offer**
- DHCP 服务器回复 DHCP Offer
- 提供可用的 IP 地址

**3. DHCP Request**
- 客户端广播 DHCP Request
- 请求使用提供的 IP 地址

**4. DHCP ACK**
- DHCP 服务器回复 DHCP ACK
- 确认 IP 地址分配

### 12.2 DHCP 配置

**配置 DHCP 池**：
```
ip dhcp pool [池名]
 network [网络地址] [子网掩码]
 default-router [默认网关]
 dns-server [DNS 服务器地址]
 domain-name [域名]
 lease [天数]
```

**示例**：
```
Router(config)# ip dhcp excluded-address 192.168.1.1 192.168.1.10
Router(config)# ip dhcp pool LAN_POOL
Router(dhcp-config)# network 192.168.1.0 255.255.255.0
Router(dhcp-config)# default-router 192.168.1.1
Router(dhcp-config)# dns-server 8.8.8.8 8.8.4.4
Router(dhcp-config)# domain-name example.com
Router(dhcp-config)# lease 7
Router(dhcp-config)# exit
```

### 12.3 DHCP 验证和调试

**查看 DHCP 池**：
```
show ip dhcp pool
```

**查看 DHCP 绑定**：
```
show ip dhcp binding
```

**Debug DHCP**：
```
debug ip dhcp server packet
```

### 12.4 DNS 概述

#### 什么是 DNS？

**DNS**（Domain Name System，域名系统）是将域名转换为 IP 地址的系统。

**作用**：
- 域名解析
- 反向解析
- 邮件路由
- 负载均衡

#### DNS 记录类型

**1. A 记录**
- 域名 → IPv4 地址

**2. AAAA 记录**
- 域名 → IPv6 地址

**3. CNAME 记录**
- 域名别名

**4. MX 记录**
- 邮件服务器

**5. NS 记录**
- 域名服务器

### 12.5 本章实验

#### 实验 12-1：DHCP 配置

**实验目的**：掌握 DHCP 的配置

**实验设备**：
- Cisco 路由器 1 台
- PC 2 台

**实验步骤**：

1. **网络拓扑**
   ```
   PC1 --- Router (192.168.1.1) --- PC2
   ```

2. **配置 DHCP**
   ```
   Router(config)# ip dhcp excluded-address 192.168.1.1 192.168.1.10
   Router(config)# ip dhcp pool LAN_POOL
   Router(dhcp-config)# network 192.168.1.0 255.255.255.0
   Router(dhcp-config)# default-router 192.168.1.1
   Router(dhcp-config)# dns-server 8.8.8.8
   Router(dhcp-config)# domain-name example.com
   Router(dhcp-config)# lease 7
   Router(dhcp-config)# exit
   ```

3. **配置路由器接口**
   ```
   Router(config)# interface gigabitethernet0/0
   Router(config-if)# ip address 192.168.1.1 255.255.255.0
   Router(config-if)# no shutdown
   ```

4. **配置 PC**
   - PC1：自动获取 IP 地址
   - PC2：自动获取 IP 地址

5. **验证 DHCP**
   ```
   Router# show ip dhcp binding
   Router# show ip dhcp pool
   ```

**实验验证**：
- PC 自动获取 IP 地址
- DHCP 绑定正常
- 可以访问网络

### 12.6 本章小结

本章介绍了 DHCP、DNS 与网络服务：

**核心知识点**：
- DHCP 的工作过程
- DHCP 配置
- DNS 的作用和记录类型

**重点记忆**：
- DHCP 四步：Discover、Offer、Request、ACK
- 配置 DHCP 池需要指定网络、网关、DNS
- DNS 将域名转换为 IP 地址
- 常见 DNS 记录：A、AAAA、CNAME、MX、NS

### 12.7 练习题

#### 选择题

1. DHCP 使用的传输层协议是？
   - A. TCP
   - B. UDP
   - C. ICMP
   - D. IP

2. DHCP 使用的端口号是？
   - A. 53
   - B. 67
   - C. 80
   - D. 443

3. DNS 的主要作用是？
   - A. 分配 IP 地址
   - B. 域名解析
   - C. 路由选择
   - D. 安全认证

4. A 记录的作用是？
   - A. 域名 → IPv4 地址
   - B. 域名 → IPv6 地址
   - C. 域名别名
   - D. 邮件服务器

5. DHCP Discover 使用什么方式发送？
   - A. 单播
   - B. 广播
   - C. 组播
   - D. 任播

#### 填空题

1. DHCP 的全称是 ________。

2. DHCP 使用的端口号是 ________ 和 ________。

3. DNS 的全称是 ________。

4. A 记录将域名转换为 ________ 地址。

5. 查看 DHCP 绑定的命令是 ________。

#### 简答题

1. 简述 DHCP 的工作过程。

2. 什么是 DNS？DNS 有什么作用？

3. 如何配置 DHCP？

4. 列举常见的 DNS 记录类型及其作用。

#### 实验题

1. 配置 DHCP 服务器，使 PC 自动获取 IP 地址。

2. 配置 DNS 服务器，实现域名解析。

### 12.8 参考答案

#### 选择题

1. B
2. B
3. B
4. A
5. B

#### 填空题

1. Dynamic Host Configuration Protocol
2. 67，68
3. Domain Name System
4. IPv4
5. show ip dhcp binding

#### 简答题

1. DHCP 工作过程：客户端广播 DHCP Discover，服务器回复 DHCP Offer，客户端广播 DHCP Request，服务器回复 DHCP ACK。

2. DNS 是将域名转换为 IP 地址的系统。作用：域名解析、反向解析、邮件路由、负载均衡。

3. 配置 DHCP：ip dhcp pool [池名]，指定网络、网关、DNS 等参数。

4. A 记录：域名 → IPv4 地址；AAAA 记录：域名 → IPv6 地址；CNAME 记录：域名别名；MX 记录：邮件服务器；NS 记录：域名服务器。

---

*（第四部分：安全与优化篇 完）*

# 第五部分：高级主题篇

## 第13章：IPv6 基础

### 13.1 IPv6 概述

#### 为什么需要 IPv6？

**IPv4 的问题**：
- 地址空间不足（约 43 亿个地址）
- 地址分配不均
- 配置复杂
- 安全性不足

**IPv6 的优势**：
- 地址空间巨大（2^128 个地址）
- 简化的头部
- 内置安全（IPsec）
- 自动配置
- 更好的 QoS 支持

### 13.2 IPv6 地址格式

**地址格式**：
- 128 位
- 冒号分隔十六进制
- 例如：2001:0db8:85a3:0000:0000:8a2e:0370:7334

**地址简化**：
- 每组前导零可以省略
- 连续的全零组可以用 :: 表示（只能使用一次）

**示例**：
```
2001:0db8:85a3:0000:0000:8a2e:0370:7334
  ↓ 简化为
2001:db8:85a3::8a2e:370:7334
```

### 13.3 IPv6 地址类型

**1. 单播地址**
- **全球单播地址**：类似 IPv4 公有地址
- **链路本地地址**：fe80::/10，仅用于本地链路
- **唯一本地地址**：fc00::/7，类似 IPv4 私有地址

**2. 组播地址**
- ff00::/8
- 用于一对多通信

**3. 任播地址**
- 从单播地址分配
- 用于最近节点通信

### 13.4 IPv6 地址配置

**配置 IPv6 地址**：
```
interface [接口]
 ipv6 address [地址/前缀长度]
```

**示例**：
```
Router(config)# interface gigabitethernet0/0
Router(config-if)# ipv6 address 2001:db8::1/64
Router(config-if)# ipv6 address fe80::1 link-local
Router(config-if)# no shutdown
```

**启用 IPv6 路由**：
```
ipv6 unicast-routing
```

### 13.5 本章小结

本章介绍了 IPv6 基础：

**核心知识点**：
- IPv6 的优势
- IPv6 地址格式
- IPv6 地址类型
- IPv6 地址配置

**重点记忆**：
- IPv6 地址是 128 位
- 可以使用 :: 简化连续的零
- 链路本地地址：fe80::/10
- 唯一本地地址：fc00::/7

### 13.6 练习题

#### 选择题

1. IPv6 地址的位数是？
   - A. 32
   - B. 64
   - C. 128
   - D. 256

2. 链路本地地址的前缀是？
   - A. fc00::/7
   - B. fe80::/10
   - C. ff00::/8
   - D. 2001::/32

3. IPv6 地址可以使用什么符号简化连续的零？
   - A. ::
   - B. --
   - C. //
   - D. **

#### 填空题

1. IPv6 地址有 ________ 位。

2. 链路本地地址的前缀是 ________。

3. 唯一本地地址的前缀是 ________。

#### 简答题

1. 为什么需要 IPv6？

2. IPv6 有哪些地址类型？

3. 如何配置 IPv6 地址？

### 13.7 参考答案

#### 选择题

1. C
2. B
3. A

#### 填空题

1. 128
2. fe80::/10
3. fc00::/7

#### 简答题

1. IPv4 地址空间不足，IPv6 提供巨大的地址空间、简化的头部、内置安全、自动配置等优势。

2. 单播地址、组播地址、任播地址。

3. 配置 IPv6 地址：interface [接口]，ipv6 address [地址/前缀长度]

---

## 第14章：无线网络

### 14.1 无线网络概述

#### 802.11 标准

**802.11b**：
- 速度：11 Mbps
- 频段：2.4 GHz

**802.11a**：
- 速度：54 Mbps
- 频段：5 GHz

**802.11g**：
- 速度：54 Mbps
- 频段：2.4 GHz

**802.11n**：
- 速度：600 Mbps
- 频段：2.4/5 GHz
- MIMO 技术

**802.11ac**：
- 速度：6.93 Gbps
- 频段：5 GHz
- Wave 1/2

**802.11ax (Wi-Fi 6)**：
- 速度：9.6 Gbps
- 频段：2.4/5 GHz
- OFDMA 技术

### 14.2 无线架构

**1. 独立 AP**
- 每个 AP 独立工作
- 适用于小型网络

**2. 集中式架构**
- AP 连接到控制器
- 集中管理
- 适用于大型网络

**3. 云管理架构**
- AP 连接到云端
- 远程管理
- 适用于分布式网络

### 14.3 无线安全

**1. WEP**
- 已弃用
- 不安全

**2. WPA**
- 临时解决方案
- TKIP 加密

**3. WPA2**
- 使用 AES 加密
- 当前标准

**4. WPA3**
- 最新标准
- 增强安全性

### 14.4 本章小结

本章介绍了无线网络：

**核心知识点**：
- 802.11 标准
- 无线架构
- 无线安全

**重点记忆**：
- 802.11ax 是最新标准
- 集中式架构适用于大型网络
- WPA2/WPA3 是当前安全标准

### 14.5 练习题

#### 选择题

1. 802.11n 的最大速度是？
   - A. 54 Mbps
   - B. 600 Mbps
   - C. 6.93 Gbps
   - D. 9.6 Gbps

2. Wi-Fi 6 对应的标准是？
   - A. 802.11n
   - B. 802.11ac
   - C. 802.11ax
   - D. 802.11ad

3. 当前最安全的无线加密方式是？
   - A. WEP
   - B. WPA
   - C. WPA2
   - D. WPA3

#### 填空题

1. 802.11ac 的最大速度是 ________。

2. WPA3 使用 ________ 加密。

3. 集中式架构使用 ________ 管理 AP。

#### 简答题

1. 比较 802.11n、802.11ac、802.11ax 的区别。

2. 无线架构有哪些类型？

3. 无线安全有哪些方式？

### 14.6 参考答案

#### 选择题

1. B
2. C
3. D

#### 填空题

1. 6.93 Gbps
2. AES
3. 控制器

#### 简答题

1. 802.11n：600 Mbps，2.4/5 GHz；802.11ac：6.93 Gbps，5 GHz；802.11ax：9.6 Gbps，2.4/5 GHz，OFDMA。

2. 独立 AP、集中式架构、云管理架构。

3. WEP、WPA、WPA2、WPA3。

---

## 第15章：网络自动化与 SDN

### 15.1 网络自动化概述

#### 为什么需要网络自动化？

**传统网络管理的问题**：
- 手动配置，容易出错
- 效率低下
- 难以扩展
- 一致性差

**网络自动化的优势**：
- 提高效率
- 减少错误
- 快速部署
- 一致性好

### 15.2 自动化工具

**1. Ansible**
- 无代理
- 基于 YAML
- 易于学习

**2. Python**
- 灵活强大
- 丰富的库
- 广泛应用

**3. REST API**
- 标准接口
- 易于集成
- 跨平台

### 15.3 SDN 概述

#### 什么是 SDN？

**SDN**（Software Defined Networking，软件定义网络）是将控制平面与数据平面分离的网络架构。

**特点**：
- 控制平面集中化
- 数据平面可编程
- 网络虚拟化
- 自动化管理

#### SDN 架构

**1. 应用层**
- 网络应用
- 业务逻辑

**2. 控制层**
- SDN 控制器
- 网络智能

**3. 基础设施层**
- 网络设备
- 数据转发

### 15.4 Cisco SDN 解决方案

**1. SD-WAN**
- 软件定义广域网
- 优化 WAN 连接
- 降低成本

**2. SD-Access**
- 软件定义接入
- 自动化园区网络
- 增强安全

### 15.5 本章小结

本章介绍了网络自动化与 SDN：

**核心知识点**：
- 网络自动化的优势
- 自动化工具
- SDN 概念和架构
- Cisco SDN 解决方案

**重点记忆**：
- 网络自动化提高效率、减少错误
- Ansible 是无代理自动化工具
- SDN 分离控制平面和数据平面
- Cisco SD-WAN 和 SD-Access 是主要解决方案

### 15.6 练习题

#### 选择题

1. Ansible 的特点是？
   - A. 有代理
   - B. 无代理
   - C. 基于 XML
   - D. 基于 JSON

2. SDN 的核心思想是？
   - A. 控制平面与数据平面分离
   - B. 增加带宽
   - C. 提高安全性
   - D. 简化管理

3. Cisco SD-WAN 的作用是？
   - A. 园区网络
   - B. 广域网
   - C. 数据中心
   - D. 云网络

#### 填空题

1. Ansible 基于 ________ 语言。

2. SDN 将 ________ 平面与 ________ 平面分离。

3. Cisco SD-Access 用于 ________ 网络。

#### 简答题

1. 为什么需要网络自动化？

2. 什么是 SDN？SDN 有什么特点？

3. 列举常见的自动化工具。

### 15.7 参考答案

#### 选择题

1. B
2. A
3. B

#### 填空题

1. YAML
2. 控制，数据
3. 园区

#### 简答题

1. 网络自动化提高效率、减少错误、快速部署、保持一致性。

2. SDN 是将控制平面与数据平面分离的网络架构。特点：控制平面集中化、数据平面可编程、网络虚拟化、自动化管理。

3. Ansible、Python、REST API。

---

*（第五部分：高级主题篇 完）*

# 第七部分：CCIE 进阶篇

## 第19章：CCIE 路由与交换深入

### 19.1 CCIE 考试概述

#### CCIE Routing and Switching v5.1

**考试结构**：
- **笔试**：2 小时，100 道题
- **实验**：8 小时，实际配置和故障排除

**考试重点**：
- 网络基础设施（30%）
- 第二层技术（15%）
- 第三层技术（25%）
- VPN 技术（10%）
- 基础设施安全（10%）
- 基础设施服务（5%）
- 基础设施自动化（5%）

### 19.2 高级路由协议

#### OSPF 高级配置

**1. OSPF 区域类型详解**

**末梢区域 (Stub Area)**：
```
Router(config-router)# area [区域号] stub
```
- 不接收类型 5 LSA（外部 LSA）
- 接收类型 3 LSA（汇总 LSA）
- 使用默认路由到达外部网络

**完全末梢区域 (Totally Stub Area)**：
```
Router(config-router)# area [区域号] stub no-summary
```
- 不接收类型 3 和 5 LSA
- 只接收类型 1 和 2 LSA
- 使用默认路由到达所有非本区域网络

**NSSA (Not-So-Stubby Area)**：
```
Router(config-router)# area [区域号] nssa
```
- 允许引入外部路由
- 生成类型 7 LSA
- ABR 将类型 7 转换为类型 5

**2. OSPF 虚链路**

**用途**：连接非骨干区域到骨干区域

**配置**：
```
Router(config-router)# area [穿越区域号] virtual-link [对端路由器ID]
```

**示例**：
```
Router1(config)# router ospf 1
Router1(config-router)# router-id 1.1.1.1
Router1(config-router)# area 0 virtual-link 3.3.3.3
```

**3. OSPF 认证**

**简单密码认证**：
```
Router(config-if)# ip ospf authentication
Router(config-if)# ip ospf authentication-key [密码]
```

**MD5 认证**：
```
Router(config-if)# ip ospf authentication message-digest
Router(config-if)# ip ospf message-digest-key 1 md5 [密码]
```

**4. OSPF 默认路由**

**类型 3 默认路由**：
```
Router(config-router)# default-information originate
```

**类型 5 默认路由**：
```
Router(config-router)# default-information originate always
```

**5. OSPF 路由汇总**

**区域间路由汇总**：
```
Router(config-router)# area [区域号] range [汇总地址] [子网掩码]
```

**外部路由汇总**：
```
Router(config-router)# summary-address [汇总地址] [子网掩码]
```

#### EIGRP 高级配置

**1. EIGRP 命名模式**

**配置**：
```
Router(config)# router eigrp [自治系统号]
Router(config-router)# address-family ipv4 unicast autonomous-system [AS号]
Router(config-router-af)# topology [拓扑名称]
Router(config-router-af-topology)# redistribute [协议]
```

**2. EIGRP 路由汇总**

**自动汇总**：
```
Router(config-router)# auto-summary
```

**手动汇总**：
```
Router(config-if)# ip summary-address eigrp [AS号] [汇总地址] [子网掩码]
```

**3. EIGRP 负载均衡**

**等价负载均衡**：
```
Router(config-router)# maximum-paths [路径数]
```

**非等价负载均衡**：
```
Router(config-router)# variance [倍数]
```

**4. EIGRP Stub 路由**

**配置**：
```
Router(config-router)# eigrp stub [receive-only|connected|static|summary|redistributed]
```

**5. EIGRP 认证**

**配置**：
```
Router(config)# key chain [名称]
Router(config-keychain)# key [密钥ID]
Router(config-keychain-key)# key-string [密钥字符串]
Router(config)# interface [接口]
Router(config-if)# authentication mode eigrp [AS号] md5
Router(config-if)# authentication key-chain eigrp [AS号] [名称]
```

#### BGP 高级配置

**1. BGP 路由反射器**

**用途**：减少 iBGP 全互联需求

**配置**：
```
Router(config-router)# neighbor [邻居地址] route-reflector-client
```

**2. BGP 联盟**

**用途**：将大型 AS 分为多个子 AS

**配置**：
```
Router(config-router)# bgp confederation identifier [主AS号]
Router(config-router)# bgp confederation peers [子AS号列表]
```

**3. BGP 属性操作**

**Local_Pref**：
```
Router(config-router)# bgp default local-preference [值]
```

**MED**：
```
Router(config-router)# default-metric [值]
```

**AS_Path 预置**：
```
Router(config-router)# neighbor [邻居地址] route-map [名称] out
```

**4. BGP 路由过滤**

**前缀列表**：
```
Router(config)# ip prefix-list [名称] permit [地址/长度] ge [最小长度] le [最大长度]
Router(config-router)# neighbor [邻居地址] prefix-list [名称] in
```

**路由映射**：
```
Router(config)# route-map [名称] permit [序号]
Router(config-route-map)# match ip address [ACL]
Router(config-route-map)# set local-preference [值]
Router(config-router)# neighbor [邻居地址] route-map [名称] in
```

**5. BGP 聚合**

**配置**：
```
Router(config-router)# aggregate-address [汇总地址] [子网掩码] [summary-only]
```

### 19.3 高级交换技术

#### MSTP (Multiple Spanning Tree Protocol)

**配置**：
```
Switch(config)# spanning-tree mode mst
Switch(config)# spanning-tree mst configuration
Switch(config-mst)# name [名称]
Switch(config-mst)# revision [版本号]
Switch(config-mst)# instance [实例号] vlan [VLAN列表]
Switch(config-mst)# exit
Switch(config)# spanning-tree mst [实例号] priority [优先级]
```

#### VTP (VLAN Trunking Protocol)

**VTP 模式**：
- **Server**：可以创建、删除、修改 VLAN
- **Client**：只能接收 VTP 信息
- **Transparent**：不参与 VTP，但转发 VTP 信息
- **Off**：不参与 VTP，不转发 VTP 信息

**配置**：
```
Switch(config)# vtp domain [域名]
Switch(config)# vtp mode [server|client|transparent|off]
Switch(config)# vtp password [密码]
Switch(config)# vtp version 2
Switch(config)# vtp pruning
```

#### 私有 VLAN (Private VLAN)

**PVLAN 类型**：
- **Primary VLAN**：主 VLAN
- **Isolated VLAN**：隔离 VLAN，只能与主 VLAN 通信
- **Community VLAN**：社区 VLAN，社区内可以互相通信

**配置**：
```
Switch(config)# vlan [主VLAN]
Switch(config-vlan)# private-vlan primary
Switch(config-vlan)# exit
Switch(config)# vlan [隔离VLAN]
Switch(config-vlan)# private-vlan isolated
Switch(config-vlan)# exit
Switch(config)# vlan [社区VLAN]
Switch(config-vlan)# private-vlan community
Switch(config-vlan)# exit

Switch(config)# vlan [主VLAN]
Switch(config-vlan)# private-vlan association [隔离VLAN] [社区VLAN]
Switch(config-vlan)# exit

Switch(config)# interface [接口]
Switch(config-if)# switchport mode private-vlan host
Switch(config-if)# switchport private-vlan host-association [主VLAN] [辅助VLAN]
```

#### DHCP Snooping 高级配置

**配置**：
```
Switch(config)# ip dhcp snooping
Switch(config)# ip dhcp snooping vlan [VLAN列表]
Switch(config)# ip dhcp snooping information option
Switch(config)# ip dhcp snooping verify mac-address
Switch(config)# ip dhcp snooping limit rate [速率]
```

**IP Source Guard**：
```
Switch(config)# ip source binding [MAC] [IP] [VLAN] [接口]
Switch(config-if)# ip verify source
```

**动态 ARP 检测**：
```
Switch(config)# ip arp inspection vlan [VLAN列表]
Switch(config)# ip arp inspection validate src-mac dst-mac ip allow zeros
```

### 19.4 MPLS (Multi-Protocol Label Switching)

#### MPLS 基础

**MPLS 术语**：
- **LER (Label Edge Router)**：标签边缘路由器
- **LSR (Label Switching Router)**：标签交换路由器
- **LSP (Label Switched Path)**：标签交换路径
- **FEC (Forwarding Equivalence Class)**：转发等价类

#### MPLS 配置

**1. 启用 MPLS**
```
Router(config)# ip cef
Router(config)# mpls ip
```

**2. 配置 LDP**
```
Router(config)# mpls label protocol ldp
Router(config)# interface [接口]
Router(config-if)# mpls ip
```

**3. 配置 MPLS VPN**

**VRF 配置**：
```
Router(config)# ip vrf [VRF名称]
Router(config-vrf)# rd [RD值]
Router(config-vrf)# route-target [RT值] [export|import|both]
```

**PE 路由器配置**：
```
Router(config)# interface [接口]
Router(config-if)# ip vrf forwarding [VRF名称]
Router(config-if)# ip address [IP] [掩码]
Router(config-if)# mpls ip
```

**MP-BGP 配置**：
```
Router(config)# router bgp [AS号]
Router(config-router)# address-family vpnv4
Router(config-router-af)# neighbor [邻居地址] activate
Router(config-router-af)# neighbor [邻居地址] send-community both
```

### 19.5 QoS (Quality of Service) 深入

#### QoS 模型

**1. Best Effort**
- 尽力而为
- 无 QoS 保证

**2. IntServ (Integrated Services)**
- 集成服务
- 使用 RSVP
- 预留资源

**3. DiffServ (Differentiated Services)**
- 区分服务
- 基于 DSCP
- 可扩展

#### QoS 配置

**1. 分类和标记**

**Class Map**：
```
Router(config)# class-map [名称]
Router(config-cmap)# match [条件]
```

**Policy Map**：
```
Router(config)# policy-map [名称]
Router(config-pmap)# class [类名]
Router(config-pmap-c)# set [动作]
```

**示例**：
```
Router(config)# class-map VOICE
Router(config-cmap)# match ip dscp ef
Router(config-cmap)# exit
Router(config)# policy-map QOS-POLICY
Router(config-pmap)# class VOICE
Router(config-pmap-c)# priority percent 30
Router(config-pmap-c)# exit
Router(config-pmap)# class DATA
Router(config-pmap-c)# bandwidth remaining percent 70
```

**2. 拥塞管理**

**PQ (Priority Queuing)**：
```
Router(config)# priority-list [列表号] protocol [协议] [队列] [参数]
Router(config)# priority-list [列表号] default [队列]
Router(config-if)# priority-group [列表号]
```

**CBWFQ (Class-Based Weighted Fair Queuing)**：
```
Router(config-pmap-c)# bandwidth [带宽]
Router(config-pmap-c)# bandwidth percent [百分比]
Router(config-pmap-c)# bandwidth remaining percent [百分比]
```

**LLQ (Low Latency Queuing)**：
```
Router(config-pmap-c)# priority [带宽]
Router(config-pmap-c)# priority percent [百分比]
```

**3. 拥塞避免**

**WRED (Weighted Random Early Detection)**：
```
Router(config-pmap-c)# random-detect
Router(config-pmap-c)# random-detect exponential-weighting-constant [指数]
```

**4. 流量监管和整形**

**Policing（监管）**：
```
Router(config-pmap-c)# police [CIR] [BC] [BE] conform-action [动作] exceed-action [动作] violate-action [动作]
```

**Shaping（整形）**：
```
Router(config-pmap-c)# shape average [CIR] [BC] [BE]
```

### 19.6 高级安全

#### Zone-Based Firewall

**配置步骤**：

**1. 定义安全区域**：
```
Router(config)# zone security [区域名称]
```

**2. 分配接口到区域**：
```
Router(config)# interface [接口]
Router(config-if)# zone-member security [区域名称]
```

**3. 定义类映射**：
```
Router(config)# class-map type inspect [类名]
Router(config-cmap)# match protocol [协议]
```

**4. 定义策略映射**：
```
Router(config)# policy-map type inspect [策略名]
Router(config-pmap)# class type inspect [类名]
Router(config-pmap-c)# inspect [协议]
```

**5. 定义区域对**：
```
Router(config)# zone-pair security [区域对名] source [源区域] destination [目的区域]
Router(config-sec-zone-pair)# service-policy type inspect [策略名]
```

#### IPSec VPN

**1. IKE Phase 1 配置**：
```
Router(config)# crypto isakmp policy [策略号]
Router(config-isakmp)# encryption [加密算法]
Router(config-isakmp)# hash [哈希算法]
Router(config-isakmp)# authentication [认证方式]
Router(config-isakmp)# group [DH组]
Router(config)# crypto isakmp key [密钥] address [对端地址]
```

**2. IKE Phase 2 配置**：
```
Router(config)# access-list [ACL号] permit ip [源网络] [源掩码] [目的网络] [目的掩码]
Router(config)# crypto ipsec transform-set [名称] [变换集]
Router(config)# crypto map [名称] [序号] ipsec-isakmp
Router(config-crypto-map)# set peer [对端地址]
Router(config-crypto-map)# set transform-set [变换集]
Router(config-crypto-map)# match address [ACL号]
```

**3. 应用加密映射**：
```
Router(config)# interface [接口]
Router(config-if)# crypto map [名称]
```

#### DMVPN (Dynamic Multipoint VPN)

**配置**：

**Hub 路由器**：
```
Router(config)# interface tunnel [隧道号]
Router(config-if)# ip address [IP] [掩码]
Router(config-if)# ip nhrp network-id [网络ID]
Router(config-if)# ip nhrp map multicast dynamic
Router(config-if)# ip nhrp redirect
Router(config-if)# tunnel source [源接口]
Router(config-if)# tunnel mode gre multipoint
Router(config-if)# tunnel key [密钥]
Router(config-if)# tunnel protection ipsec profile [配置文件]
```

**Spoke 路由器**：
```
Router(config)# interface tunnel [隧道号]
Router(config-if)# ip address [IP] [掩码]
Router(config-if)# ip nhrp network-id [网络ID]
Router(config-if)# ip nhrp nhs [Hub地址]
Router(config-if)# ip nhrp map multicast [Hub地址]
Router(config-if)# ip nhrp registration no-unique
Router(config-if)# tunnel source [源接口]
Router(config-if)# tunnel mode gre multipoint
Router(config-if)# tunnel key [密钥]
Router(config-if)# tunnel protection ipsec profile [配置文件]
```

### 19.7 高级故障排除

#### 故障排除方法论

**1. 定义问题**
- 明确问题现象
- 确定影响范围
- 收集相关信息

**2. 分析问题**
- 检查配置
- 查看日志
- 分析协议

**3. 制定计划**
- 确定可能原因
- 制定测试方案
- 准备回滚计划

**4. 实施计划**
- 逐步实施
- 验证结果
- 记录过程

**5. 验证结果**
- 确认问题解决
- 验证无副作用
- 文档化

#### 高级调试命令

**1. 路由协议调试**
```
debug ip routing
debug ip ospf events
debug ip eigrp packets
debug ip bgp
```

**2. 交换协议调试**
```
debug spanning-tree events
debug vlan packet
debug vtp packets
```

**3. 安全调试**
```
debug crypto ipsec
debug crypto isakmp
debug ip packet [ACL]
```

**4. 性能调试**
```
debug platform packet
debug ip cef
debug mpls packets
```

#### 性能优化

**1. CPU 优化**
- 优化路由表
- 减少路由更新
- 使用硬件转发
- 禁用不必要的服务

**2. 内存优化**
- 优化缓冲区
- 清理未使用的表
- 优化 ACL
- 使用压缩

**3. 带宽优化**
- 使用 QoS
- 压缩流量
- 优化路由
- 使用缓存

### 19.8 本章实验

#### 实验 19-1：OSPF 虚链路配置

**实验目的**：掌握 OSPF 虚链路的配置

**实验步骤**：

1. **网络拓扑**
   ```
   Area 0 (Backbone)
      |
   Router1 (1.1.1.1) --- Router2 (2.2.2.2) --- Area 1 --- Router3 (3.3.3.3) --- Area 2
   ```

2. **配置 OSPF 虚链路**
   ```
   Router1(config)# router ospf 1
   Router1(config-router)# router-id 1.1.1.1
   Router1(config-router)# area 1 virtual-link 3.3.3.3

   Router3(config)# router ospf 1
   Router3(config-router)# router-id 3.3.3.3
   Router3(config-router)# area 1 virtual-link 1.1.1.1
   ```

3. **验证虚链路**
   ```
   Router1# show ip ospf virtual-links
   Router1# show ip route ospf
   ```

#### 实验 19-2：BGP 路由反射器配置

**实验目的**：掌握 BGP 路由反射器的配置

**实验步骤**：

1. **配置路由反射器**
   ```
   RR(config)# router bgp 65001
   RR(config-router)# neighbor 10.0.0.2 remote-as 65001
   RR(config-router)# neighbor 10.0.0.2 route-reflector-client
   RR(config-router)# neighbor 10.0.0.3 remote-as 65001
   RR(config-router)# neighbor 10.0.0.3 route-reflector-client
   ```

2. **验证路由反射**
   ```
   RR# show ip bgp
   RR# show ip bgp neighbors
   ```

#### 实验 19-3：MPLS VPN 配置

**实验目的**：掌握 MPLS VPN 的配置

**实验步骤**：

1. **配置 VRF**
   ```
   PE1(config)# ip vrf CUSTOMER_A
   PE1(config-vrf)# rd 65001:100
   PE1(config-vrf)# route-target import 65001:100
   PE1(config-vrf)# route-target export 65001:100
   ```

2. **配置 MPLS**
   ```
   PE1(config)# mpls label protocol ldp
   PE1(config)# interface gigabitethernet0/0
   PE1(config-if)# mpls ip
   ```

3. **验证 MPLS VPN**
   ```
   PE1# show mpls forwarding-table
   PE1# show ip route vrf CUSTOMER_A
   ```

### 19.9 本章小结

本章介绍了 CCIE 级别的路由与交换技术：

**核心知识点**：
- OSPF 高级配置（虚链路、认证、汇总）
- EIGRP 高级配置（命名模式、负载均衡、认证）
- BGP 高级配置（路由反射器、联盟、属性操作）
- 高级交换技术（MSTP、VTP、私有 VLAN）
- MPLS 配置
- QoS 深入
- 高级安全（Zone-Based Firewall、IPSec VPN、DMVPN）
- 高级故障排除

**重点记忆**：
- OSPF 虚链路连接非骨干区域到骨干区域
- BGP 路由反射器减少 iBGP 全互联需求
- MPLS 使用标签交换提高转发效率
- QoS 保证关键业务的性能
- Zone-Based Firewall 提供基于区域的安全策略

### 19.10 练习题

#### 选择题

1. OSPF 虚链路用于连接什么？
   - A. 非骨干区域到骨干区域
   - B. 骨干区域到骨干区域
   - C. 非骨干区域到非骨干区域
   - D. 所有区域

2. BGP 路由反射器的作用是？
   - A. 提高 BGP 收敛速度
   - B. 减少 iBGP 全互联需求
   - C. 增加 BGP 路由数量
   - D. 优化 BGP 路径选择

3. MPLS 使用的标签交换协议是？
   - A. BGP
   - B. LDP
   - C. OSPF
   - D. EIGRP

4. QoS 的 LLQ 用于什么？
   - A. 数据流量
   - B. 语音流量
   - C. 视频流量
   - D. 所有流量

5. Zone-Based Firewall 的基本单位是？
   - A. 接口
   - B. 区域
   - C. VLAN
   - D. 子网

#### 填空题

1. OSPF 虚链路配置命令是 ________。

2. BGP 路由反射器配置命令是 ________。

3. MPLS 的全称是 ________。

4. QoS 的 DiffServ 模型使用 ________ 标记流量。

5. IPSec VPN 的 IKE Phase 1 用于 ________。

#### 简答题

1. 什么是 OSPF 虚链路？虚链路有什么作用？

2. 什么是 BGP 路由反射器？路由反射器有什么作用？

3. 简述 MPLS 的工作原理。

4. QoS 有哪些模型？各有什么特点？

5. 什么是 Zone-Based Firewall？它与传统防火墙有什么区别？

#### 实验题

1. 配置 OSPF 虚链路，连接非骨干区域到骨干区域。

2. 配置 BGP 路由反射器，减少 iBGP 全互联需求。

3. 配置 MPLS VPN，实现不同客户的网络隔离。

### 19.11 参考答案

#### 选择题

1. A
2. B
3. B
4. B
5. B

#### 填空题

1. area [区域号] virtual-link [对端路由器ID]
2. neighbor [邻居地址] route-reflector-client
3. Multi-Protocol Label Switching
4. DSCP
5. 建立安全关联

#### 简答题

1. OSPF 虚链路用于连接非骨干区域到骨干区域，使非骨干区域可以通过其他区域访问骨干区域。

2. BGP 路由反射器是一种 iBGP 路由反射机制，可以减少 iBGP 全互联需求，简化网络配置。

3. MPLS 在数据包头部添加标签，路由器根据标签转发数据，提高转发效率，支持 VPN 和流量工程。

4. Best Effort：尽力而为；IntServ：集成服务，使用 RSVP；DiffServ：区分服务，基于 DSCP。

5. Zone-Based Firewall 是基于区域的安全策略，将接口分配到安全区域，区域之间应用安全策略。

---

## 第20章：CCIE 服务提供商技术

### 20.1 服务提供商网络架构

#### ISP 网络层次

**1. 接入层**
- DSLAM
- CMTS
- OLT
- 无线接入点

**2. 汇聚层**
- 汇聚路由器
- BSR
- LSR

**3. 核心层**
- 核心路由器
- CRS
- P 路由器

### 20.2 BGP 在服务提供商中的应用

#### BGP 最佳实践

**1. 路由过滤**
```
ip prefix-list ISP-IN permit 0.0.0.0/0 ge 8 le 24
router bgp [AS号]
 neighbor [邻居地址] prefix-list ISP-IN in
```

**2. 路由聚合**
```
router bgp [AS号]
 aggregate-address [汇总地址] [子网掩码] summary-only
```

**3. AS_Path 过滤**
```
ip as-path access-list 1 deny ^[AS号]_[AS号]$
ip as-path access-list 1 permit .*
router bgp [AS号]
 neighbor [邻居地址] filter-list 1 in
```

**4. MED 设置**
```
router bgp [AS号]
 neighbor [邻居地址] route-map SET-MED out
route-map SET-MED permit 10
 set metric [MED值]
```

### 20.3 MPLS 流量工程

#### MPLS TE 配置

**1. 启用 MPLS TE**
```
Router(config)# mpls traffic-eng tunnels
Router(config)# interface [接口]
Router(config-if)# mpls traffic-eng tunnels
```

**2. 配置隧道**
```
Router(config)# interface tunnel [隧道号]
Router(config-if)# tunnel mode mpls traffic-eng
Router(config-if)# tunnel destination [目的地址]
Router(config-if)# tunnel mpls traffic-eng autoroute announce
Router(config-if)# tunnel mpls traffic-eng priority [建立优先级] [保持优先级]
Router(config-if)# tunnel mpls traffic-eng bandwidth [带宽]
Router(config-if)# tunnel mpls traffic-eng path-option [选项号] explicit [路径名称]
```

**3. 配置显式路径**
```
Router(config)# ip explicit-path name [路径名称]
Router(config-ip-expl-path)# next-address [下一跳地址]
Router(config-ip-expl-path)# next-address [下一跳地址]
```

### 20.4 组播路由

#### PIM (Protocol Independent Multicast)

**PIM 模式**：
- **PIM Dense Mode (PIM-DM)**：密集模式
- **PIM Sparse Mode (PIM-SM)**：稀疏模式
- **PIM Sparse-Dense Mode (PIM-SDM)**：稀疏-密集模式

**配置**：
```
Router(config)# ip multicast-routing
Router(config)# interface [接口]
Router(config-if)# ip pim [sparse|dense|sparse-dense]-mode
```

**RP (Rendezvous Point) 配置**：
```
Router(config)# ip pim rp-address [RP地址]
```

**静态 RP 配置**：
```
Router(config)# ip pim rp-candidate [接口] [组地址] [优先级]
```

**Auto-RP 配置**：
```
Router(config)# ip pim send-rp-announce [接口] scope [TTL值] group-list [ACL]
Router(config)# ip pim send-rp-discovery scope [TTL值]
```

### 20.5 IPv6 在服务提供商中的应用

#### IPv6 路由协议

**OSPFv3 配置**：
```
Router(config)# ipv6 unicast-routing
Router(config)# ipv6 router ospf [进程ID]
Router(config-rtr)# router-id [路由器ID]
Router(config-rtr)# exit
Router(config)# interface [接口]
Router(config-if)# ipv6 ospf [进程ID] area [区域号]
```

**MP-BGP 配置**：
```
Router(config)# router bgp [AS号]
Router(config-router)# address-family ipv6 unicast
Router(config-router-af)# neighbor [邻居地址] activate
```

### 20.6 本章小结

本章介绍了 CCIE 服务提供商技术：

**核心知识点**：
- 服务提供商网络架构
- BGP 在服务提供商中的应用
- MPLS 流量工程
- 组播路由
- IPv6 在服务提供商中的应用

**重点记忆**：
- ISP 网络分为接入层、汇聚层、核心层
- BGP 用于 ISP 之间的路由
- MPLS TE 优化流量路径
- PIM 用于组播路由
- IPv6 是服务提供商的发展方向

### 20.7 练习题

#### 选择题

1. PIM-SM 使用什么机制建立组播树？
   - A. 洪泛
   - B. RP
   - C. 源树
   - D. 共享树

2. MPLS TE 的主要作用是？
   - A. 提高 MPLS 转发速度
   - B. 优化流量路径
   - C. 增加网络安全性
   - D. 简化网络配置

3. OSPFv3 与 OSPFv2 的主要区别是？
   - A. 支持的地址族
   - B. 路由算法
   - C. 区域类型
   - D. 度量值

#### 填空题

1. ISP 网络分为 ________、________、________ 三层。

2. PIM 的三种模式是 ________、________、________。

3. MPLS TE 的配置命令是 ________。

#### 简答题

1. 简述 ISP 网络的架构。

2. 什么是 MPLS TE？MPLS TE 有什么作用？

3. PIM-SM 和 PIM-DM 有什么区别？

### 20.8 参考答案

#### 选择题

1. B
2. B
3. A

#### 填空题

1. 接入层，汇聚层，核心层
2. PIM-DM，PIM-SM，PIM-SDM
3. mpls traffic-eng tunnels

#### 简答题

1. ISP 网络分为接入层（用户接入）、汇聚层（流量汇聚）、核心层（高速转发）。

2. MPLS TE 是 MPLS 流量工程，用于优化流量路径，提高网络利用率，保证服务质量。

3. PIM-DM 使用洪泛机制，适用于密集组播环境；PIM-SM 使用 RP 机制，适用于稀疏组播环境。

---

## 第21章：CCIE 数据中心技术

### 21.1 数据中心架构

#### 三层架构

**1. 核心层**
- 高速交换
- 冗余设计
- 最少路由

**2. 汇聚层**
- 策略实施
- 服务集成
- 聚合流量

**3. 接入层**
- 服务器连接
- 端口密度
- 边缘服务

#### Spine-Leaf 架构

**特点**：
- 扁平化设计
- 低延迟
- 高带宽
- 易于扩展

**配置**：
```
Leaf(config)# interface port-channel1
Leaf(config-if)# switchport mode trunk
Leaf(config-if)# spanning-tree portfast trunk
```

### 21.2 Nexus 交换机

#### NX-OS 基础

**模式切换**：
```
switch# configure terminal
switch(config)# feature [功能名称]
```

**VLAN 配置**：
```
switch(config)# vlan [VLAN ID]
switch(config-vlan)# name [名称]
switch(config-vlan)# exit
switch(config)# interface ethernet [插槽/端口]
switch(config-if)# switchport mode access
switch(config-if)# switchport access vlan [VLAN ID]
```

**VPC (Virtual Port Channel)**：
```
switch(config)# feature vpc
switch(config)# vpc domain [域ID]
switch(config-vpc-domain)# peer-keepalive destination [IP地址]
switch(config-vpc-domain)# peer-gateway
switch(config)# interface port-channel [ID]
switch(config-if)# vpc [ID]
```

### 21.3 VXLAN

#### VXLAN 概述

**VXLAN** 是用于虚拟化环境的网络虚拟化技术，使用 MAC-in-UDP 封装。

**配置**：
```
switch(config)# feature nv overlay
switch(config)# nve [NVE接口号]
switch(config-nve)# member vni [VNI]
switch(config-nve-vni)# ingress-replication protocol bgp
switch(config)# interface ethernet [插槽/端口]
switch(config-if)# switchport mode access
switch(config-if)# switchport access vlan [VLAN ID]
switch(config)# vlan [VLAN ID]
switch(config-vlan)# vn-segment [VNI]
```

### 21.4 ACI (Application Centric Infrastructure)

#### ACI 架构

**组件**：
- **APIC (Application Policy Infrastructure Controller)**：应用策略基础设施控制器
- **Spine 交换机**：骨干交换机
- **Leaf 交换机**：接入交换机

**配置**：
```
apic# configure terminal
apic(config)# tenant [租户名称]
apic(config-tenant)# vrf [VRF名称]
apic(config-tenant)# bridge-domain [网桥域名称]
apic(config-tenant)# application [应用名称]
apic(config-tenant-app)# epg [EPG名称]
```

### 21.5 本章小结

本章介绍了 CCIE 数据中心技术：

**核心知识点**：
- 数据中心架构（三层架构、Spine-Leaf）
- Nexus 交换机和 NX-OS
- VXLAN 网络虚拟化
- ACI 应用中心基础设施

**重点记忆**：
- 数据中心三层架构：核心层、汇聚层、接入层
- Spine-Leaf 架构扁平化、低延迟
- NX-OS 是 Cisco 数据中心交换机的操作系统
- VXLAN 使用 MAC-in-UDP 封装
- ACI 是基于策略的数据中心架构

### 21.6 练习题

#### 选择题

1. Spine-Leaf 架构的主要特点是？
   - A. 分层设计
   - B. 扁平化设计
   - C. 集中管理
   - D. 分布式路由

2. VXLAN 使用的封装协议是？
   - A. GRE
   - B. IPsec
   - C. UDP
   - D. TCP

3. NX-OS 的 VPC 功能类似于什么？
   - A. EtherChannel
   - B. VTP
   - C. STP
   - D. HSRP

#### 填空题

1. 数据中心三层架构包括 ________、________、________。

2. VXLAN 的全称是 ________。

3. ACI 的控制器是 ________。

#### 简答题

1. 比较传统三层架构和 Spine-Leaf 架构。

2. 什么是 VXLAN？VXLAN 有什么作用？

3. 什么是 ACI？ACI 有什么特点？

### 21.7 参考答案

#### 选择题

1. B
2. C
3. A

#### 填空题

1. 核心层，汇聚层，接入层
2. Virtual Extensible LAN
3. APIC

#### 简答题

1. 传统三层架构分层明显，收敛慢；Spine-Leaf 架构扁平化，延迟低，带宽高，易于扩展。

2. VXLAN 是用于虚拟化环境的网络虚拟化技术，使用 MAC-in-UDP 封装，实现跨物理网络的二层连接。

3. ACI 是应用中心基础设施，基于策略的网络架构，提供自动化、可视化和安全性。

---

*（第七部分：CCIE 进阶篇 完）*

# 第八部分：前沿技术篇

## 第22章：网络自动化实践

### 22.1 Python 网络自动化

#### Python 基础

**安装 Python 库**：
```bash
pip install netmiko
pip install paramiko
pip install napalm
pip install pyats
```

#### 使用 Netmiko 连接设备

**基本连接**：
```python
from netmiko import ConnectHandler

device = {
    'device_type': 'cisco_ios',
    'host': '192.168.1.1',
    'username': 'admin',
    'password': 'password',
    'port': 22,
}

with ConnectHandler(**device) as net_connect:
    output = net_connect.send_command('show version')
    print(output)
```

**批量配置**：
```python
from netmiko import ConnectHandler

devices = [
    {'device_type': 'cisco_ios', 'host': '192.168.1.1', 'username': 'admin', 'password': 'password'},
    {'device_type': 'cisco_ios', 'host': '192.168.1.2', 'username': 'admin', 'password': 'password'},
]

commands = [
    'interface gigabitethernet0/0',
    'description Configured by Python',
    'no shutdown',
]

for device in devices:
    with ConnectHandler(**device) as net_connect:
        net_connect.send_config_set(commands)
        print(f"配置完成: {device['host']}")
```

### 22.2 Ansible 网络自动化

#### Ansible 基础

**安装 Ansible**：
```bash
pip install ansible
pip install ansible-pylibssh
```

**Inventory 文件**：
```ini
[routers]
router1 ansible_host=192.168.1.1
router2 ansible_host=192.168.1.2

[routers:vars]
ansible_user=admin
ansible_password=password
ansible_connection=network_cli
ansible_network_os=cisco.ios
```

**Playbook 示例**：
```yaml
---
- name: 配置路由器
  hosts: routers
  gather_facts: no
  
  tasks:
    - name: 配置接口
      ios_config:
        lines:
          - description Configured by Ansible
          - no shutdown
        parents: interface gigabitethernet0/0
        
    - name: 保存配置
      ios_command:
        commands:
          - write memory
```

**运行 Playbook**：
```bash
ansible-playbook -i inventory.yml playbook.yml
```

### 22.3 REST API 自动化

#### 使用 REST API 配置设备

**Python 示例**：
```python
import requests
import json

url = 'https://192.168.1.1/api/mo/sys.json'
headers = {
    'Content-Type': 'application/json',
}
auth = ('admin', 'password')

payload = {
    "topSystem": {
        "children": [{
            "interfaceEntity": {
                "children": [{
                    "l1PhysIf": {
                        "attributes": {
                            "id": "eth1/1",
                            "adminSt": "up",
                            "descr": "Configured by REST API"
                        }
                    }
                }]
            }
        }]
    }
}

response = requests.post(url, headers=headers, auth=auth, json=payload, verify=False)
print(response.status_code)
print(response.text)
```

### 22.4 本章实验

#### 实验 22-1：Python 自动化配置

**实验目的**：使用 Python 自动配置多台路由器

**实验步骤**：

1. **创建 Python 脚本**
```python
from netmiko import ConnectHandler

devices = [
    {'device_type': 'cisco_ios', 'host': '192.168.1.1', 'username': 'admin', 'password': 'password'},
    {'device_type': 'cisco_ios', 'host': '192.168.1.2', 'username': 'admin', 'password': 'password'},
]

for device in devices:
    with ConnectHandler(**device) as net_connect:
        # 配置 SSH
        net_connect.send_config_set([
            'ip domain-name example.com',
            'crypto key generate rsa modulus 2048',
            'ip ssh version 2',
            'line vty 0 4',
            'transport input ssh',
            'login local',
        ])
        print(f"SSH 配置完成: {device['host']}")
```

2. **运行脚本**
```bash
python configure_ssh.py
```

### 22.5 本章小结

本章介绍了网络自动化实践：

**核心知识点**：
- Python 网络自动化（Netmiko、Paramiko）
- Ansible 网络自动化
- REST API 自动化

**重点记忆**：
- Netmiko 简化了设备连接和配置
- Ansible 使用无代理架构
- REST API 提供标准化接口

### 22.6 练习题

#### 简答题

1. 如何使用 Python 连接到 Cisco 设备？

2. Ansible 的 Inventory 文件有什么作用？

3. 如何使用 REST API 配置网络设备？

---

## 第23章：云网络集成

### 23.1 AWS VPC

#### VPC 基础

**VPC 组件**：
- **子网**：公有子网和私有子网
- **路由表**：控制子网之间的路由
- **Internet Gateway**：连接 VPC 到互联网
- **NAT Gateway**：允许私有子网访问互联网
- **VPN Gateway**：连接 VPC 到本地网络

#### AWS VPC 配置

**使用 AWS CLI**：
```bash
# 创建 VPC
aws ec2 create-vpc --cidr-block 10.0.0.0/16

# 创建子网
aws ec2 create-subnet --vpc-id vpc-xxxxxxxx --cidr-block 10.0.1.0/24

# 创建 Internet Gateway
aws ec2 create-internet-gateway

# 附加 Internet Gateway 到 VPC
aws ec2 attach-internet-gateway --vpc-id vpc-xxxxxxxx --internet-gateway-id igw-xxxxxxxx

# 创建路由表
aws ec2 create-route-table --vpc-id vpc-xxxxxxxx

# 添加路由
aws ec2 create-route --route-table-id rtb-xxxxxxxx --destination-cidr-block 0.0.0.0/0 --gateway-id igw-xxxxxxxx
```

### 23.2 Azure VNet

#### VNet 基础

**VNet 组件**：
- **子网**：划分网络
- **虚拟网络网关**：VPN 连接
- **负载均衡器**：流量分发
- **网络安全组**：访问控制

#### Azure VNet 配置

**使用 Azure CLI**：
```bash
# 创建资源组
az group create --name myResourceGroup --location eastus

# 创建 VNet
az network vnet create \
  --name myVNet \
  --resource-group myResourceGroup \
  --location eastus \
  --address-prefixes 10.0.0.0/16

# 创建子网
az network vnet subnet create \
  --name mySubnet \
  --vnet-name myVNet \
  --resource-group myResourceGroup \
  --address-prefixes 10.0.1.0/24
```

### 23.3 阿里云 VPC

#### VPC 基础

**VPC 组件**：
- **交换机**：子网
- **路由器**：控制路由
- **EIP**：弹性公网 IP
- **NAT 网关**：访问互联网

#### 阿里云 VPC 配置

**使用阿里云 CLI**：
```bash
# 创建 VPC
aliyun vpc CreateVPC \
  --RegionId cn-hangzhou \
  --CidrBlock 192.168.0.0/16 \
  --VpcName MyVPC

# 创建交换机
aliyun vpc CreateVSwitch \
  --RegionId cn-hangzhou \
  --VpcId vpc-xxxxxxxx \
  --CidrBlock 192.168.1.0/24 \
  --ZoneId cn-hangzhou-i
```

### 23.4 混合云网络

#### VPN 连接

**AWS Site-to-Site VPN**：
```bash
# 创建 VPN Gateway
aws ec2 create-vpn-gateway --type ipsec.1 --vpc-id vpc-xxxxxxxx

# 创建客户网关
aws ec2 create-customer-gateway --type ipsec.1 --public-ip 203.0.113.1 --bgp-asn 65000

# 创建 VPN 连接
aws ec2 create-vpn-connection \
  --type ipsec.1 \
  --vpn-gateway-id vgw-xxxxxxxx \
  --customer-gateway-id cgw-xxxxxxxx
```

### 23.5 本章小结

本章介绍了云网络集成：

**核心知识点**：
- AWS VPC 配置
- Azure VNet 配置
- 阿里云 VPC 配置
- 混合云网络

**重点记忆**：
- 云网络提供灵活的网络配置
- VPN 连接实现混合云
- 各云平台有各自的 CLI 工具

### 23.6 练习题

#### 简答题

1. AWS VPC 的主要组件有哪些？

2. 如何创建 AWS VPC 和子网？

3. 什么是混合云网络？如何实现？

---

## 第24章：容器网络

### 24.1 Docker 网络

#### Docker 网络模式

**1. Bridge 模式**
- 默认模式
- 容器之间可以通信
- 与主机隔离

**2. Host 模式**
- 容器使用主机网络栈
- 性能最好

**3. None 模式**
- 容器没有网络
- 需要手动配置

**4. Overlay 模式**
- 跨主机通信
- 使用 VXLAN 封装

#### Docker 网络配置

**创建网络**：
```bash
docker network create --driver bridge my-network
```

**运行容器并连接到网络**：
```bash
docker run -d --name container1 --network my-network nginx
docker run -d --name container2 --network my-network nginx
```

**查看网络**：
```bash
docker network ls
docker network inspect my-network
```

### 24.2 Kubernetes 网络

#### Kubernetes 网络模型

**1. Pod 网络**
- 每个 Pod 有唯一的 IP
- Pod 之间可以直接通信

**2. Service 网络**
- 提供稳定的访问入口
- 负载均衡

**3. Ingress**
- 外部访问入口
- 基于 Host 和 Path 的路由

#### Kubernetes 网络配置

**创建 Pod**：
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
spec:
  containers:
  - name: nginx
    image: nginx
    ports:
    - containerPort: 80
```

**创建 Service**：
```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80
  type: LoadBalancer
```

**创建 Ingress**：
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nginx-ingress
spec:
  rules:
  - host: example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: nginx-service
            port:
              number: 80
```

### 24.3 CNI (Container Network Interface)

#### CNI 插件

**常见 CNI 插件**：
- **Flannel**：简单的 Overlay 网络
- **Calico**：支持网络策略
- **Weave Net**：简单易用
- **Cilium**：基于 eBPF

#### Calico 配置

**安装 Calico**：
```bash
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
```

**配置网络策略**：
```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-from-frontend
spec:
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend
    ports:
    - protocol: TCP
      port: 80
```

### 24.4 本章小结

本章介绍了容器网络：

**核心知识点**：
- Docker 网络模式
- Kubernetes 网络模型
- CNI 插件
- 网络策略

**重点记忆**：
- Docker 支持多种网络模式
- Kubernetes 提供稳定的网络抽象
- CNI 插件实现容器网络
- 网络策略控制流量

### 24.5 练习题

#### 简答题

1. Docker 有哪些网络模式？

2. Kubernetes 的网络模型是什么？

3. 什么是 CNI？常见的 CNI 插件有哪些？

---

## 第25章：SD-WAN 深入

### 25.1 SD-WAN 架构

#### SD-WAN 组件

**1. vManage**
- 管理平面
- 集中管理

**2. vSmart**
- 控制平面
- 路径选择

**3. vBond**
- 验证和连接
- 安全认证

**4. vEdge**
- 数据平面
- 流量转发

### 25.2 Cisco SD-WAN 配置

#### vManage 配置

**添加设备**：
```
Configuration → Devices → Add Device
```

**配置 VPN**：
```
Configuration → Templates → VPN → VPN-Interface-Ethernet
```

**配置路由**：
```
Configuration → Templates → VPN → OMP-Route
```

#### vEdge 配置

**基本配置**：
```
system
 hostname vEdge-1
 interface ge0/0
  ip-address 192.168.1.1/24
  tunnel-interface
   encapsulation ipsec
   color biz-internet
   allow-service all
  no shutdown
 vpn 0
 interface ge0/1
  ip-address 10.0.0.1/24
  no shutdown
 vpn 1
```

### 25.3 应用感知路由

#### 配置应用感知

**定义应用**：
```
policy
 app-route-policy APP-POLICY
  sequence 10
   match
    dscp ef
   action
    forward-class best-effort
```

**应用策略**：
```
vpn 1
 interface ge0/1
  app-route-policy APP-POLICY
```

### 25.4 本章小结

本章介绍了 SD-WAN 深入：

**核心知识点**：
- SD-WAN 架构
- Cisco SD-WAN 配置
- 应用感知路由

**重点记忆**：
- SD-WAN 分离控制平面和数据平面
- vManage 集中管理
- 应用感知路由优化流量

### 25.5 练习题

#### 简答题

1. SD-WAN 的主要组件有哪些？

2. 如何配置 Cisco SD-WAN？

3. 什么是应用感知路由？

---

## 第26章：网络安全深度分析

### 26.1 零信任网络

#### 零信任原则

**1. 永不信任，始终验证**
- 每次访问都需要验证
- 不依赖网络位置

**2. 最小权限**
- 只授予必要的权限
- 定期审查权限

**3. 假设被入侵**
- 持续监控
- 快速响应

#### 零信任架构

**组件**：
- **身份和访问管理 (IAM)**
- **设备健康检查**
- **网络分段**
- **持续监控**

### 26.2 SASE (Secure Access Service Edge)

#### SASE 架构

**SASE 组成**：
- **SD-WAN**：网络连接
- **SSE (Security Service Edge)**：安全服务
  - CASB
  - ZTNA
  - FWaaS
  - SWG

#### SASE 部署

**配置 SASE**：
```
# 配置 SD-WAN
sdwan
  vedge
    transport
      vpn 0
        interface ge0/0
          ip-address 203.0.113.1/24
          tunnel
            color internet

# 配置安全服务
security
  fw-policy
    sequence 10
      match
        destination-address 192.168.1.0/24
      action
        permit
```

### 26.3 网络分段

#### 微分段

**配置微分段**：
```
# 定义安全组
security-group
  name WEB-SERVERS
    members
      host 192.168.1.10
      host 192.168.1.11

# 定义策略
security-policy
  name WEB-TO-DB
    source WEB-SERVERS
    destination DB-SERVERS
    action permit
    service tcp
      port 3306
```

### 26.4 本章小结

本章介绍了网络安全深度分析：

**核心知识点**：
- 零信任网络
- SASE 架构
- 网络分段

**重点记忆**：
- 零信任永不信任，始终验证
- SASE 结合网络和安全
- 网络分段限制横向移动

### 26.5 练习题

#### 简答题

1. 什么是零信任网络？零信任的原则是什么？

2. SASE 由哪些组件组成？

3. 什么是网络分段？网络分段有什么作用？

---

## 第27章：网络监控与分析

### 27.1 SNMP 监控

#### SNMP 配置

**配置 SNMP**：
```
Router(config)# snmp-server community [社区字符串] ro
Router(config)# snmp-server community [社区字符串] rw
Router(config)# snmp-server contact [联系人]
Router(config)# snmp-server location [位置]
```

**使用 SNMP 监控**：
```python
from pysnmp.hlapi import *

# 查询接口流量
errorIndication, errorStatus, errorIndex, varBinds = next(
    getCmd(SnmpEngine(),
          CommunityData('public'),
          UdpTransportTarget(('192.168.1.1', 161)),
          ContextData(),
          ObjectType(ObjectIdentity('1.3.6.1.2.1.2.2.1.10.1')))
)
```

### 27.2 NetFlow 分析

#### NetFlow 配置

**配置 NetFlow**：
```
Router(config)# flow exporter EXPORTER-1
Router(config-flow-exporter)# destination 192.168.1.100 2055
Router(config-flow-exporter)# source gigabitethernet0/0
Router(config-flow-exporter)# transport udp 2055

Router(config)# flow monitor MONITOR-1
Router(config-flow-monitor)# record netflow ipv4 original-input
Router(config-flow-monitor)# exporter EXPORTER-1
Router(config-flow-monitor)# cache timeout active 60

Router(config)# interface gigabitethernet0/1
Router(config-if)# ip flow monitor MONITOR-1 input
```

### 27.3 Syslog 配置

#### Syslog 配置

**配置 Syslog**：
```
Router(config)# logging host 192.168.1.100
Router(config)# logging trap informational
Router(config)# logging facility local7
```

### 27.4 本章小结

本章介绍了网络监控与分析：

**核心知识点**：
- SNMP 监控
- NetFlow 分析
- Syslog 配置

**重点记忆**：
- SNMP 用于设备监控
- NetFlow 分析流量
- Syslog 记录日志

### 27.5 练习题

#### 简答题

1. SNMP 有哪些版本？各有什么特点？

2. NetFlow 有什么作用？如何配置？

3. Syslog 的作用是什么？如何配置？

---

*（第八部分：前沿技术篇 完）*

# 第九部分：认证考试篇

## 第28章：CCNA 考试指南

### 28.1 CCNA 200-301 考试概述

#### 考试信息

**考试时长**：120 分钟

**题目数量**：100-120 题

**及格分数**：825 分（满分 1000）

**考试费用**：$300

**注册地址**：https://www.pearsonvue.com/cisco

### 28.2 考试大纲

**1. 网络基础 (20%)**
- 网络接入
- IP 连接
- IP 服务
- 安全基础

**2. 网络访问 (20%)**
- VLAN 间路由
- 网络安全
- 网络地址转换 (NAT)
- DHCP

**3. IP 连接 (25%)**
- 路由协议
- IP 寻址
- IPv6 寻址

**4. IP 服务 (15%)**
- DNS
- DHCP
- SNMP
- Syslog
- NTP

**5. 安全基础 (15%)**
- 访问控制列表
- 安全设备
- 安全策略

**6. 自动化和可编程性 (5%)**
- 控制器
- API
- SDN

### 28.3 复习重点

**重点知识点**：
- OSI 模型和 TCP/IP 协议栈
- IP 地址和子网划分
- 路由协议（RIP、OSPF、EIGRP）
- 交换技术（VLAN、STP、EtherChannel）
- ACL 和 NAT
- DHCP 和 DNS
- IPv6 基础
- 网络安全基础
- 网络自动化基础

### 28.4 模拟考试

#### 模拟题示例

**1. 以下哪个协议是链路状态协议？**
   - A. RIP
   - B. EIGRP
   - C. OSPF
   - D. BGP

**答案**：C

**2. 默认子网掩码 255.255.255.0 对应的 CIDR 表示法是？**
   - A. /8
   - B. /16
   - C. /24
   - D. /32

**答案**：C

**3. STP 的主要作用是？**
   - A. 增加带宽
   - B. 消除环路
   - C. 提高安全性
   - D. 简化管理

**答案**：B

### 28.5 考试技巧

**1. 时间管理**
- 每题约 1 分钟
- 先做简单的题
- 标记难题，最后做

**2. 答题技巧**
- 仔细阅读题目
- 排除明显错误的选项
- 注意关键词

**3. 考前准备**
- 复习所有知识点
- 做模拟考试
- 熟悉考试界面

### 28.6 本章小结

本章介绍了 CCNA 考试指南：

**核心知识点**：
- CCNA 200-301 考试概述
- 考试大纲
- 复习重点
- 模拟考试
- 考试技巧

**重点记忆**：
- 考试时长 120 分钟
- 及格分数 825 分
- 重点掌握路由、交换、安全、自动化

---

## 第29章：CCNP 考试指南

### 29.1 CCNP ENCOR 350-401 考试概述

#### 考试信息

**考试时长**：120 分钟

**题目数量**：100-120 题

**及格分数**：825 分（满分 1000）

**考试费用**：$400

### 29.2 考试大纲

**1. 架构 (15%)**
- 网络设计
- 虚拟化
- SD-Access

**2. 虚拟化 (10%)**
- 网络虚拟化
- LISP
- VXLAN

**3. 基础设施 (30%)**
- 二层技术
- 三层技术
- 安全

**4. 网络保障 (20%)**
- 监控
- 故障排除
- 性能优化

**5. 安全 (15%)**
- 基础设施安全
- 网络安全
- 设备安全

**6. 自动化 (10%)**
- 控制器
- API
- 脚本

### 29.3 复习重点

**重点知识点**：
- OSPF 和 EIGRP 高级配置
- BGP 基础
- MPLS 基础
- SD-Access
- SD-WAN
- 网络安全
- 网络自动化

### 29.4 模拟考试

#### 模拟题示例

**1. OSPF 的默认参考带宽是多少？**
   - A. 10 Mbps
   - B. 100 Mbps
   - C. 1 Gbps
   - D. 10 Gbps

**答案**：B

**2. BGP 的默认管理距离是？**
   - A. 20
   - B. 90
   - C. 110
   - D. 120

**答案**：A

**3. SD-Access 使用什么技术实现网络虚拟化？**
   - A. VXLAN
   - B. GRE
   - C. IPsec
   - D. MPLS

**答案**：A

### 29.5 本章小结

本章介绍了 CCNP 考试指南：

**核心知识点**：
- CCNP ENCOR 350-401 考试概述
- 考试大纲
- 复习重点
- 模拟考试

**重点记忆**：
- 考试时长 120 分钟
- 重点掌握 OSPF、EIGRP、BGP、MPLS
- 了解 SD-Access 和 SD-WAN

---

## 第30章：CCIE 考试指南

### 30.1 CCIE 考试概述

#### 考试结构

**1. 笔试**
- 时长：2 小时
- 题目：100 道
- 及格分数：80%
- 费用：$400

**2. 实验**
- 时长：8 小时
- 内容：配置和故障排除
- 及格分数：80%
- 费用：$1600

### 30.2 笔试大纲

**1. 网络基础设施 (30%)**
- 二层技术
- 三层技术
- VPN 技术

**2. 第二层技术 (15%)**
- VLAN
- STP
- EtherChannel

**3. 第三层技术 (25%)**
- OSPF
- EIGRP
- BGP
- IPv6

**4. VPN 技术 (10%)**
- IPSec
- DMVPN
- GETVPN

**5. 基础设施安全 (10%)**
- 设备安全
- 网络安全
- 控制平面安全

**6. 基础设施服务 (5%)**
- DHCP
- DNS
- NTP

**7. 基础设施自动化 (5%)**
- Python
- Ansible
- REST API

### 30.3 实验考试大纲

**1. 配置部分**
- 路由协议配置
- 交换技术配置
- 安全配置
- 服务配置

**2. 故障排除部分**
- 路由问题
- 交换问题
- 安全问题
- 性能问题

### 30.4 复习重点

**重点知识点**：
- OSPF 高级配置（虚链路、认证、汇总）
- EIGRP 高级配置（命名模式、负载均衡）
- BGP 高级配置（路由反射器、联盟）
- MPLS VPN
- IPSec VPN
- DMVPN
- QoS
- 网络安全
- 网络自动化

### 30.5 模拟考试

#### 笔试模拟题

**1. OSPF 虚链路用于连接什么？**
   - A. 非骨干区域到骨干区域
   - B. 骨干区域到骨干区域
   - C. 非骨干区域到非骨干区域
   - D. 所有区域

**答案**：A

**2. BGP 路由反射器的作用是？**
   - A. 提高 BGP 收敛速度
   - B. 减少 iBGP 全互联需求
   - C. 增加 BGP 路由数量
   - D. 优化 BGP 路径选择

**答案**：B

**3. MPLS VPN 使用什么协议分发标签？**
   - A. BGP
   - B. LDP
   - C. OSPF
   - D. EIGRP

**答案**：B

### 30.6 实验考试技巧

**1. 时间管理**
- 配置部分：4-5 小时
- 故障排除部分：3-4 小时
- 先做简单的配置

**2. 配置技巧**
- 先配置基础功能
- 再配置高级功能
- 最后优化和验证

**3. 故障排除技巧**
- 使用分层方法
- 从物理层开始
- 逐步向上排查

**4. 验证技巧**
- 每完成一个功能就验证
- 使用 show 命令验证
- 使用 ping 和 traceroute 测试

### 30.7 本章小结

本章介绍了 CCIE 考试指南：

**核心知识点**：
- CCIE 考试结构
- 笔试大纲
- 实验考试大纲
- 复习重点
- 模拟考试
- 考试技巧

**重点记忆**：
- 笔试 2 小时，实验 8 小时
- 重点掌握 OSPF、EIGRP、BGP、MPLS
- 实验考试需要快速配置和故障排除

---

*（第九部分：认证考试篇 完）*

# 附录

## 附录 A：常用命令速查表

### 路由器命令

**基本配置**：
```
enable                    # 进入特权模式
configure terminal        # 进入全局配置模式
hostname [名称]          # 配置主机名
no ip domain-lookup      # 禁用域名解析
```

**接口配置**：
```
interface [接口]        # 进入接口配置模式
ip address [IP] [掩码]  # 配置 IP 地址
no shutdown             # 启用接口
```

**查看配置**：
```
show running-config     # 查看运行配置
show startup-config     # 查看启动配置
show version           # 查看版本信息
show ip interface brief # 查看接口摘要
```

**路由相关**：
```
show ip route          # 查看路由表
show ip protocols      # 查看路由协议
ping [地址]            # 测试连通性
traceroute [地址]      # 路径追踪
```

### 交换机命令

**VLAN 配置**：
```
vlan [ID]              # 创建 VLAN
name [名称]            # 配置 VLAN 名称
show vlan brief        # 查看 VLAN
```

**端口配置**：
```
interface [接口]       # 进入接口配置模式
switchport mode access # 配置为接入模式
switchport access vlan [ID] # 分配 VLAN
switchport mode trunk  # 配置为 Trunk 模式
```

**生成树**：
```
spanning-tree mode [模式] # 配置生成树模式
show spanning-tree        # 查看生成树
```

### 保存配置
```
write memory           # 保存配置
copy running-config startup-config # 保存配置
```

## 附录 B：常见问题解答

**1. 如何重置路由器密码？**
- 使用密码恢复流程
- 修改配置寄存器
- 重新加载路由器

**2. 如何恢复出厂设置？**
- erase startup-config
- reload

**3. 如何升级 IOS？**
- 复制 IOS 到 Flash
- 修改启动配置
- 重新加载

**4. 如何配置远程管理？**
- 配置 VTY 线路
- 配置登录密码
- 配置 enable 密码

**5. 如何配置 SSH？**
- 生成 RSA 密钥
- 配置 VTY 线路
- 启用 SSH

## 附录 C：实验环境搭建指南

### Packet Tracer 安装

1. 下载 Packet Tracer
2. 安装软件
3. 注册账号
4. 开始实验

### GNS3 安装

1. 下载 GNS3
2. 安装 GNS3
3. 下载 IOS 镜像
4. 配置设备
5. 开始实验

### EVE-NG 安装

1. 下载 EVE-NG
2. 安装 EVE-NG
3. 下载 IOS 镜像
4. 配置设备
5. 开始实验

## 附录 D：考试模拟题

### CCNA 模拟题

**1. 以下哪个协议是链路状态协议？**
   - A. RIP
   - B. EIGRP
   - C. OSPF
   - D. BGP

**答案**：C

**2. 默认子网掩码 255.255.255.0 对应的 CIDR 表示法是？**
   - A. /8
   - B. /16
   - C. /24
   - D. /32

**答案**：C

**3. STP 的主要作用是？**
   - A. 增加带宽
   - B. 消除环路
   - C. 提高安全性
   - D. 简化管理

**答案**：B

**4. TCP 三次握手的第一步是发送什么标志位？**
   - A. SYN
   - B. ACK
   - C. FIN
   - D. RST

**答案**：A

**5. 以下哪个是私有 IP 地址？**
   - A. 8.8.8.8
   - B. 172.16.0.1
   - C. 192.0.2.1
   - D. 203.0.113.1

**答案**：B

### CCNP 模拟题

**1. OSPF 的默认参考带宽是多少？**
   - A. 10 Mbps
   - B. 100 Mbps
   - C. 1 Gbps
   - D. 10 Gbps

**答案**：B

**2. BGP 的默认管理距离是？**
   - A. 20
   - B. 90
   - C. 110
   - D. 120

**答案**：A

**3. SD-Access 使用什么技术实现网络虚拟化？**
   - A. VXLAN
   - B. GRE
   - C. IPsec
   - D. MPLS

**答案**：A

**4. MPLS VPN 使用什么协议分发标签？**
   - A. BGP
   - B. LDP
   - C. OSPF
   - D. EIGRP

**答案**：B

**5. QoS 的 DiffServ 模型使用什么标记流量？**
   - A. TOS
   - B. DSCP
   - C. COS
   - D. EXP

**答案**：B

### CCIE 模拟题

**1. OSPF 虚链路用于连接什么？**
   - A. 非骨干区域到骨干区域
   - B. 骨干区域到骨干区域
   - C. 非骨干区域到非骨干区域
   - D. 所有区域

**答案**：A

**2. BGP 路由反射器的作用是？**
   - A. 提高 BGP 收敛速度
   - B. 减少 iBGP 全互联需求
   - C. 增加 BGP 路由数量
   - D. 优化 BGP 路径选择

**答案**：B

**3. MPLS VPN 使用什么协议分发标签？**
   - A. BGP
   - B. LDP
   - C. OSPF
   - D. EIGRP

**答案**：B

**4. IPSec VPN 的 IKE Phase 1 用于什么？**
   - A. 建立安全关联
   - B. 交换密钥
   - C. 验证身份
   - D. 加密数据

**答案**：A

**5. QoS 的 LLQ 用于什么流量？**
   - A. 数据流量
   - B. 语音流量
   - C. 视频流量
   - D. 所有流量

**答案**：B

---

*附录完*

## 第16章：企业网络设计案例

### 16.1 企业网络设计原则

**1. 可靠性**
- 冗余设计
- 故障快速恢复
- 高可用性

**2. 可扩展性**
- 模块化设计
- 易于扩展
- 支持增长

**3. 安全性**
- 分层防护
- 访问控制
- 数据加密

**4. 可管理性**
- 集中管理
- 监控告警
- 故障诊断

### 16.2 企业网络架构

**三层架构**：

**1. 核心层**
- 高速转发
- 冗余设计
- 最少路由

**2. 汇聚层**
- 策略实施
- 路由聚合
- VLAN 间路由

**3. 接入层**
- 用户接入
- 端口安全
- VLAN 划分

### 16.3 本章小结

本章介绍了企业网络设计：

**核心知识点**：
- 企业网络设计原则
- 三层架构

**重点记忆**：
- 可靠性、可扩展性、安全性、可管理性
- 核心层、汇聚层、接入层

---

## 第17章：网络故障排除

### 17.1 故障排除方法

**1. 分层方法**
- 从物理层到应用层
- 逐层排查

**2. 分治法**
- 将问题分解
- 逐个解决

**3. 替换法**
- 替换可疑设备
- 验证问题

### 17.2 常用故障排除命令

**1. ping**
- 测试连通性
- 诊断网络

**2. traceroute**
- 路径追踪
- 定位问题

**3. show**
- 查看配置
- 查看状态

**4. debug**
- 实时调试
- 诊断问题

### 17.3 本章小结

本章介绍了网络故障排除：

**核心知识点**：
- 故障排除方法
- 常用命令

**重点记忆**：
- 分层方法、分治法、替换法
- ping、traceroute、show、debug

---

## 第18章：综合实验项目

### 18.1 项目目标

设计并实现一个完整的企业网络，包括：
- 路由和交换
- VLAN 和 Trunk
- 路由协议
- 安全配置
- 网络服务

### 18.2 项目要求

1. 设计网络拓扑
2. 配置 IP 地址
3. 配置 VLAN
4. 配置路由协议
5. 配置安全策略
6. 配置网络服务
7. 测试连通性

### 18.3 项目实施

**步骤**：
1. 需求分析
2. 网络设计
3. 设备配置
4. 测试验证
5. 文档编写

### 18.4 本章小结

本章介绍了综合实验项目：

**核心知识点**：
- 项目目标
- 项目要求
- 项目实施

**重点记忆**：
- 从需求分析到文档编写的完整流程
- 综合运用所学知识

---

# 附录

## 附录 A：常用命令速查表

### 路由器命令

**基本配置**：
```
enable                    # 进入特权模式
configure terminal        # 进入全局配置模式
hostname [名称]          # 配置主机名
no ip domain-lookup      # 禁用域名解析
```

**接口配置**：
```
interface [接口]        # 进入接口配置模式
ip address [IP] [掩码]  # 配置 IP 地址
no shutdown             # 启用接口
```

**查看配置**：
```
show running-config     # 查看运行配置
show startup-config     # 查看启动配置
show version           # 查看版本信息
show ip interface brief # 查看接口摘要
```

**路由相关**：
```
show ip route          # 查看路由表
show ip protocols      # 查看路由协议
ping [地址]            # 测试连通性
traceroute [地址]      # 路径追踪
```

### 交换机命令

**VLAN 配置**：
```
vlan [ID]              # 创建 VLAN
name [名称]            # 配置 VLAN 名称
show vlan brief        # 查看 VLAN
```

**端口配置**：
```
interface [接口]       # 进入接口配置模式
switchport mode access # 配置为接入模式
switchport access vlan [ID] # 分配 VLAN
switchport mode trunk  # 配置为 Trunk 模式
```

**生成树**：
```
spanning-tree mode [模式] # 配置生成树模式
show spanning-tree        # 查看生成树
```

### 保存配置
```
write memory           # 保存配置
copy running-config startup-config # 保存配置
```

## 附录 B：常见问题解答

**1. 如何重置路由器密码？**
- 使用密码恢复流程
- 修改配置寄存器
- 重新加载路由器

**2. 如何恢复出厂设置？**
- erase startup-config
- reload

**3. 如何升级 IOS？**
- 复制 IOS 到 Flash
- 修改启动配置
- 重新加载

**4. 如何配置远程管理？**
- 配置 VTY 线路
- 配置登录密码
- 配置 enable 密码

**5. 如何配置 SSH？**
- 生成 RSA 密钥
- 配置 VTY 线路
- 启用 SSH

## 附录 C：实验环境搭建指南

### Packet Tracer 安装

1. 下载 Packet Tracer
2. 安装软件
3. 注册账号
4. 开始实验

### GNS3 安装

1. 下载 GNS3
2. 安装 GNS3
3. 下载 IOS 镜像
4. 配置设备
5. 开始实验

### EVE-NG 安装

1. 下载 EVE-NG
2. 安装 EVE-NG
3. 下载 IOS 镜像
4. 配置设备
5. 开始实验

---

# 结语

恭喜你完成了《Cisco 网络完全学习指南》的学习！

本书从零基础开始，系统介绍了 Cisco 网络的各个方面，包括：

- 网络基础知识
- 路由技术
- 交换技术
- 安全与优化
- 高级主题
- **CCIE 进阶技术**（路由与交换深入、服务提供商技术、数据中心技术）
- 实战项目

**下一步建议**：

**CCNA 认证路径**：
1. 复习 CCNA 考试大纲
2. 完成所有实验
3. 参加模拟考试
4. 准备 CCNA 200-301 认证考试

**CCNP 认证路径**：
1. 深入学习路由协议（OSPF、EIGRP、BGP）
2. 掌握高级交换技术（MSTP、VTP、私有 VLAN）
3. 学习网络服务和安全
4. 准备 CCNP ENCOR 350-401 认证考试

**CCIE 认证路径**：
1. 精通所有路由协议（OSPF、EIGRP、BGP 高级配置）
2. 掌握 MPLS、VPN、QoS 等高级技术
3. 熟悉服务提供商网络架构
4. 了解数据中心技术（Nexus、VXLAN、ACI）
5. 大量实验练习，积累故障排除经验
6. 参加 CCIE 实验考试

**学习资源**：
- Cisco 官方文档
- CCIE 学习指南
- 在线课程（INE、Cisco Learning Network）
- 技术社区（Cisco Support Community、Stack Overflow）
- 实验平台（GNS3、EVE-NG、Cisco Modeling Labs）

**推荐书籍**：
- CCNA Certification All-in-One For Dummies
- CCNP Complete Study Guide
- CCIE Routing and Switching v5.1 Foundations
- Cisco Networks: Engineers' Handbook

**持续学习**：
网络技术在不断发展，保持学习的态度，与时俱进，才能真正成为一名合格的网络工程师。

从 CCNA 到 CCIE，这是一段漫长的学习旅程。每一步都需要扎实的理论基础和丰富的实践经验。记住：

- **理论是基础**：深入理解协议原理
- **实验是关键**：多做实验，积累经验
- **故障排除是能力**：培养解决问题的能力
- **持续学习是态度**：保持好奇心和学习热情

祝你学习顺利，成为一名优秀的网络工程师！

---

*本书完*